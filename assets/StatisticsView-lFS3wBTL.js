import{u as K,A as U,c as B,a as p,l as N,b as l,r as d,w as t,C as q,f as r,e as a,g as o,t as i,d as m,h as f,F as W,i as R,K as z,L as I,M as y}from"./index-C3e-Y_By.js";import{c as J}from"./statisticsCalculator-CkByyxzh.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./formatters-CuXF23sB.js";import"./chess-f0FuLRjZ.js";const X={key:0,class:"text-center pa-10"},Y={key:1,class:"text-center text-grey pa-10"},Z={key:2},tt={class:"text-h4 font-weight-bold"},et={class:"text-h4 font-weight-bold"},lt={class:"text-h4 font-weight-bold"},st={class:"text-h4 font-weight-bold text-success my-1"},at={class:"text-h4 font-weight-bold my-1"},nt={class:"text-caption"},it={class:"stacked-bar mb-2"},ot={class:"d-flex justify-center flex-wrap ga-4 text-caption"},rt={class:"d-flex align-center"},dt={class:"d-flex align-center"},ut={class:"d-flex align-center"},ct={class:"font-weight-bold"},mt={class:"font-weight-bold"},vt={class:"font-weight-bold"},gt={class:"text-caption text-grey"},_t={class:"stacked-bar-mini my-1"},pt={class:"stacked-bar-mini my-2"},ft={__name:"StatisticsView",setup(yt){const v=K(),O=q(),j=U(),s=B(()=>!v.participants.length||!v.statisticsData.length?null:J({participants:v.participants,gamesForStats:v.statisticsData,standings:v.standings,tournamentDetails:v.activeTournament,ecoDatabase:v.ecoDatabase})),T=B(()=>s.value?s.value.resultDistribution.totalGames:0),L=[{title:"Дебют",key:"name",sortable:!1,align:"start",width:"50%"},{title:"Партий",key:"count",sortable:!1,align:"center",width:"15%"},{title:"Результаты (Б/Н/Ч)",key:"results",sortable:!1,align:"start",width:"35%"}],F=g=>{g&&O.push({name:"Game",params:{gameId:g}})},k=g=>{console.log(g),g&&O.push({name:"Player",params:{tournamentId:v.activeTournament.id,playerId:g}})};return(g,e)=>{const A=d("v-progress-circular"),u=d("v-icon"),D=d("v-sheet"),c=d("v-col"),b=d("v-row"),x=d("v-card-title"),_=d("v-card-text"),w=d("v-card"),M=d("v-card-subtitle"),E=d("v-chip"),h=d("v-divider"),P=d("v-tooltip"),G=d("v-list-item-title"),C=d("v-list-item-subtitle"),S=d("v-list-item"),V=d("v-list"),H=d("v-data-table");return r(),p("div",null,[N(v).isLoadingDetails?(r(),p("div",X,[l(A,{indeterminate:"",color:"primary",size:"64"})])):s.value?(r(),p("div",Z,[l(b,{class:"mb-4"},{default:t(()=>[l(c,{cols:"12",sm:"4"},{default:t(()=>[l(D,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:t(()=>[l(u,{size:"48",color:"primary",class:"mr-4"},{default:t(()=>[...e[4]||(e[4]=[o("mdi-account-group-outline",-1)])]),_:1}),a("div",null,[a("div",tt,i(s.value.totalPlayers),1),e[5]||(e[5]=a("div",{class:"text-caption text-medium-emphasis"},"Участников",-1))])]),_:1})]),_:1}),l(c,{cols:"12",sm:"4"},{default:t(()=>[l(D,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:t(()=>[l(u,{size:"48",color:"primary",class:"mr-4"},{default:t(()=>[...e[6]||(e[6]=[o("mdi-recycle",-1)])]),_:1}),a("div",null,[a("div",et,i(s.value.totalRounds),1),e[7]||(e[7]=a("div",{class:"text-caption text-medium-emphasis"},"Туров",-1))])]),_:1})]),_:1}),l(c,{cols:"12",sm:"4"},{default:t(()=>[l(D,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:t(()=>[l(u,{size:"48",color:"primary",class:"mr-4"},{default:t(()=>[...e[8]||(e[8]=[o("mdi-finance",-1)])]),_:1}),a("div",null,[a("div",lt,i(s.value.averageRating),1),e[9]||(e[9]=a("div",{class:"text-caption text-medium-emphasis"},"Средний рейтинг",-1))])]),_:1})]),_:1})]),_:1}),l(b,null,{default:t(()=>[l(c,{cols:"12",md:"4"},{default:t(()=>[l(b,null,{default:t(()=>[l(c,{cols:"12",sm:"6",md:"12"},{default:t(()=>[l(w,{class:"text-center pa-4 fill-height highlight-card"},{default:t(()=>[l(u,{size:"x-large",color:"amber"},{default:t(()=>[...e[10]||(e[10]=[o("mdi-rocket-launch-outline",-1)])]),_:1}),l(x,{class:"text-wrap"},{default:t(()=>[...e[11]||(e[11]=[o("Главный прорыв",-1)])]),_:1}),s.value.biggestOverperformer?(r(),m(_,{key:0,class:"d-flex flex-column flex-grow-1 justify-center"},{default:t(()=>[a("div",{class:"text-h6 cursor-pointer",onClick:e[0]||(e[0]=n=>k(s.value.biggestOverperformer.player.player_id))},i(s.value.biggestOverperformer.player.name),1),a("div",st,"+"+i(s.value.biggestOverperformer.diff),1),e[12]||(e[12]=a("div",{class:"text-caption"},"пунктов перфоманса к рейтингу",-1))]),_:1})):f("",!0)]),_:1})]),_:1}),l(c,{cols:"12",sm:"6",md:"12"},{default:t(()=>[l(w,{class:"text-center pa-4 fill-height highlight-card"},{default:t(()=>[l(u,{size:"x-large",color:"red-lighten-1"},{default:t(()=>[...e[13]||(e[13]=[o("mdi-sword-cross",-1)])]),_:1}),l(x,{class:"text-wrap"},{default:t(()=>[...e[14]||(e[14]=[o("Самый бескомпромиссный",-1)])]),_:1}),s.value.mostDecisivePlayer?(r(),m(_,{key:0,class:"d-flex flex-column flex-grow-1 justify-center"},{default:t(()=>[a("div",{class:"text-h6 cursor-pointer",onClick:e[1]||(e[1]=n=>k(s.value.mostDecisivePlayer.player.player_id))},i(s.value.mostDecisivePlayer.player.name),1),a("div",at,i(s.value.mostDecisivePlayer.drawRate.toFixed(0))+"% ничьих",1),a("div",nt,"из "+i(s.value.mostDecisivePlayer.playedGames)+" сыгранных партий",1)]),_:1})):f("",!0)]),_:1})]),_:1}),l(c,{cols:"12"},{default:t(()=>[l(w,null,{default:t(()=>[l(x,null,{default:t(()=>[...e[15]||(e[15]=[o("Непобежденные игроки",-1)])]),_:1}),s.value.undefeatedPlayers.length>0?(r(),m(M,{key:0},{default:t(()=>[o("Всего: "+i(s.value.undefeatedPlayers.length),1)]),_:1})):f("",!0),s.value.undefeatedPlayers.length>0?(r(),m(_,{key:1},{default:t(()=>[(r(!0),p(W,null,R(s.value.undefeatedPlayers,n=>(r(),m(E,{key:n.id,class:"ma-1",onClick:$=>k(n.player_id),label:""},{default:t(()=>[o(i(n.name)+" ("+i(n.score)+")",1)]),_:2},1032,["onClick"]))),128))]),_:1})):(r(),m(_,{key:2,class:"text-center text-grey"},{default:t(()=>[...e[16]||(e[16]=[o("Таких игроков нет.",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",md:"8"},{default:t(()=>[l(w,null,{default:t(()=>[l(x,null,{default:t(()=>[...e[17]||(e[17]=[o("Аналитика турнира",-1)])]),_:1}),l(h),l(_,null,{default:t(()=>[e[18]||(e[18]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"Распределение результатов",-1)),a("div",it,[l(P,{location:"top"},{activator:t(({props:n})=>[a("div",z(n,{class:"bar-segment bg-grey-lighten-2",style:{width:s.value.resultDistribution.whiteWinPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Белые: "+i(s.value.resultDistribution.whiteWins)+" ("+i(s.value.resultDistribution.whiteWinPercent)+"%)",1)]),_:1}),l(P,{location:"top"},{activator:t(({props:n})=>[a("div",z(n,{class:"bar-segment bg-grey-darken-1",style:{width:s.value.resultDistribution.drawPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Ничьи: "+i(s.value.resultDistribution.draws)+" ("+i(s.value.resultDistribution.drawPercent)+"%)",1)]),_:1}),l(P,{location:"top"},{activator:t(({props:n})=>[a("div",z(n,{class:"bar-segment bg-grey-darken-4",style:{width:s.value.resultDistribution.blackWinPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Черные: "+i(s.value.resultDistribution.blackWins)+" ("+i(s.value.resultDistribution.blackWinPercent)+"%)",1)]),_:1})]),a("div",ot,[a("div",rt,[l(u,{icon:"mdi-circle-slice-8",color:"grey-lighten-2",class:"mr-1"}),o(" Победы белых ("+i(s.value.resultDistribution.whiteWinPercent)+"%)",1)]),a("div",dt,[l(u,{icon:"mdi-circle-slice-8",color:"grey-darken-1",class:"mr-1"}),o(" Ничьи ("+i(s.value.resultDistribution.drawPercent)+"%)",1)]),a("div",ut,[l(u,{icon:"mdi-circle-slice-8",color:"grey-darken-4",class:"mr-1"}),o(" Победы черных ("+i(s.value.resultDistribution.blackWinPercent)+"%)",1)])])]),_:1}),l(h,{class:"mx-4"}),l(_,null,{default:t(()=>[e[27]||(e[27]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-2"},"Динамика партий",-1)),l(V,{lines:"two",density:"compact"},{default:t(()=>[s.value.longestGame?(r(),m(S,{key:0,class:"list-item-hover","prepend-icon":"mdi-timer-sand-complete",onClick:e[2]||(e[2]=n=>F(s.value.longestGame.game.id))},{default:t(()=>[l(G,null,{default:t(()=>[e[19]||(e[19]=o("Самая длинная партия: ",-1)),a("strong",null,i(s.value.longestGame.moves)+" ходов",1)]),_:1}),l(C,null,{default:t(()=>[o(i(s.value.longestGame.game.white_name)+" vs "+i(s.value.longestGame.game.black_name),1)]),_:1})]),_:1})):f("",!0),s.value.shortestGame?(r(),m(S,{key:1,class:"list-item-hover","prepend-icon":"mdi-timer-sand-empty",onClick:e[3]||(e[3]=n=>F(s.value.shortestGame.game.id))},{default:t(()=>[l(G,null,{default:t(()=>[e[20]||(e[20]=o("Самая короткая партия: ",-1)),a("strong",null,i(s.value.shortestGame.moves)+" ходов",1)]),_:1}),l(C,null,{default:t(()=>[o(i(s.value.shortestGame.game.white_name)+" vs "+i(s.value.shortestGame.game.black_name),1)]),_:1})]),_:1})):f("",!0)]),_:1}),l(b,{dense:"",class:"text-center mt-2"},{default:t(()=>[l(c,null,{default:t(()=>[l(u,null,{default:t(()=>[...e[21]||(e[21]=[o("mdi-timer-sand",-1)])]),_:1}),a("div",ct,i(s.value.averageMoveCount),1),e[22]||(e[22]=a("div",{class:"text-caption"},"ср. длина",-1))]),_:1}),l(c,null,{default:t(()=>[l(u,null,{default:t(()=>[...e[23]||(e[23]=[o("mdi-chess-rook",-1)])]),_:1}),a("div",mt,i(s.value.totalCastles),1),e[24]||(e[24]=a("div",{class:"text-caption"},"рокировок",-1))]),_:1}),l(c,null,{default:t(()=>[l(u,null,{default:t(()=>[...e[25]||(e[25]=[o("mdi-chess-pawn",-1)])]),_:1}),a("div",vt,i(s.value.totalPromotions),1),e[26]||(e[26]=a("div",{class:"text-caption"},"превращений",-1))]),_:1})]),_:1})]),_:1}),l(h,{class:"mx-4"}),l(_,null,{default:t(()=>[...e[28]||(e[28]=[a("h3",{class:"text-subtitle-1 font-weight-bold mb-2"},"Дебютные тренды",-1)])]),_:1}),N(j).mdAndUp.value?(r(),m(H,{key:0,headers:L,items:s.value.topOpenings,"items-per-page":10,density:"compact"},I({"item.name":t(({item:n})=>[a("div",null,i(n.name),1),a("div",gt,i(n.eco),1)]),"item.results":t(({item:n})=>[a("div",_t,[a("div",{class:"bar-segment bg-grey-lighten-2",style:y({width:n.white/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-1",style:y({width:n.draw/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-4",style:y({width:n.black/n.count*100+"%"})},null,4)])]),_:2},[s.value.resultDistribution?{name:"item.count",fn:t(({item:n})=>[o(i(n.count)+" ("+i((n.count/T.value*100).toFixed(0))+"%)",1)]),key:"0"}:void 0]),1032,["items"])):(r(),m(V,{key:1,lines:"three",class:"py-0"},{default:t(()=>[(r(!0),p(W,null,R(s.value.topOpenings,(n,$)=>(r(),p(W,{key:n.eco},[l(S,null,{default:t(()=>[l(G,{class:"font-weight-medium text-wrap"},{default:t(()=>[o(i(n.name),1)]),_:2},1024),l(C,{class:"mt-1"},{default:t(()=>[o(i(n.eco)+" · "+i(n.count)+" "+i(n.count>1?"партии":"партия")+" ("+i((n.count/T.value*100).toFixed(0))+"%)",1)]),_:2},1024),a("div",pt,[a("div",{class:"bar-segment bg-grey-lighten-2",style:y({width:n.white/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-1",style:y({width:n.draw/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-4",style:y({width:n.black/n.count*100+"%"})},null,4)])]),_:2},1024),$<s.value.topOpenings.length-1?(r(),m(h,{key:0})):f("",!0)],64))),128))]),_:1}))]),_:1})]),_:1})]),_:1})])):(r(),p("div",Y," Недостаточно данных для генерации статистики. "))])}}},Dt=Q(ft,[["__scopeId","data-v-048013c8"]]);export{Dt as default};
