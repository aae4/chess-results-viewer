import{E as W,j as l,c as o,u as z,G as u}from"./index-C7cLTlNq.js";import{f as P}from"./formatters-C8Ln7w-r.js";const F=W("player",()=>{const v=l(null),r=l([]),g=l(!1),p=l(null),y=l([]),_=l(!1),m=l(null),i=l(null),h=l(null),c=l(null),s=l([]),d=l(!1),b=o(()=>{const e={gold:0,silver:0,bronze:0,tournaments:r.value.length};return r.value&&r.value.forEach(t=>{t.final_rank===1?e.gold++:t.final_rank===2?e.silver++:t.final_rank===3&&e.bronze++}),e}),k=o(()=>!r.value||r.value.length===0?{labels:[],datasets:[]}:{datasets:[{label:"Рейтинг FIDE",backgroundColor:"rgba(0, 82, 204, 0.2)",borderColor:"#0052CC",pointBackgroundColor:"#0052CC",pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBackgroundColor:"white",data:r.value.filter(t=>t.start_date&&t.rating_at_tournament).map(t=>({x:t.start_date,y:t.rating_at_tournament,tournamentName:t.tournament_name,ratingChange:t.rating_change})),fill:!0,tension:.1}]}),C=o(()=>{const t=z().currentTournament;return!t||!r.value||r.value.length===0?null:r.value.find(a=>a.tournament_id===t.id)||null}),H=o(()=>{const e={peakRating:0,latestRating:0};if(!r.value)return e;let t="";return r.value.forEach(a=>{a.rating_at_tournament>e.peakRating&&(e.peakRating=a.rating_at_tournament),a.start_date>t&&(t=a.start_date,e.latestRating=a.rating_at_tournament)}),e}),E=o(()=>{const e={wins:0,draws:0,losses:0,total:0,score:0,percent:0},t={vs_stronger:{...e},vs_equal:{...e},vs_weaker:{...e}};return i.value&&i.value.forEach(a=>{const{opponent_category:n,wins:f,draws:w,losses:S}=a;t[n]={wins:f,draws:w,losses:S,total:f+w+S,score:f+w*.5},t[n].percent=Math.round(t[n].score/t[n].total*100)}),t}),R=o(()=>c.value?c.value:[]),L=o(()=>{const e={white:{w:0,d:0,l:0,total:0,score:0,winPercent:0},black:{w:0,d:0,l:0,total:0,score:0,winPercent:0},total:{w:0,d:0,l:0,total:0,score:0,winPercent:0}};return!s.value||s.value.length===0||(s.value.forEach(t=>{const a=P(t.result,t.player_color),n=t.player_color==="w"?"white":"black";a==="1"?(e[n].w++,e.total.w++):a==="½"?(e[n].d++,e.total.d++):a==="0"&&(e[n].l++,e.total.l++)}),["white","black","total"].forEach(t=>{const a=e[t];a.total=a.w+a.d+a.l,a.score=a.w+a.d*.5,a.total>0&&(a.winPercent=Math.round(a.w/a.total*100))})),e}),A=o(()=>{const e={opening:{score:0,total:0},middlegame:{score:0,total:0},endgame:{score:0,total:0}};return s.value.forEach(t=>{const a=P(t.result,t.player_color),n=a==="1"?1:a==="½"?.5:0,f=t.round/t.rounds_count;f<=.34?(e.opening.score+=n,e.opening.total++):f<=.67?(e.middlegame.score+=n,e.middlegame.total++):(e.endgame.score+=n,e.endgame.total++)}),Object.values(e).forEach(t=>{t.percent=t.total>0?Math.round(t.score/t.total*100):0}),e}),D=o(()=>{let e={opponent_rating:0,opponent_name:null,game_id:null},t={opponent_rating:1/0,opponent_name:null,game_id:null};return s.value.forEach(a=>{const n=P(a.result,a.player_color);n==="1"&&a.opponent_rating>e.opponent_rating&&(e=a),n==="0"&&a.opponent_rating<t.opponent_rating&&(t=a)}),{bestWin:e.game_id?e:null,worstLoss:t.game_id?t:null}});async function O(e){g.value=!0,p.value=null;try{const[t,a]=await Promise.all([u.getPlayerGlobalProfile(e),u.getPlayerCareer(e)]);v.value=t,r.value=a}catch(t){p.value=t.message,console.error("Ошибка при загрузке глобального профиля игрока:",t)}finally{g.value=!1}}async function B(e){if(!i.value){d.value=!0;try{const[t,a,n]=await Promise.all([u.getPlayerOpponentStats(e),u.getPlayerOpeningStats(e),u.getPlayerGamesForAnalytics(e)]);i.value=t,h.value=a,s.value=n}catch(t){console.error("Ошибка при загрузке аналитики:",t)}finally{d.value=!1}}}async function G(e){if(!c.value){d.value=!0;try{c.value=await u.getPlayerHeadToHead(e)}catch(t){console.error("Ошибка при загрузке H2H:",t)}finally{d.value=!1}}}function M(){v.value=null,r.value=[],i.value=null,h.value=null,c.value=null,s.value=[]}async function T(){if(!(y.value.length>0)){_.value=!0,m.value=null;try{y.value=await u.getAllPlayersWithStatsOptimized()}catch(e){m.value=e.message,console.error("Ошибка при загрузке списка всех игроков:",e)}finally{_.value=!1}}}return{playerProfile:v,playerCareer:r,isLoading:g,error:p,careerStats:b,ratingHistory:k,keyMetrics:H,fetchPlayerData:O,clearPlayerData:M,playerList:y,isLoadingList:_,errorList:m,fetchAllPlayers:T,opponentStats:i,openingStats:h,h2hStats:c,isLoadingAnalytics:d,processedOpponentStats:E,processedH2HStats:R,fetchPlayerAnalytics:B,fetchPlayerH2H:G,careerPerformanceStats:L,performanceByRounds:A,notableResults:D,participationInCurrentTournament:C}});export{F as u};
