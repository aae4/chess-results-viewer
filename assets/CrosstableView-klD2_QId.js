import{u as O,A as Q,c as V,a as u,d as P,l as g,b as o,r as i,w as l,C as U,H as W,f as d,e as s,g as x,M as w,D as E,F as A,i as N,t as _}from"./index-CyrSluM4.js";import{b as X,f as Y,c as M,d as Z}from"./formatters-C8Ln7w-r.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";function st(h,m){if(!h||h.length===0)return[];const p=new Map;return h.forEach(e=>{p.has(e.player_id)||p.set(e.player_id,{player_id:e.player_id,player_name:e.player_name,starting_rank:e.starting_rank,results:new Array(m).fill(null),games:[],totalPoints:0}),p.get(e.player_id).games.push(e)}),p.forEach(e=>{let v=0;e.games.forEach(r=>{if(!r.round)return;const B=parseInt(r.round)-1,y=X(Y(r.result,r.color));y!==null&&(v+=y);const I=p.get(r.opponent_player_id);e.results[B]={points:y,color:r.color,opponent_name:r.opponent_name,opponent_starting_rank:I?.starting_rank||"?",game_id:r.game_id,is_technical:r.is_technical,is_bye:r.is_bye}}),e.totalPoints=v}),Array.from(p.values()).sort((e,v)=>v.totalPoints!==e.totalPoints?v.totalPoints-e.totalPoints:e.starting_rank-v.starting_rank)}const nt={key:0,class:"text-center pa-10"},ot={class:"d-flex align-center"},et={class:"cell-example result-win"},lt={class:"cell-content"},at={class:"d-flex align-center"},it={class:"cell-example result-draw"},rt={class:"cell-content"},ct={class:"d-flex align-center"},dt={class:"cell-example result-loss"},_t={class:"cell-content is-technical"},pt={class:"crosstable-wrapper"},ut={class:"sticky-col rank-col text-center"},mt={class:"sticky-col player-col"},vt=["onClick","title"],ft=["onClick"],gt={class:"mr-1"},yt={class:"mr-1"},bt={key:3},kt={class:"sticky-col-right points-col text-center font-weight-bold"},xt={__name:"CrosstableView",setup(h){const m=O(),p=U(),T=W(),{mobile:e}=Q(),v=n=>{if(!n)return"";const t=n.replace(",","").split(" ").filter(Boolean);if(t.length>=2){const b=t[0],R=t[1];return`${b} ${R.charAt(0)}.`}return n},r=V(()=>{if(m.activeTournament?.rounds_count>0)return Array.from({length:m.activeTournament.rounds_count},(n,t)=>t+1);if(m.games?.length>0){const n=Math.max(...m.games.map(t=>parseInt(t.round)||0));return n>0?Array.from({length:n},(t,b)=>b+1):[1]}return[1]}),B=V(()=>st(m.crosstableData,r.value.length)),y=n=>{n&&p.push({name:"Player",params:{tournamentId:T.params.tournamentId,playerId:n}})},I=n=>{n&&n.game_id&&n.is_technical===0&&p.push({name:"Game",params:{gameId:n.game_id}})},$=n=>n?n.points===1?"result-win":n.points===.5?"result-draw":n.points===0?"result-loss":"":"";return(n,t)=>{const b=i("v-progress-circular"),R=i("v-toolbar-title"),D=i("v-spacer"),F=i("v-btn"),L=i("v-list-subheader"),k=i("v-icon"),C=i("v-list-item"),S=i("v-list"),G=i("v-menu"),H=i("v-toolbar"),j=i("v-divider"),z=i("v-tooltip"),q=i("v-table"),J=i("v-card");return d(),u("div",null,[g(m).isLoadingDetails?(d(),u("div",nt,[o(b,{indeterminate:"",color:"primary"})])):(d(),P(J,{key:1},{default:l(()=>[o(H,{flat:"",density:"compact"},{default:l(()=>[o(R,{class:"text-subtitle-1 font-weight-bold"},{default:l(()=>[...t[0]||(t[0]=[x("Кросс-таблица",-1)])]),_:1}),o(D),o(G,{location:"bottom end"},{activator:l(({props:c})=>[o(F,w(c,{icon:"mdi-help-circle-outline",variant:"text"}),null,16)]),default:l(()=>[o(S,{density:"compact",class:"legend-list"},{default:l(()=>[o(L,null,{default:l(()=>[...t[1]||(t[1]=[x("УСЛОВНЫЕ ОБОЗНАЧЕНИЯ",-1)])]),_:1}),o(C,null,{default:l(()=>[s("div",ot,[s("div",et,[s("div",lt,[t[2]||(t[2]=x("18",-1)),o(k,{icon:"mdi-circle-outline",size:"x-small",class:"ml-1"})])]),t[3]||(t[3]=s("div",{class:"ml-3 text-caption"},"Победа над №18 белыми",-1))])]),_:1}),o(C,null,{default:l(()=>[s("div",at,[s("div",it,[s("div",rt,[t[4]||(t[4]=x("19",-1)),o(k,{icon:"mdi-circle",size:"x-small",class:"ml-1"})])]),t[5]||(t[5]=s("div",{class:"ml-3 text-caption"},"Ничья с №19 черными",-1))])]),_:1}),o(C,null,{default:l(()=>[s("div",ct,[s("div",dt,[s("div",_t,[t[6]||(t[6]=x("21",-1)),o(k,{icon:"mdi-circle",size:"x-small",class:"ml-1"})])]),t[7]||(t[7]=s("div",{class:"ml-3 text-caption"},"Технический результат",-1))])]),_:1}),o(C,null,{default:l(()=>[...t[8]||(t[8]=[s("div",{class:"d-flex align-center"},[s("div",{class:"cell-example result-win"},[s("div",{class:"cell-content font-weight-bold"},"+")]),s("div",{class:"ml-3 text-caption"},"Bye (пропуск тура)")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(j),s("div",pt,[o(q,{class:E(["crosstable",{"is-mobile":g(e)}]),density:"compact"},{default:l(()=>[s("thead",null,[s("tr",null,[t[9]||(t[9]=s("th",{class:"sticky-col rank-col"},"#",-1)),t[10]||(t[10]=s("th",{class:"sticky-col player-col"},"Игрок",-1)),(d(!0),u(A,null,N(r.value,c=>(d(),u("th",{key:c,class:"text-center round-col"},_(c),1))),128)),t[11]||(t[11]=s("th",{class:"sticky-col-right points-col"},"Очки",-1))])]),s("tbody",null,[(d(!0),u(A,null,N(B.value,c=>(d(),u("tr",{key:c.player_id},[s("td",ut,_(c.starting_rank),1),s("td",mt,[s("div",{onClick:a=>y(c.player_id),class:"player-link",title:c.player_name},_(g(e)?v(c.player_name):c.player_name),9,vt)]),(d(!0),u(A,null,N(c.results,(a,K)=>(d(),u("td",{key:K,class:E(["text-center round-col result-cell",$(a)]),onClick:f=>I(a)},[a&&a.is_bye?(d(),P(z,{key:0,location:"top"},{activator:l(({props:f})=>[s("div",w({ref_for:!0},f,{class:"cell-content font-weight-bold text-success"})," + ",16)]),default:l(()=>[t[12]||(t[12]=s("span",null,"Пропуск тура (Bye)",-1))]),_:1})):a&&a.is_technical?(d(),P(z,{key:1,location:"top"},{activator:l(({props:f})=>[s("div",w({ref_for:!0},f,{class:"cell-content font-weight-bold is-technical"}),[s("span",gt,_(a.opponent_starting_rank),1),o(k,{icon:g(M)(a.color),size:"x-small"},null,8,["icon"])],16)]),default:l(()=>[s("span",null,_(a.points===1?"Тех. победа":"Тех. поражение")+" vs "+_(a.opponent_name),1)]),_:2},1024)):a?(d(),P(z,{key:2,location:"top",disabled:!a.opponent_name},{activator:l(({props:f})=>[s("div",w({ref_for:!0},f,{class:"cell-content"}),[s("span",yt,_(a.opponent_starting_rank),1),o(k,{icon:g(M)(a.color),size:"x-small"},null,8,["icon"])],16)]),default:l(()=>[s("span",null,_(g(Z)(a.points))+" vs "+_(a.opponent_name),1)]),_:2},1032,["disabled"])):(d(),u("span",bt,"-"))],10,ft))),128)),s("td",kt,_(c.totalPoints),1)]))),128))])]),_:1},8,["class"])])]),_:1}))])}}},wt=tt(xt,[["__scopeId","data-v-1d6217bd"]]);export{wt as default};
