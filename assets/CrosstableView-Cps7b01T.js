import{_ as B,c as w,d as v,e as d,f as _,n as E,p as V,i as r,b as y,a as i,u as g,g as n,F as h,k as x,t as u,v as F,q as L,x as N}from"./index-BGOagHph.js";import{u as S}from"./tournamentStore-kFjarByM.js";import{a as z,b as G,c as $,d as q}from"./formatters-D4D2rNmP.js";const j={key:0,class:"text-center pa-10"},H={class:"text-center rank-col sticky-col"},J={class:"player-col sticky-col"},K=["onClick"],O=["onClick"],Q={class:"mr-1"},U={key:1},W={class:"text-center points-col font-weight-bold text-h6"},X={__name:"CrosstableView",setup(Y){const a=S(),b=E(),I=V(),C=w(()=>{if(a.activeTournament?.rounds_count>0)return Array.from({length:a.activeTournament.rounds_count},(s,o)=>o+1);if(a.games&&a.games.length>0){const s=Math.max(...a.games.map(o=>parseInt(o.round)||0));if(s>0)return Array.from({length:s},(o,m)=>m+1)}return[1]}),R=w(()=>{if(!a.crosstableData.length)return[];const s=new Map,o=Math.max(...a.games.map(t=>parseInt(t.round)||0));return a.crosstableData.forEach(t=>{s.has(t.player_id)||s.set(t.player_id,{player_id:t.player_id,player_name:t.player_name,starting_rank:t.starting_rank,results:new Array(o).fill(null),totalPoints:0})}),a.crosstableData.forEach(t=>{if(!t.round)return;const c=s.get(t.player_id),f=parseInt(t.round)-1,p=z(G(t.result,t.color));p!==null&&(c.totalPoints+=p);const k=s.get(t.opponent_player_id);c.results[f]={points:p,color:t.color,opponent_name:t.opponent_name,opponent_starting_rank:k?.starting_rank||"?",game_id:t.game_id}}),Array.from(s.values()).sort((t,c)=>c.totalPoints!==t.totalPoints?c.totalPoints-t.totalPoints:t.starting_rank-c.starting_rank)}),D=s=>{s&&b.push({name:"Player",params:{tournamentId:I.params.tournamentId,playerId:s}})},M=s=>{!s||!s.game_id||b.push({name:"Game",params:{gameId:s.game_id}})},T=s=>s?s.points===1?"result-win":s.points===.5?"result-draw":s.points===0?"result-loss":"":"";return(s,o)=>{const m=_("v-progress-circular"),t=_("v-icon"),c=_("v-tooltip"),f=_("v-table"),p=_("v-card-text"),k=_("v-card");return r(),v(k,null,{default:d(()=>[y(p,{class:"crosstable-wrapper pa-0"},{default:d(()=>[g(a).isLoadingDetails?(r(),i("div",j,[y(m,{indeterminate:"",color:"primary"})])):(r(),v(f,{key:1,class:"crosstable",density:"compact"},{default:d(()=>[n("thead",null,[n("tr",null,[o[0]||(o[0]=n("th",{class:"rank-col sticky-col"},"#",-1)),o[1]||(o[1]=n("th",{class:"player-col sticky-col"},"Игрок",-1)),(r(!0),i(h,null,x(C.value,e=>(r(),i("th",{key:e,class:"text-center round-col"},u(e),1))),128)),o[2]||(o[2]=n("th",{class:"text-center points-col"},"Очки",-1))])]),n("tbody",null,[(r(!0),i(h,null,x(R.value,e=>(r(),i("tr",{key:e.player_id},[n("td",H,u(e.starting_rank),1),n("td",J,[n("a",{href:"#",onClick:F(A=>D(e.player_id),["prevent"]),class:"player-link text-subtitle-1 font-weight-medium"},u(e.player_name),9,K)]),(r(!0),i(h,null,x(C.value,(A,l)=>(r(),i("td",{key:l,class:L(["text-center round-col result-cell",T(e.results[l])]),onClick:P=>M(e.results[l])},[e.results[l]?(r(),v(c,{key:0,location:"top",disabled:!e.results[l].opponent_name},{activator:d(({props:P})=>[n("div",N({ref_for:!0},P,{class:"cell-content"}),[n("span",Q,u(e.results[l].opponent_starting_rank),1),y(t,{icon:g(q)(e.results[l].color),size:"x-small"},null,8,["icon"])],16)]),default:d(()=>[n("span",null,u(g($)(e.results[l].points))+" vs "+u(e.results[l].opponent_name),1)]),_:2},1032,["disabled"])):(r(),i("span",U,"-"))],10,O))),128)),n("td",W,u(e.totalPoints),1)]))),128))])]),_:1}))]),_:1})]),_:1})}}},et=B(X,[["__scopeId","data-v-b9e6f060"]]);export{et as default};
