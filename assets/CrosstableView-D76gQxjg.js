import{_ as w,c as R,d as h,e as f,f as d,n as F,p as L,i as a,b as y,a as _,u as x,g as n,F as b,k as C,t as p,v as N,q as S,x as z}from"./index-CQPj8-Ml.js";import{u as G}from"./tournamentStore-BbypOPIx.js";import{a as $,b as q,c as D,d as j}from"./formatters-D4D2rNmP.js";function H(g,i){if(!g||g.length===0)return[];const l=new Map;return g.forEach(t=>{l.has(t.player_id)||l.set(t.player_id,{player_id:t.player_id,player_name:t.player_name,starting_rank:t.starting_rank,results:new Array(i).fill(null),games:[],totalPoints:0}),l.get(t.player_id).games.push(t)}),l.forEach(t=>{let u=0;t.games.forEach(o=>{if(!o.round||!o.opponent_player_id)return;const k=parseInt(o.round)-1,m=$(q(o.result,o.color));m!==null&&(u+=m);const e=l.get(o.opponent_player_id);t.results[k]={points:m,color:o.color,opponent_name:o.opponent_name,opponent_starting_rank:e?.starting_rank||"?",game_id:o.game_id}}),t.totalPoints=u}),Array.from(l.values()).sort((t,u)=>u.totalPoints!==t.totalPoints?u.totalPoints-t.totalPoints:t.starting_rank-u.starting_rank)}const J={key:0,class:"text-center pa-10"},K={class:"text-center rank-col sticky-col"},O={class:"player-col sticky-col"},Q=["onClick"],U=["onClick"],W={class:"mr-1"},X={key:1},Y={class:"text-center points-col font-weight-bold text-h6"},Z={__name:"CrosstableView",setup(g){const i=G(),l=F(),P=L(),t=R(()=>{if(i.activeTournament?.rounds_count>0)return Array.from({length:i.activeTournament.rounds_count},(e,r)=>r+1);if(i.games?.length>0){const e=Math.max(...i.games.map(r=>parseInt(r.round)||0));return e>0?Array.from({length:e},(r,v)=>v+1):[1]}return[1]}),u=R(()=>H(i.crosstableData,t.value.length)),o=e=>{e&&l.push({name:"Player",params:{tournamentId:P.params.tournamentId,playerId:e}})},k=e=>{!e||!e.game_id||l.push({name:"Game",params:{gameId:e.game_id}})},m=e=>e?e.points===1?"result-win":e.points===.5?"result-draw":e.points===0?"result-loss":"":"";return(e,r)=>{const v=d("v-progress-circular"),T=d("v-icon"),A=d("v-tooltip"),B=d("v-table"),E=d("v-card-text"),M=d("v-card");return a(),h(M,null,{default:f(()=>[y(E,{class:"crosstable-wrapper pa-0"},{default:f(()=>[x(i).isLoadingDetails?(a(),_("div",J,[y(v,{indeterminate:"",color:"primary"})])):(a(),h(B,{key:1,class:"crosstable",density:"compact"},{default:f(()=>[n("thead",null,[n("tr",null,[r[0]||(r[0]=n("th",{class:"rank-col sticky-col"},"#",-1)),r[1]||(r[1]=n("th",{class:"player-col sticky-col"},"Игрок",-1)),(a(!0),_(b,null,C(t.value,s=>(a(),_("th",{key:s,class:"text-center round-col"},p(s),1))),128)),r[2]||(r[2]=n("th",{class:"text-center points-col"},"Очки",-1))])]),n("tbody",null,[(a(!0),_(b,null,C(u.value,s=>(a(),_("tr",{key:s.player_id},[n("td",K,p(s.starting_rank),1),n("td",O,[n("a",{href:"#",onClick:N(V=>o(s.player_id),["prevent"]),class:"player-link text-subtitle-1 font-weight-medium"},p(s.player_name),9,Q)]),(a(!0),_(b,null,C(t.value,(V,c)=>(a(),_("td",{key:c,class:S(["text-center round-col result-cell",m(s.results[c])]),onClick:I=>k(s.results[c])},[s.results[c]?(a(),h(A,{key:0,location:"top",disabled:!s.results[c].opponent_name},{activator:f(({props:I})=>[n("div",z({ref_for:!0},I,{class:"cell-content"}),[n("span",W,p(s.results[c].opponent_starting_rank),1),y(T,{icon:x(j)(s.results[c].color),size:"x-small"},null,8,["icon"])],16)]),default:f(()=>[n("span",null,p(x(D)(s.results[c].points))+" vs "+p(s.results[c].opponent_name),1)]),_:2},1032,["disabled"])):(a(),_("span",X,"-"))],10,U))),128)),n("td",Y,p(s.totalPoints),1)]))),128))])]),_:1}))]),_:1})]),_:1})}}},nt=w(Z,[["__scopeId","data-v-04a592a1"]]);export{nt as default};
