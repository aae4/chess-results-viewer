import{f as R,a as x,b as A}from"./formatters-D4D2rNmP.js";import{C as W}from"./chess-DX7QKCjj.js";function G(s){let i="";for(let e=0;e<s.length;e++)e%2===0&&(i+=`${Math.floor(e/2)+1}. `),i+=`${s[e]} `;return i.trim()}function B({playerGames:s,ecoDatabase:i}){const e={colorStats:{white:{games:0,points:0,percent:0},black:{games:0,points:0,percent:0}},openingStats:[]};if(!s||s.length===0||!i)return e;const h={};return s.forEach(l=>{const u=x(A(l.result,l.color));if(u!==null&&(l.color==="w"?(e.colorStats.white.games++,e.colorStats.white.points+=u):l.color==="b"&&(e.colorStats.black.games++,e.colorStats.black.points+=u),l.pgn_moves))try{const g=new W;g.loadPgn(l.pgn_moves);const w=g.history();let f=null;for(let r=Math.min(w.length,20);r>0;r--){const d=G(w.slice(0,r));if(i[d]){f=i[d];break}}if(f){const r=f.e;h[r]||(h[r]={eco:r,name:f.n,count:0,points:0}),h[r].count++,h[r].points+=u}}catch{}}),e.colorStats.white.games>0&&(e.colorStats.white.percent=e.colorStats.white.points/e.colorStats.white.games*100),e.colorStats.black.games>0&&(e.colorStats.black.percent=e.colorStats.black.points/e.colorStats.black.games*100),e.openingStats=Object.values(h).sort((l,u)=>u.count-l.count||u.points-l.points),e}function H({participants:s,gamesForStats:i,standings:e,tournamentDetails:h,ecoDatabase:l}){if(!s?.length||!i?.length||!e?.length||!l)return null;const u=s.length,g=h?.rounds_count||0,w=Math.round(s.reduce((t,o)=>t+(o.rating||0),0)/s.length);let f=0,r=0,d=0,b={moves:1/0,game:null},S={moves:0,game:null},P=0,v=0,M=0,O=0;const p={},y={};i.forEach(t=>{const o=R(t.result);if(o==="1-0"?f++:o==="0-1"?r++:o==="½-½"&&(d++,y[t.white_player_id]=(y[t.white_player_id]||0)+1,y[t.black_player_id]=(y[t.black_player_id]||0)+1),t.pgn_moves)try{const a=new W;a.loadPgn(t.pgn_moves);const c=a.history(),_=Math.ceil(c.length/2);_>0&&(v++,P+=_,_<b.moves&&(b={moves:_,game:t}),_>S.moves&&(S={moves:_,game:t})),c.forEach(n=>{(n==="O-O"||n==="O-O-O")&&M++,n.includes("=")&&O++});let k=null;for(let n=Math.min(c.length,20);n>0;n--){const C=G(c.slice(0,n));if(l[C]){k=l[C];break}}if(k){const n=k.e;p[n]||(p[n]={eco:n,name:k.n,count:0,white:0,draw:0,black:0}),p[n].count++,o==="1-0"?p[n].white++:o==="0-1"?p[n].black++:o==="½-½"&&p[n].draw++}}catch{}});const m=f+r+d,E={whiteWins:f,blackWins:r,draws:d,whiteWinPercent:m>0?Math.round(f/m*100):0,blackWinPercent:m>0?Math.round(r/m*100):0,drawPercent:m>0?Math.round(d/m*100):0},T=e.filter(t=>t.performance_rating&&t.rating_at_tournament).map(t=>({player:t,diff:t.performance_rating-t.rating_at_tournament})).sort((t,o)=>o.diff-t.diff)[0],j=s.map(t=>{const o=i.filter(c=>c.white_player_id===t.id||c.black_player_id===t.id).length,a=y[t.id]||0;return{player:t,drawRate:o>0?a/o*100:100}}).sort((t,o)=>t.drawRate-o.drawRate)[0],I=e.filter(t=>!i.filter(a=>a.white_player_id===t.player_id||a.black_player_id===t.player_id).some(a=>{const c=R(a.result);return a.white_player_id===t.player_id&&c==="0-1"||a.black_player_id===t.player_id&&c==="1-0"})),$=Object.values(p).sort((t,o)=>o.count-t.count||t.name.localeCompare(o.name)).slice(0,10);return{totalPlayers:u,totalRounds:g,averageRating:w,resultDistribution:E,shortestGame:b,longestGame:S,averageMoveCount:v>0?Math.round(P/v):0,biggestOverperformer:T,undefeatedPlayers:I,mostDecisivePlayer:j,topOpenings:$,totalCastles:M,totalPromotions:O}}export{B as a,H as c};
