import{m as Ht,j as Pe,P as at,a as N,o as Ft,k as lt,f as P,e as C,d as Te,h as xe,D as Me,x as Wt,F as Ue,i as Qe,r as R,b as w,w as W,g as ze,t as ee,u as xo,A as To,c as ie,p as Ao,l as ae}from"./index-C7cLTlNq.js";import{C as Ve,h as Io}from"./chess-f0FuLRjZ.js";import{a as qo,e as He}from"./formatters-C8Ln7w-r.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const No={class:"promotion-dialog",open:""},Lo=["aria-label","onClick","onTouchstartPassive"],Do=Ht({__name:"PromotionDialog",props:{state:{}},emits:["promotionSelected"],setup(e,{emit:t}){const o=e,r=[{name:"Queen",data:"q"},{name:"Knight",data:"n"},{name:"Rook",data:"r"},{name:"Bishop",data:"b"}];function s(n){o.state.callback?.(n.data),t("promotionSelected")}return(n,i)=>(P(),N("dialog",No,[(P(),N(Ue,null,Qe(r,a=>C("button",{key:a.name,type:"button",class:Me([a.name.toLowerCase(),n.state.color]),"aria-label":a.name,onClick:l=>s(a),onTouchstartPassive:l=>s(a)},null,42,Lo)),64))]))}});const B="w",J="b",D="p",ct="n",Ge="b",Le="r",ge="q",O="k",tt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Q=-1,Oo={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Ro=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],_={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},b={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ot={b:[16,32,17,15],w:[-16,-32,-17,-15]},xt={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Ko=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],$o=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Bo={p:1,n:2,b:4,r:8,q:16,k:32},Vo="pnbrqkPNBRQK",Tt=[ct,Ge,Le,ge],Ho=7,Fo=6,Wo=1,jo=0,Fe={[O]:_.KSIDE_CASTLE,[ge]:_.QSIDE_CASTLE},he={w:[{square:b.a1,flag:_.QSIDE_CASTLE},{square:b.h1,flag:_.KSIDE_CASTLE}],b:[{square:b.a8,flag:_.QSIDE_CASTLE},{square:b.h8,flag:_.KSIDE_CASTLE}]},Go={b:Wo,w:Fo},Uo=["1-0","0-1","1/2-1/2","*"];function ye(e){return e>>4}function De(e){return e&15}function jt(e){return"0123456789".indexOf(e)!==-1}function z(e){const t=De(e),o=ye(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(o,o+1)}function Ie(e){return e===B?J:B}function Qo(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const o=parseInt(t[5],10);if(isNaN(o)||o<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const s=t[0].split("/");if(s.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let i=0;i<s.length;i++){let a=0,l=!1;for(let c=0;c<s[i].length;c++)if(jt(s[i][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(s[i][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(s[i][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,l=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:i,regex:a}of n){if(!a.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${i} king`};if((t[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${i} kings`}}return{ok:!0}}function zo(e,t){const o=e.from,r=e.to,s=e.piece;let n=0,i=0,a=0;for(let l=0,c=t.length;l<c;l++){const f=t[l].from,d=t[l].to,u=t[l].piece;s===u&&o!==f&&r===d&&(n++,ye(o)===ye(f)&&i++,De(o)===De(f)&&a++)}return n>0?i>0&&a>0?z(o):a>0?z(o).charAt(1):z(o).charAt(0):""}function pe(e,t,o,r,s,n=void 0,i=_.NORMAL){const a=ye(r);if(s===D&&(a===Ho||a===jo))for(let l=0;l<Tt.length;l++){const c=Tt[l];e.push({color:t,from:o,to:r,piece:s,captured:n,promotion:c,flags:i|_.PROMOTION})}else e.push({color:t,from:o,to:r,piece:s,captured:n,flags:i})}function At(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:D:(t=t.toLowerCase(),t==="o"?O:t)}function rt(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Zo{_board=new Array(128);_turn=B;_header={};_kings={w:Q,b:Q};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};constructor(t=tt){this.load(t)}clear(t=!1){this._board=new Array(128),this._kings={w:Q,b:Q},this._turn=B,this._castling={w:0,b:0},this._epSquare=Q,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{},this._updateSetup(this.fen())}removeHeader(t){t in this._header&&delete this._header[t]}load(t,o=!1){let r=t.split(/\s+/);if(r.length>=2&&r.length<6){const l=["-","-","0","1"];t=r.concat(l.slice(-(6-r.length))).join(" ")}r=t.split(/\s+/);const{ok:s,error:n}=Qo(t);if(!s)throw new Error(n);const i=r[0];let a=0;this.clear(o);for(let l=0;l<i.length;l++){const c=i.charAt(l);if(c==="/")a+=8;else if(jt(c))a+=parseInt(c,10);else{const f=c<"a"?B:J;this.put({type:c.toLowerCase(),color:f},z(a)),a++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=_.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=_.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=_.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=_.QSIDE_CASTLE),this._epSquare=r[3]==="-"?Q:b[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._updateSetup(this.fen())}fen(){let t=0,o="";for(let n=b.a8;n<=b.h1;n++){if(this._board[n]){t>0&&(o+=t,t=0);const{color:i,type:a}=this._board[n];o+=i===B?a.toUpperCase():a.toLowerCase()}else t++;n+1&136&&(t>0&&(o+=t),n!==b.h1&&(o+="/"),t=0,n+=8)}let r="";this._castling[B]&_.KSIDE_CASTLE&&(r+="K"),this._castling[B]&_.QSIDE_CASTLE&&(r+="Q"),this._castling[J]&_.KSIDE_CASTLE&&(r+="k"),this._castling[J]&_.QSIDE_CASTLE&&(r+="q"),r=r||"-";let s="-";if(this._epSquare!==Q){const n=this._epSquare+(this._turn===B?16:-16),i=[n+1,n-1];for(const a of i){if(a&136)continue;const l=this._turn;if(this._board[a]?.color===l&&this._board[a]?.type===D){this._makeMove({color:l,from:a,to:this._epSquare,piece:D,captured:D,flags:_.EP_CAPTURE});const c=!this._isKingAttacked(l);if(this._undoMove(),c){s=z(this._epSquare);break}}}}return[o,this._turn,r,s,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(t){this._history.length>0||(t!==tt?(this._header.SetUp="1",this._header.FEN=t):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(tt)}get(t){return this._board[b[t]]||!1}put({type:t,color:o},r){if(Vo.indexOf(t.toLowerCase())===-1||!(r in b))return!1;const s=b[r];return t==O&&!(this._kings[o]==Q||this._kings[o]==s)?!1:(this._board[s]={type:t,color:o},t===O&&(this._kings[o]=s),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(t){const o=this.get(t);return delete this._board[b[t]],o&&o.type===O&&(this._kings[o.color]=Q),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),o}_updateCastlingRights(){const t=this._board[b.e1]?.type===O&&this._board[b.e1]?.color===B,o=this._board[b.e8]?.type===O&&this._board[b.e8]?.color===J;(!t||this._board[b.a1]?.type!==Le||this._board[b.a1]?.color!==B)&&(this._castling.w&=-65),(!t||this._board[b.h1]?.type!==Le||this._board[b.h1]?.color!==B)&&(this._castling.w&=-33),(!o||this._board[b.a8]?.type!==Le||this._board[b.a8]?.color!==J)&&(this._castling.b&=-65),(!o||this._board[b.h8]?.type!==Le||this._board[b.h8]?.color!==J)&&(this._castling.b&=-33)}_updateEnPassantSquare(){if(this._epSquare===Q)return;const t=this._epSquare+(this._turn===B?-16:16),o=this._epSquare+(this._turn===B?16:-16),r=[o+1,o-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[o]?.color!==Ie(this._turn)||this._board[o]?.type!==D){this._epSquare=Q;return}const s=n=>!(n&136)&&this._board[n]?.color===this._turn&&this._board[n]?.type===D;r.some(s)||(this._epSquare=Q)}_attacked(t,o){for(let r=b.a8;r<=b.h1;r++){if(r&136){r+=7;continue}if(this._board[r]===void 0||this._board[r].color!==t)continue;const s=this._board[r],n=r-o;if(n===0)continue;const i=n+119;if(Ko[i]&Bo[s.type]){if(s.type===D){if(n>0){if(s.color===B)return!0}else if(s.color===J)return!0;continue}if(s.type==="n"||s.type==="k")return!0;const a=$o[i];let l=r+a,c=!1;for(;l!==o;){if(this._board[l]!=null){c=!0;break}l+=a}if(!c)return!0}}return!1}_isKingAttacked(t){const o=this._kings[t];return o===-1?!1:this._attacked(Ie(t),o)}isAttacked(t,o){return this._attacked(o,b[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},o=[];let r=0,s=0;for(let n=b.a8;n<=b.h1;n++){if(s=(s+1)%2,n&136){n+=7;continue}const i=this._board[n];i&&(t[i.type]=i.type in t?t[i.type]+1:1,i.type===Ge&&o.push(s),r++)}if(r===2||r===3&&(t[Ge]===1||t[ct]===1))return!0;if(r===t[Ge]+2){let n=0;const i=o.length;for(let a=0;a<i;a++)n+=o[a];if(n===0||n===i)return!0}return!1}isThreefoldRepetition(){const t=[],o={};let r=!1;for(;;){const s=this._undoMove();if(!s)break;t.push(s)}for(;;){const s=this.fen().split(" ").slice(0,4).join(" ");o[s]=s in o?o[s]+1:1,o[s]>=3&&(r=!0);const n=t.pop();if(n)this._makeMove(n);else break}return r}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:t=!1,square:o=void 0,piece:r=void 0}={}){const s=this._moves({square:o,piece:r});return t?s.map(n=>this._makePretty(n)):s.map(n=>this._moveToSan(n,s))}_moves({legal:t=!0,piece:o=void 0,square:r=void 0}={}){const s=r?r.toLowerCase():void 0,n=o?.toLowerCase(),i=[],a=this._turn,l=Ie(a);let c=b.a8,f=b.h1,d=!1;if(s)if(s in b)c=f=b[s],d=!0;else return[];for(let h=c;h<=f;h++){if(h&136){h+=7;continue}if(!this._board[h]||this._board[h].color===l)continue;const{type:p}=this._board[h];let g;if(p===D){if(n&&n!==p)continue;g=h+ot[a][0],this._board[g]||(pe(i,a,h,g,D),g=h+ot[a][1],Go[a]===ye(h)&&!this._board[g]&&pe(i,a,h,g,D,void 0,_.BIG_PAWN));for(let S=2;S<4;S++)g=h+ot[a][S],!(g&136)&&(this._board[g]?.color===l?pe(i,a,h,g,D,this._board[g].type,_.CAPTURE):g===this._epSquare&&pe(i,a,h,g,D,D,_.EP_CAPTURE))}else{if(n&&n!==p)continue;for(let S=0,x=xt[p].length;S<x;S++){const m=xt[p][S];for(g=h;g+=m,!(g&136);){if(!this._board[g])pe(i,a,h,g,p);else{if(this._board[g].color===a)break;pe(i,a,h,g,p,this._board[g].type,_.CAPTURE);break}if(p===ct||p===O)break}}}}if((n===void 0||n===O)&&(!d||f===this._kings[a])){if(this._castling[a]&_.KSIDE_CASTLE){const h=this._kings[a],p=h+2;!this._board[h+1]&&!this._board[p]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,h+1)&&!this._attacked(l,p)&&pe(i,a,this._kings[a],p,O,void 0,_.KSIDE_CASTLE)}if(this._castling[a]&_.QSIDE_CASTLE){const h=this._kings[a],p=h-2;!this._board[h-1]&&!this._board[h-2]&&!this._board[h-3]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,h-1)&&!this._attacked(l,p)&&pe(i,a,this._kings[a],p,O,void 0,_.QSIDE_CASTLE)}}if(!t||this._kings[a]===-1)return i;const u=[];for(let h=0,p=i.length;h<p;h++)this._makeMove(i[h]),this._isKingAttacked(a)||u.push(i[h]),this._undoMove();return u}move(t,{strict:o=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,o);else if(typeof t=="object"){const n=this._moves();for(let i=0,a=n.length;i<a;i++)if(t.from===z(n[i].from)&&t.to===z(n[i].to)&&(!("promotion"in n[i])||t.promotion===n[i].promotion)){r=n[i];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const s=this._makePretty(r);return this._makeMove(r),s}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(t){const o=this._turn,r=Ie(o);if(this._push(t),this._board[t.to]=this._board[t.from],delete this._board[t.from],t.flags&_.EP_CAPTURE&&(this._turn===J?delete this._board[t.to-16]:delete this._board[t.to+16]),t.promotion&&(this._board[t.to]={type:t.promotion,color:o}),this._board[t.to].type===O){if(this._kings[o]=t.to,t.flags&_.KSIDE_CASTLE){const s=t.to-1,n=t.to+1;this._board[s]=this._board[n],delete this._board[n]}else if(t.flags&_.QSIDE_CASTLE){const s=t.to+1,n=t.to-2;this._board[s]=this._board[n],delete this._board[n]}this._castling[o]=0}if(this._castling[o]){for(let s=0,n=he[o].length;s<n;s++)if(t.from===he[o][s].square&&this._castling[o]&he[o][s].flag){this._castling[o]^=he[o][s].flag;break}}if(this._castling[r]){for(let s=0,n=he[r].length;s<n;s++)if(t.to===he[r][s].square&&this._castling[r]&he[r][s].flag){this._castling[r]^=he[r][s].flag;break}}t.flags&_.BIG_PAWN?o===J?this._epSquare=t.to-16:this._epSquare=t.to+16:this._epSquare=Q,t.piece===D?this._halfMoves=0:t.flags&(_.CAPTURE|_.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,o===J&&this._moveNumber++,this._turn=r}undo(){const t=this._undoMove();return t?this._makePretty(t):null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;const o=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber;const r=this._turn,s=Ie(r);if(this._board[o.from]=this._board[o.to],this._board[o.from].type=o.piece,delete this._board[o.to],o.captured)if(o.flags&_.EP_CAPTURE){let n;r===J?n=o.to-16:n=o.to+16,this._board[n]={type:D,color:s}}else this._board[o.to]={type:o.captured,color:s};if(o.flags&(_.KSIDE_CASTLE|_.QSIDE_CASTLE)){let n,i;o.flags&_.KSIDE_CASTLE?(n=o.to+1,i=o.to-1):(n=o.to-2,i=o.to+1),this._board[n]=this._board[i],delete this._board[i]}return o}pgn({newline:t=`
`,maxWidth:o=0}={}){const r=[];let s=!1;for(const u in this._header)r.push("["+u+' "'+this._header[u]+'"]'+t),s=!0;s&&this._history.length&&r.push(t);const n=u=>{const h=this._comments[this.fen()];if(typeof h<"u"){const p=u.length>0?" ":"";u=`${u}${p}{${h}}`}return u},i=[];for(;this._history.length>0;)i.push(this._undoMove());const a=[];let l="";for(i.length===0&&a.push(n(""));i.length>0;){l=n(l);const u=i.pop();if(!u)break;if(!this._history.length&&u.color==="b"){const h=`${this._moveNumber}. ...`;l=l?`${l} ${h}`:h}else u.color==="w"&&(l.length&&a.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(u,this._moves({legal:!0})),this._makeMove(u)}if(l.length&&a.push(n(l)),typeof this._header.Result<"u"&&a.push(this._header.Result),o===0)return r.join("")+a.join(" ");const c=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},f=function(u,h){for(const p of h.split(" "))if(p){if(u+p.length>o){for(;c();)u--;r.push(t),u=0}r.push(p),u+=p.length,r.push(" "),u++}return c()&&u--,u};let d=0;for(let u=0;u<a.length;u++){if(d+a[u].length>o&&a[u].includes("{")){d=f(d,a[u]);continue}d+a[u].length>o&&u!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),d=0):u!==0&&(r.push(" "),d++),r.push(a[u]),d+=a[u].length}return r.join("")}header(...t){for(let o=0;o<t.length;o+=2)typeof t[o]=="string"&&typeof t[o+1]=="string"&&(this._header[t[o]]=t[o+1]);return this._header}loadPgn(t,{strict:o=!1,newlineChar:r=`\r?
`}={}){function s(m){return m.replace(/\\/g,"\\")}function n(m){const A={},H=m.split(new RegExp(s(r)));let I="",ne="";for(let K=0;K<H.length;K++){const y=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;I=H[K].replace(y,"$1"),ne=H[K].replace(y,"$2"),I.trim().length>0&&(A[I]=ne)}return A}t=t.trim();const i=new RegExp("^(\\[((?:"+s(r)+")|.)*\\])((?:\\s*"+s(r)+"){2}|(?:\\s*"+s(r)+")*$)").exec(t),a=i&&i.length>=2?i[1]:"";this.reset();const l=n(a);let c="";for(const m in l)m.toLowerCase()==="fen"&&(c=l[m]),this.header(m,l[m]);if(!o)c&&this.load(c,!0);else if(l.SetUp==="1"){if(!("FEN"in l))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(l.FEN,!0)}function f(m){return Array.from(m).map(function(A){return A.charCodeAt(0)<128?A.charCodeAt(0).toString(16):encodeURIComponent(A).replace(/%/g,"").toLowerCase()}).join("")}function d(m){return m.length==0?"":decodeURIComponent("%"+(m.match(/.{1,2}/g)||[]).join("%"))}const u=function(m){return m=m.replace(new RegExp(s(r),"g")," "),`{${f(m.slice(1,m.length-1))}}`},h=function(m){if(m.startsWith("{")&&m.endsWith("}"))return d(m.slice(1,m.length-1))};let p=t.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${s(r)}]*)`,"g"),function(m,A,H){return A!==void 0?u(A):" "+u(`{${H.slice(1)}}`)}).replace(new RegExp(s(r),"g")," ");const g=/(\([^()]+\))+?/g;for(;g.test(p);)p=p.replace(g,"");p=p.replace(/\d+\.(\.\.)?/g,""),p=p.replace(/\.\.\./g,""),p=p.replace(/\$\d+/g,"");let S=p.trim().split(new RegExp(/\s+/));S=S.filter(m=>m!=="");let x="";for(let m=0;m<S.length;m++){const A=h(S[m]);if(A!==void 0){this._comments[this.fen()]=A;continue}const H=this._moveFromSan(S[m],o);if(H==null)if(Uo.indexOf(S[m])>-1)x=S[m];else throw new Error(`Invalid move in PGN: ${S[m]}`);else x="",this._makeMove(H)}x&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",x)}_moveToSan(t,o){let r="";if(t.flags&_.KSIDE_CASTLE)r="O-O";else if(t.flags&_.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==D){const s=zo(t,o);r+=t.piece.toUpperCase()+s}t.flags&(_.CAPTURE|_.EP_CAPTURE)&&(t.piece===D&&(r+=z(t.from)[0]),r+="x"),r+=z(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,o=!1){const r=rt(t);let s=At(r),n=this._moves({legal:!0,piece:s});for(let u=0,h=n.length;u<h;u++)if(r===rt(this._moveToSan(n[u],n)))return n[u];if(o)return null;let i,a,l,c,f,d=!1;if(a=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(i=a[1],l=a[2],c=a[3],f=a[4],l.length==1&&(d=!0)):(a=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(i=a[1],l=a[2],c=a[3],f=a[4],l.length==1&&(d=!0))),s=At(r),n=this._moves({legal:!0,piece:i||s}),!c)return null;for(let u=0,h=n.length;u<h;u++)if(l){if((!i||i.toLowerCase()==n[u].piece)&&b[l]==n[u].from&&b[c]==n[u].to&&(!f||f.toLowerCase()==n[u].promotion))return n[u];if(d){const p=z(n[u].from);if((!i||i.toLowerCase()==n[u].piece)&&b[c]==n[u].to&&(l==p[0]||l==p[1])&&(!f||f.toLowerCase()==n[u].promotion))return n[u]}}else if(r===rt(this._moveToSan(n[u],n)).replace("x",""))return n[u];return null}ascii(){let t=`   +------------------------+
`;for(let o=b.a8;o<=b.h1;o++){if(De(o)===0&&(t+=" "+"87654321"[ye(o)]+" |"),this._board[o]){const r=this._board[o].type,s=this._board[o].color===B?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";o+1&136&&(t+=`|
`,o+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const o=this._moves({legal:!1});let r=0;const s=this._turn;for(let n=0,i=o.length;n<i;n++)this._makeMove(o[n]),this._isKingAttacked(s)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}_makePretty(t){const{color:o,piece:r,from:s,to:n,flags:i,captured:a,promotion:l}=t;let c="";for(const h in _)_[h]&i&&(c+=Oo[h]);const f=z(s),d=z(n),u={color:o,piece:r,from:f,to:d,san:this._moveToSan(t,this._moves({legal:!0})),flags:c,lan:f+d,before:this.fen(),after:""};return this._makeMove(t),u.after=this.fen(),this._undoMove(),a&&(u.captured=a),l&&(u.promotion=l,u.lan+=l),u}turn(){return this._turn}board(){const t=[];let o=[];for(let r=b.a8;r<=b.h1;r++)this._board[r]==null?o.push(null):o.push({square:z(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(o),o=[],r+=8);return t}squareColor(t){if(t in b){const o=b[t];return(ye(o)+De(o))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const o=[],r=[];for(;this._history.length>0;)o.push(this._undoMove());for(;;){const s=o.pop();if(!s)break;t?r.push(this._makePretty(s)):r.push(this._moveToSan(s,this._moves())),this._makeMove(s)}return r}_pruneComments(){const t=[],o={},r=s=>{s in this._comments&&(o[s]=this._comments[s])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const s=t.pop();if(!s)break;this._makeMove(s),r(this.fen())}this._comments=o}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const o=this._comments[t];return delete this._comments[t],{fen:t,comment:o}})}setCastlingRights(t,o){for(const s of[O,ge])o[s]!==void 0&&(o[s]?this._castling[t]|=Fe[s]:this._castling[t]&=~Fe[s]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(o[O]===void 0||o[O]===r[O])&&(o[ge]===void 0||o[ge]===r[ge])}getCastlingRights(t){return{[O]:(this._castling[t]&Fe[O])!==0,[ge]:(this._castling[t]&Fe[ge])!==0}}moveNumber(){return this._moveNumber}}function Yo(e){const t=[];for(const o of e)t.push({orig:o.to,brush:"yellow"}),o.captured&&t.push({orig:o.from,dest:o.to,brush:"red"}),o.san.includes("+")&&t.push({orig:o.from,dest:o.to,brush:"blue"});return t}function We(e){return e==="w"?"white":"black"}function It(e){const t=new Map;for(const o of Ro){const r=e.moves({square:o,verbose:!0});r.length&&t.set(r[0].from,r.map(s=>s.to))}return t}function Xo(e,t){if(t?.type!=="p")return!1;const o=t?.color==="w"?"8":"1";return e[1]===o}function Oe(e){return!!e&&e instanceof Object&&!(e instanceof Array)&&!(e instanceof Function)}function Ze(e){return Oe(e)?Object.fromEntries(Object.entries(e).map(([t,o])=>[t,Ze(o)])):e}function Gt(e,t){const o={...e,...t};for(const r in o)o[r]=Oe(e?.[r])&&Oe(t?.[r])?Gt(e[r],t[r]):Ze(o[r]);return o}function Ut(e,t){const o={};for(const r in t)if(Oe(e?.[r])&&Oe(t?.[r])){const s=Ut(e[r],t[r]);Object.keys(s).length>0&&(o[r]=s)}else e?.[r]!==t[r]&&(o[r]=t[r]);return o}const Jo={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"},er=new Map([["b1",["a3","c3"]],["g1",["f3","h3"]],["a2",["a3","a4"]],["b2",["b3","b4"]],["c2",["c3","c4"]],["d2",["d3","d4"]],["e2",["e3","e4"]],["f2",["f3","f4"]],["g2",["g3","g4"]],["h2",["h3","h4"]]]),tr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",or={fen:tr,orientation:"white",turnColor:"white",coordinates:!1,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:300},lastMove:void 0,movable:{free:!1,color:"white",showDests:!0,dests:er,events:{after:()=>{},afterNewPiece:void 0},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{set:void 0,unset:void 0}},predroppable:{enabled:!1,events:{set:void 0,unset:void 0}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},events:{change:void 0,move:void 0,dropNewPiece:void 0,select:void 0,insert:void 0},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}}}},rr=["white","black"],gt=["a","b","c","d","e","f","g","h"],mt=["1","2","3","4","5","6","7","8"],sr=[...mt].reverse(),vt=Array.prototype.concat(...gt.map(e=>mt.map(t=>e+t))),te=e=>vt[8*e[0]+e[1]],T=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Qt=vt.map(T);function nr(e){let t;const o=()=>(t===void 0&&(t=e()),t);return o.clear=()=>{t=void 0},o}const ir=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},bt=e=>e==="white"?"black":"white",Re=(e,t)=>{const o=e[0]-t[0],r=e[1]-t[1];return o*o+r*r},ut=(e,t)=>e.role===t.role&&e.color===t.color,Ke=e=>(t,o)=>[(o?t[0]:7-t[0])*e.width/8,(o?7-t[1]:t[1])*e.height/8],se=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},zt=(e,t,o=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${o})`},_t=(e,t)=>{e.style.visibility=t?"visible":"hidden"},Ce=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Zt=e=>e.buttons===2||e.button===2,ce=(e,t)=>{const o=document.createElement(e);return t&&(o.className=t),o};function Yt(e,t,o){const r=T(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[o.left+o.width*r[0]/8+o.width/16,o.top+o.height*(7-r[1])/8+o.height/16]}const ke=(e,t)=>Math.abs(e-t),ar=e=>(t,o,r,s)=>ke(t,r)<2&&(e==="white"?s===o+1||o<=1&&s===o+2&&t===r:s===o-1||o>=6&&s===o-2&&t===r),Xt=(e,t,o,r)=>{const s=ke(e,o),n=ke(t,r);return s===1&&n===2||s===2&&n===1},Jt=(e,t,o,r)=>ke(e,o)===ke(t,r),eo=(e,t,o,r)=>e===o||t===r,to=(e,t,o,r)=>Jt(e,t,o,r)||eo(e,t,o,r),lr=(e,t,o)=>(r,s,n,i)=>ke(r,n)<2&&ke(s,i)<2||o&&s===i&&s===(e==="white"?0:7)&&(r===4&&(n===2&&t.includes(0)||n===6&&t.includes(7))||t.includes(n));function cr(e,t){const o=t==="white"?"1":"8",r=[];for(const[s,n]of e)s[1]===o&&n.color===t&&n.role==="rook"&&r.push(T(s)[0]);return r}function oo(e,t,o){const r=e.get(t);if(!r)return[];const s=T(t),n=r.role,i=n==="pawn"?ar(r.color):n==="knight"?Xt:n==="bishop"?Jt:n==="rook"?eo:n==="queen"?to:lr(r.color,cr(e,r.color),o);return Qt.filter(a=>(s[0]!==a[0]||s[1]!==a[1])&&i(s[0],s[1],a[0],a[1])).map(te)}function j(e,...t){e&&setTimeout(()=>e(...t),1)}function ur(e){e.orientation=bt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function dr(e,t){for(const[o,r]of t)r?e.pieces.set(o,r):e.pieces.delete(o)}function hr(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[o,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=o)}function pr(e,t,o,r){ve(e),e.premovable.current=[t,o],j(e.premovable.events.set,t,o,r)}function me(e){e.premovable.current&&(e.premovable.current=void 0,j(e.premovable.events.unset))}function fr(e,t,o){me(e),e.predroppable.current={role:t,key:o},j(e.predroppable.events.set,t,o)}function ve(e){const t=e.predroppable;t.current&&(t.current=void 0,j(t.events.unset))}function gr(e,t,o){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const s=T(t),n=T(o);if(s[1]!==0&&s[1]!==7||s[1]!==n[1])return!1;s[0]===4&&!e.pieces.has(o)&&(n[0]===6?o=te([7,n[1]]):n[0]===2&&(o=te([0,n[1]])));const i=e.pieces.get(o);return!i||i.color!==r.color||i.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(o),s[0]<n[0]?(e.pieces.set(te([6,n[1]]),r),e.pieces.set(te([5,n[1]]),i)):(e.pieces.set(te([2,n[1]]),r),e.pieces.set(te([3,n[1]]),i)),!0)}function ro(e,t,o){const r=e.pieces.get(t),s=e.pieces.get(o);if(t===o||!r)return!1;const n=s&&s.color!==r.color?s:void 0;return o===e.selected&&oe(e),j(e.events.move,t,o,n),gr(e,t,o)||(e.pieces.set(o,r),e.pieces.delete(t)),e.lastMove=[t,o],e.check=void 0,j(e.events.change),n||!0}function wt(e,t,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return j(e.events.dropNewPiece,t,o),e.pieces.set(o,t),e.lastMove=[o],e.check=void 0,j(e.events.change),e.movable.dests=void 0,e.turnColor=bt(e.turnColor),!0}function so(e,t,o){const r=ro(e,t,o);return r&&(e.movable.dests=void 0,e.turnColor=bt(e.turnColor),e.animation.current=void 0),r}function no(e,t,o){if(yt(e,t,o)){const r=so(e,t,o);if(r){const s=e.hold.stop();oe(e);const n={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:s};return r!==!0&&(n.captured=r),j(e.movable.events.after,t,o,n),!0}}else if(vr(e,t,o))return pr(e,t,o,{ctrlKey:e.stats.ctrlKey}),oe(e),!0;return oe(e),!1}function io(e,t,o,r){const s=e.pieces.get(t);s&&(mr(e,t,o)||r)?(e.pieces.delete(t),wt(e,s,o,r),j(e.movable.events.afterNewPiece,s.role,o,{premove:!1,predrop:!1})):s&&br(e,t,o)?fr(e,s.role,o):(me(e),ve(e)),e.pieces.delete(t),oe(e)}function dt(e,t,o){if(j(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){oe(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==t&&no(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(lo(e,t)||kt(e,t))&&(ao(e,t),e.hold.start())}function ao(e,t){e.selected=t,kt(e,t)?e.premovable.customDests||(e.premovable.dests=oo(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function oe(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function lo(e,t){const o=e.pieces.get(t);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const yt=(e,t,o)=>{var r,s;return t!==o&&lo(e,t)&&(e.movable.free||!!(!((s=(r=e.movable.dests)===null||r===void 0?void 0:r.get(t))===null||s===void 0)&&s.includes(o)))};function mr(e,t,o){const r=e.pieces.get(t);return!!r&&(t===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function kt(e,t){const o=e.pieces.get(t);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function vr(e,t,o){var r,s;const n=(s=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(t))!==null&&s!==void 0?s:oo(e.pieces,t,e.premovable.castle);return t!==o&&kt(e,t)&&n.includes(o)}function br(e,t,o){const r=e.pieces.get(t),s=e.pieces.get(o);return!!r&&(!s||s.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function _r(e,t){const o=e.pieces.get(t);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function wr(e){const t=e.premovable.current;if(!t)return!1;const o=t[0],r=t[1];let s=!1;if(yt(e,o,r)){const n=so(e,o,r);if(n){const i={premove:!0};n!==!0&&(i.captured=n),j(e.movable.events.after,o,r,i),s=!0}}return me(e),s}function yr(e,t){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(t(o)){const s={role:o.role,color:e.movable.color};wt(e,s,o.key)&&(j(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return ve(e),r}function Ct(e){me(e),ve(e),oe(e)}function qt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Ct(e)}function Se(e,t,o){let r=Math.floor(8*(e[0]-o.left)/o.width);t||(r=7-r);let s=7-Math.floor(8*(e[1]-o.top)/o.height);return t||(s=7-s),r>=0&&r<8&&s>=0&&s<8?te([r,s]):void 0}function kr(e,t,o,r){const s=T(e),n=Qt.filter(l=>to(s[0],s[1],l[0],l[1])||Xt(s[0],s[1],l[0],l[1])),i=n.map(l=>Yt(te(l),o,r)).map(l=>Re(t,l)),[,a]=i.reduce((l,c,f)=>l[0]<c?l:[c,f],[i[0],0]);return te(n[a])}const G=e=>e.orientation==="white",co="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Cr={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Sr={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function uo(e){e==="start"&&(e=co);const t=new Map;let o=7,r=0;for(const s of e)switch(s){case" ":case"[":return t;case"/":if(--o,o<0)return t;r=0;break;case"~":{const n=t.get(te([r-1,o]));n&&(n.promoted=!0);break}default:{const n=s.charCodeAt(0);if(n<57)r+=n-48;else{const i=s.toLowerCase();t.set(te([r,o]),{role:Cr[i],color:s===i?"black":"white"}),++r}}}return t}function Er(e){return sr.map(t=>gt.map(o=>{const r=e.get(o+t);if(r){let s=Sr[r.role];return r.color==="white"&&(s=s.toUpperCase()),r.promoted&&(s+="~"),s}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function ho(e,t){t.animation&&(St(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function po(e,t){var o,r,s;if(!((o=t.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=t.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),St(e,t),t.fen&&(e.pieces=uo(t.fen),e.drawable.shapes=((s=t.drawable)===null||s===void 0?void 0:s.shapes)||[]),"check"in t&&hr(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&ao(e,e.selected),ho(e,t),!e.movable.rookCastle&&e.movable.dests){const n=e.movable.color==="white"?"1":"8",i="e"+n,a=e.movable.dests.get(i),l=e.pieces.get(i);if(!a||!l||l.role!=="king")return;e.movable.dests.set(i,a.filter(c=>!(c==="a"+n&&a.includes("c"+n))&&!(c==="h"+n&&a.includes("g"+n))))}}function St(e,t){for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Nt(e[o])&&Nt(t[o])?St(e[o],t[o]):e[o]=t[o])}function Nt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const we=(e,t)=>t.animation.enabled?xr(e,t):fe(e,t);function fe(e,t){const o=e(t);return t.dom.redraw(),o}const st=(e,t)=>({key:e,pos:T(e),piece:t}),Pr=(e,t)=>t.sort((o,r)=>Re(e.pos,o.pos)-Re(e.pos,r.pos))[0];function Mr(e,t){const o=new Map,r=[],s=new Map,n=[],i=[],a=new Map;let l,c,f;for(const[d,u]of e)a.set(d,st(d,u));for(const d of vt)l=t.pieces.get(d),c=a.get(d),l?c?ut(l,c.piece)||(n.push(c),i.push(st(d,l))):i.push(st(d,l)):c&&n.push(c);for(const d of i)c=Pr(d,n.filter(u=>ut(d.piece,u.piece))),c&&(f=[c.pos[0]-d.pos[0],c.pos[1]-d.pos[1]],o.set(d.key,f.concat(f)),r.push(c.key));for(const d of n)r.includes(d.key)||s.set(d.key,d.piece);return{anims:o,fadings:s}}function fo(e,t){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const s=Tr(r);for(const n of o.plan.anims.values())n[2]=n[0]*s,n[3]=n[1]*s;e.dom.redrawNow(!0),requestAnimationFrame((n=performance.now())=>fo(e,n))}}function xr(e,t){const o=new Map(t.pieces),r=e(t),s=Mr(o,t);if(s.anims.size||s.fadings.size){const n=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:s},n||fo(t,performance.now())}else t.dom.redraw();return r}const Tr=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Ar=["green","red","blue","yellow"];function Ir(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?oe(e):Ct(e);const o=Ce(t),r=Se(o,G(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:o,brush:Dr(t),snapToValidMove:e.drawable.defaultSnapToValidMove},go(e))}function go(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const o=Se(t.pos,G(e),e.dom.bounds());o||(t.snapToValidMove=!1);const r=t.snapToValidMove?kr(t.orig,t.pos,G(e),e.dom.bounds()):o;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),go(e)}})}function qr(e,t){e.drawable.current&&(e.drawable.current.pos=Ce(t))}function Nr(e){const t=e.drawable.current;t&&(t.mouseSq&&Or(e.drawable,t),mo(e))}function mo(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Lr(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),vo(e.drawable))}function Dr(e){var t;const o=(e.shiftKey||e.ctrlKey)&&Zt(e),r=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Ar[(o?1:0)+(r?2:0)]}function Or(e,t){const o=s=>s.orig===t.orig&&s.dest===t.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(s=>!o(s))),(!r||r.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),vo(e)}function vo(e){e.onChange&&e.onChange(e.shapes)}function Rr(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const o=e.dom.bounds(),r=Ce(t),s=Se(r,G(e),o);if(!s)return;const n=e.pieces.get(s),i=e.selected;if(!i&&e.drawable.enabled&&(e.drawable.eraseOnClick||!n||n.color!==e.turnColor)&&Lr(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||n||i||Kr(e,r)))t.preventDefault();else if(t.touches)return;const a=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&yt(e,e.selected,s)?we(d=>dt(d,s),e):dt(e,s);const c=e.selected===s,f=_o(e,s);if(n&&f&&c&&_r(e,s)){e.draggable.current={orig:s,piece:n,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:i,originTarget:t.target,keyHasChanged:!1},f.cgDragging=!0,f.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${n.color} ${n.role}`,se(d,Ke(o)(T(s),G(e))),_t(d,!0)),Et(e)}else a&&me(e),l&&ve(e);e.dom.redraw()}function Kr(e,t){const o=G(e),r=e.dom.bounds(),s=Math.pow(r.width/8,2);for(const n of e.pieces.keys()){const i=Yt(n,o,r);if(Re(i,t)<=s)return!0}return!1}function $r(e,t,o,r){e.pieces.set("a0",t),e.dom.redraw();const n=Ce(o);e.draggable.current={orig:"a0",piece:t,origPos:n,pos:n,started:!0,element:()=>_o(e,"a0"),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},Et(e)}function Et(e){requestAnimationFrame(()=>{var t;const o=e.draggable.current;if(!o)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!ut(r,o.piece))Ye(e);else if(!o.started&&Re(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const n=o.element();if(!n)return;n.cgDragging=!0,n.classList.add("dragging"),o.element=n}const s=e.dom.bounds();se(o.element,[o.pos[0]-s.left-s.width/16,o.pos[1]-s.top-s.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==Se(o.pos,G(e),s))}Et(e)})}function Br(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=Ce(t))}function Vr(e,t){const o=e.draggable.current;if(!o)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&o.originTarget!==t.target&&!o.newPiece){e.draggable.current=void 0;return}me(e),ve(e);const r=Ce(t)||o.pos,s=Se(r,G(e),e.dom.bounds());s&&o.started&&o.orig!==s?o.newPiece?io(e,o.orig,s,o.force):(e.stats.ctrlKey=t.ctrlKey,no(e,o.orig,s)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!s&&(e.pieces.delete(o.orig),j(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===s||!s)?oe(e):e.selectable.enabled||oe(e),bo(e),e.draggable.current=void 0,e.dom.redraw()}function Ye(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,oe(e),bo(e),e.dom.redraw())}function bo(e){const t=e.dom.elements;t.ghost&&_t(t.ghost,!1)}function _o(e,t){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===t&&o.tagName==="PIECE")return o;o=o.nextSibling}}function Hr(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Lt(e,2),setTimeout(()=>Lt(e,void 0),120)},120)}function Lt(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Fr(e,t){function o(){ur(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),ho(e,r),(r.fen?we:fe)(s=>po(s,r),e)},state:e,getFen:()=>Er(e.pieces),toggleOrientation:o,setPieces(r){we(s=>dr(s,r),e)},selectSquare(r,s){r?we(n=>dt(n,r,s),e):e.selected&&(oe(e),e.dom.redraw())},move(r,s){we(n=>ro(n,r,s),e)},newPiece(r,s){we(n=>wt(n,r,s),e)},playPremove(){if(e.premovable.current){if(we(wr,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const s=yr(e,r);return e.dom.redraw(),s}return!1},cancelPremove(){fe(me,e)},cancelPredrop(){fe(ve,e)},cancelMove(){fe(r=>{Ct(r),Ye(r)},e)},stop(){fe(r=>{qt(r),Ye(r)},e)},explode(r){Hr(e,r)},setAutoShapes(r){fe(s=>s.drawable.autoShapes=r,e)},setShapes(r){fe(s=>s.drawable.shapes=r,e)},getKeyAtDomPos(r){return Se(r,G(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,s,n){$r(e,r,s,n)},destroy(){qt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Wr(){return{pieces:uo(co),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purp",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},hilite:{key:"hilite",color:"#fff",opacity:1,lineWidth:1}},prevSvgHash:""},hold:ir()}}function jr(){const e=L("defs"),t=V(L("filter"),{id:"cg-filter-blur"});return t.appendChild(V(L("feGaussianBlur"),{stdDeviation:"0.022"})),e.appendChild(t),e}function Gr(e,t,o){var r;const s=e.drawable,n=s.current,i=n&&n.mouseSq?n:void 0,a=new Map,l=e.dom.bounds(),c=s.autoShapes.filter(h=>!h.piece);for(const h of s.shapes.concat(c).concat(i?[i]:[])){if(!h.dest)continue;const p=(r=a.get(h.dest))!==null&&r!==void 0?r:new Set,g=Je(Xe(T(h.orig),e.orientation),l),S=Je(Xe(T(h.dest),e.orientation),l);p.add(pt(g,S)),a.set(h.dest,p)}const f=s.shapes.concat(c).map(h=>({shape:h,current:!1,hash:Dt(h,ht(h.dest,a),!1,l)}));i&&f.push({shape:i,current:!0,hash:Dt(i,ht(i.dest,a),!0,l)});const d=f.map(h=>h.hash).join(";");if(d===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=d;const u=t.querySelector("defs");Ur(s,f,u),Qr(f,t.querySelector("g"),o.querySelector("g"),h=>Yr(e,h,s.brushes,a,l))}function Ur(e,t,o){var r;const s=new Map;let n;for(const l of t.filter(c=>c.shape.dest&&c.shape.brush))n=wo(e.brushes[l.shape.brush],l.shape.modifiers),!((r=l.shape.modifiers)===null||r===void 0)&&r.hilite&&s.set("hilite",e.brushes.hilite),s.set(n.key,n);const i=new Set;let a=o.firstElementChild;for(;a;)i.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[l,c]of s.entries())i.has(l)||o.appendChild(es(c))}function Qr(e,t,o,r){const s=new Map;for(const n of e)s.set(n.hash,!1);for(const n of[t,o]){const i=[];let a=n.firstElementChild,l;for(;a;)l=a.getAttribute("cgHash"),s.has(l)?s.set(l,!0):i.push(a),a=a.nextElementSibling;for(const c of i)n.removeChild(c)}for(const n of e.filter(i=>!s.get(i.hash)))for(const i of r(n))i.isCustom?o.appendChild(i.el):t.appendChild(i.el)}function Dt({orig:e,dest:t,brush:o,piece:r,modifiers:s,customSvg:n,label:i},a,l,c){var f,d;return[c.width,c.height,l,e,t,o,a&&"-",r&&zr(r),s&&Zr(s),n&&`custom-${Ot(n.html)},${(d=(f=n.center)===null||f===void 0?void 0:f[0])!==null&&d!==void 0?d:"o"}`,i&&`label-${Ot(i.text)}`].filter(u=>u).join(",")}function zr(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Zr(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function Ot(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o)>>>0;return t.toString()}function Yr(e,{shape:t,current:o,hash:r},s,n,i){var a,l;const c=Je(Xe(T(t.orig),e.orientation),i),f=t.dest?Je(Xe(T(t.dest),e.orientation),i):c,d=t.brush&&wo(s[t.brush],t.modifiers),u=n.get(t.dest),h=[];if(d){const p=V(L("g"),{cgHash:r});h.push({el:p}),c[0]!==f[0]||c[1]!==f[1]?p.appendChild(Jr(t,d,c,f,o,ht(t.dest,n))):p.appendChild(Xr(s[t.brush],c,o,i))}if(t.label){const p=t.label;(a=p.fill)!==null&&a!==void 0||(p.fill=t.brush&&s[t.brush].color);const g=t.brush?void 0:"tr";h.push({el:ts(p,r,c,f,u,g),isCustom:!0})}if(t.customSvg){const p=(l=t.customSvg.center)!==null&&l!==void 0?l:"orig",[g,S]=p==="label"?ko(c,f,u).map(m=>m-.5):p==="dest"?f:c,x=V(L("g"),{transform:`translate(${g},${S})`,cgHash:r});x.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,h.push({el:x,isCustom:!0})}return h}function Xr(e,t,o,r){const s=os(),n=(r.width+r.height)/(4*Math.max(r.width,r.height));return V(L("circle"),{stroke:e.color,"stroke-width":s[o?0:1],fill:"none",opacity:yo(e,o),cx:t[0],cy:t[1],r:n-s[1]/2})}function Jr(e,t,o,r,s,n){var i;function a(f){var d;const u=ss(n&&!s),h=r[0]-o[0],p=r[1]-o[1],g=Math.atan2(p,h),S=Math.cos(g)*u,x=Math.sin(g)*u;return V(L("line"),{stroke:f?"white":t.color,"stroke-width":rs(t,s)+(f?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${f?"hilite":t.key})`,opacity:!((d=e.modifiers)===null||d===void 0)&&d.hilite?1:yo(t,s),x1:o[0],y1:o[1],x2:r[0]-S,y2:r[1]-x})}if(!(!((i=e.modifiers)===null||i===void 0)&&i.hilite))return a(!1);const l=L("g"),c=V(L("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(ns(o,r)),c.appendChild(a(!0)),l.appendChild(c),l.appendChild(a(!1)),l}function es(e){const t=V(L("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key==="hilite"?1.86:2.05,refY:2});return t.appendChild(V(L("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function ts(e,t,o,r,s,n){var i;const a=.4*.75**e.text.length,l=ko(o,r,s),c=n==="tr"?.4:0,f=V(L("g"),{transform:`translate(${l[0]+c},${l[1]-c})`,cgHash:t});f.appendChild(V(L("circle"),{r:.4/2,"fill-opacity":n?1:.8,"stroke-opacity":n?1:.7,"stroke-width":.03,fill:(i=e.fill)!==null&&i!==void 0?i:"#666",stroke:"white"}));const d=V(L("text"),{"font-size":a,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return d.innerHTML=e.text,f.appendChild(d),f}function Xe(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function ht(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function L(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function V(e,t){for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.setAttribute(o,t[o]);return e}function wo(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(o=>o).join("")}:e}function os(){return[3/64,4/64]}function rs(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function yo(e,t){return(e.opacity||1)*(t?.9:1)}function ss(e){return(e?20:10)/64}function Je(e,t){const o=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function ns(e,t){const o={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return V(L("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function pt(e,t,o=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return o?(Math.round(r*8/Math.PI)+16)%16:r}function is(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((o,r)=>o+r*r,0))}function ko(e,t,o){let r=is(e,t);const s=pt(e,t,!1);if(o&&(r-=33/64,o.size>1)){r-=10/64;const n=pt(e,t);(o.has((n+1)%16)||o.has((n+15)%16))&&n&1&&(r-=.4)}return[e[0]-Math.cos(s)*r,e[1]-Math.sin(s)*r].map(n=>n+.5)}function as(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const l of rr)e.classList.toggle("orientation-"+l,t.orientation===l);e.classList.toggle("manipulable",!t.viewOnly);const o=ce("cg-container");e.appendChild(o);const r=ce("cg-board");o.appendChild(r);let s,n,i;if(t.drawable.visible&&(s=V(L("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(jr()),s.appendChild(L("g")),n=V(L("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),n.appendChild(L("g")),i=ce("cg-auto-pieces"),o.appendChild(s),o.appendChild(n),o.appendChild(i)),t.coordinates){const l=t.orientation==="black"?" black":"",c=t.ranksPosition==="left"?" left":"";o.appendChild(Rt(mt,"ranks"+l+c)),o.appendChild(Rt(gt,"files"+l))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=ce("piece","ghost"),_t(a,!1),o.appendChild(a)),{board:r,container:o,wrap:e,ghost:a,svg:s,customSvg:n,autoPieces:i}}function Rt(e,t){const o=ce("coords",t);let r;for(const s of e)r=ce("coord"),r.textContent=s,o.appendChild(r);return o}function ls(e,t){if(!e.dropmode.active)return;me(e),ve(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=Ce(t),s=r&&Se(r,G(e),e.dom.bounds());s&&io(e,"a0",s)}e.dom.redraw()}function cs(e,t){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",s=>s.preventDefault()),e.viewOnly)return;const r=ds(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1})}function us(e,t){const o=[];if("ResizeObserver"in window||o.push(qe(document.body,"chessground.resize",t)),!e.viewOnly){const r=Kt(e,Br,qr),s=Kt(e,Vr,Nr);for(const i of["touchmove","mousemove"])o.push(qe(document,i,r));for(const i of["touchend","mouseup"])o.push(qe(document,i,s));const n=()=>e.dom.bounds.clear();o.push(qe(document,"scroll",n,{capture:!0,passive:!0})),o.push(qe(window,"resize",n,{passive:!0}))}return()=>o.forEach(r=>r())}function qe(e,t,o,r){return e.addEventListener(t,o,r),()=>e.removeEventListener(t,o,r)}const ds=e=>t=>{e.draggable.current?Ye(e):e.drawable.current?mo(e):t.shiftKey||Zt(t)?e.drawable.enabled&&Ir(e,t):e.viewOnly||(e.dropmode.active?ls(e,t):Rr(e,t))},Kt=(e,t,o)=>r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||t(e,r)};function hs(e){const t=G(e),o=Ke(e.dom.bounds()),r=e.dom.elements.board,s=e.pieces,n=e.animation.current,i=n?n.plan.anims:new Map,a=n?n.plan.fadings:new Map,l=e.draggable.current,c=fs(e),f=new Set,d=new Set,u=new Map,h=new Map;let p,g,S,x,m,A,H,I,ne,K;for(g=r.firstChild;g;){if(p=g.cgKey,Co(g))if(S=s.get(p),m=i.get(p),A=a.get(p),x=g.cgPiece,g.cgDragging&&(!l||l.orig!==p)&&(g.classList.remove("dragging"),se(g,o(T(p),t)),g.cgDragging=!1),!A&&g.cgFading&&(g.cgFading=!1,g.classList.remove("fading")),S){if(m&&g.cgAnimating&&x===Ne(S)){const y=T(p);y[0]+=m[2],y[1]+=m[3],g.classList.add("anim"),se(g,o(y,t))}else g.cgAnimating&&(g.cgAnimating=!1,g.classList.remove("anim"),se(g,o(T(p),t)),e.addPieceZIndex&&(g.style.zIndex=nt(T(p),t)));x===Ne(S)&&(!A||!g.cgFading)?f.add(p):A&&x===Ne(A)?(g.classList.add("fading"),g.cgFading=!0):it(u,x,g)}else it(u,x,g);else if(So(g)){const y=g.className;c.get(p)===y?d.add(p):it(h,y,g)}g=g.nextSibling}for(const[y,ue]of c)if(!d.has(y)){ne=h.get(ue),K=ne&&ne.pop();const Z=o(T(y),t);if(K)K.cgKey=y,se(K,Z);else{const F=ce("square",ue);F.cgKey=y,se(F,Z),r.insertBefore(F,r.firstChild)}}for(const[y,ue]of s)if(m=i.get(y),!f.has(y))if(H=u.get(Ne(ue)),I=H&&H.pop(),I){I.cgKey=y,I.cgFading&&(I.classList.remove("fading"),I.cgFading=!1);const Z=T(y);e.addPieceZIndex&&(I.style.zIndex=nt(Z,t)),m&&(I.cgAnimating=!0,I.classList.add("anim"),Z[0]+=m[2],Z[1]+=m[3]),se(I,o(Z,t))}else{const Z=Ne(ue),F=ce("piece",Z),de=T(y);F.cgPiece=Z,F.cgKey=y,m&&(F.cgAnimating=!0,de[0]+=m[2],de[1]+=m[3]),se(F,o(de,t)),e.addPieceZIndex&&(F.style.zIndex=nt(de,t)),r.appendChild(F)}for(const y of u.values())Bt(e,y);for(const y of h.values())Bt(e,y)}function ps(e){const t=G(e),o=Ke(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(Co(r)&&!r.cgAnimating||So(r))&&se(r,o(T(r.cgKey),t)),r=r.nextSibling}function $t(e){var t,o;const r=e.dom.elements.wrap.getBoundingClientRect(),s=e.dom.elements.container,n=r.height/r.width,i=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=i*n;s.style.width=i+"px",s.style.height=a+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",i+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",a+"px")}const Co=e=>e.tagName==="PIECE",So=e=>e.tagName==="SQUARE";function Bt(e,t){for(const o of t)e.dom.elements.board.removeChild(o)}function nt(e,t){const o=e[1];return`${t?10-o:3+o}`}const Ne=e=>`${e.color} ${e.role}`;function fs(e){var t,o,r;const s=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)le(s,a,"last-move");if(e.check&&e.highlight.check&&le(s,e.check,"check"),e.selected&&(le(s,e.selected,"selected"),e.movable.showDests)){const a=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(a)for(const c of a)le(s,c,"move-dest"+(e.pieces.has(c)?" oc":""));const l=(r=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(e.selected))!==null&&r!==void 0?r:e.premovable.dests;if(l)for(const c of l)le(s,c,"premove-dest"+(e.pieces.has(c)?" oc":""))}const n=e.premovable.current;if(n)for(const a of n)le(s,a,"current-premove");else e.predroppable.current&&le(s,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const a of i.keys)le(s,a,"exploding"+i.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,l)=>{le(s,l,a)}),s}function le(e,t,o){const r=e.get(t);r?e.set(t,`${r} ${o}`):e.set(t,o)}function it(e,t,o){const r=e.get(t);r?r.push(o):e.set(t,[o])}function gs(e,t,o){const r=new Map,s=[];for(const a of e)r.set(a.hash,!1);let n=t.firstElementChild,i;for(;n;)i=n.getAttribute("cgHash"),r.has(i)?r.set(i,!0):s.push(n),n=n.nextElementSibling;for(const a of s)t.removeChild(a);for(const a of e)r.get(a.hash)||t.appendChild(o(a))}function ms(e,t){const o=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:_s(r),current:!1}));gs(o,t,r=>bs(e,r,e.dom.bounds()))}function vs(e){var t;const o=G(e),r=Ke(e.dom.bounds());let s=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;s;)zt(s,r(T(s.cgKey),o),s.cgScale),s=s.nextSibling}function bs(e,{shape:t,hash:o},r){var s,n,i;const a=t.orig,l=(s=t.piece)===null||s===void 0?void 0:s.role,c=(n=t.piece)===null||n===void 0?void 0:n.color,f=(i=t.piece)===null||i===void 0?void 0:i.scale,d=ce("piece",`${l} ${c}`);return d.setAttribute("cgHash",o),d.cgKey=a,d.cgScale=f,zt(d,Ke(r)(T(a),G(e)),f),d}const _s=e=>{var t,o,r;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function ws(e,t){const o=Wr();po(o,{});function r(){const s="dom"in o?o.dom.unbind:void 0,n=as(e,o),i=nr(()=>n.board.getBoundingClientRect()),a=f=>{hs(c),n.autoPieces&&ms(c,n.autoPieces),!f&&n.svg&&Gr(c,n.svg,n.customSvg)},l=()=>{$t(c),ps(c),n.autoPieces&&vs(c)},c=o;return c.dom={elements:n,bounds:i,redraw:ys(a),redrawNow:a,unbind:s},c.drawable.prevSvgHash="",$t(c),a(!1),cs(c,l),s||(c.dom.unbind=us(c,l)),c.events.insert&&c.events.insert(n),c}return Fr(r(),r)}function ys(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}class ks{game;board;boardState;props;emit;constructor(t,o,r,s){this.boardState=o,this.props=r,this.emit=s,this.game=new Zo,this.board=ws(t),this.resetBoard()}updateGameState({updateFen:t=!0}={}){this.boardState.historyViewerState.isEnabled||(t&&this.board.set({fen:this.game.fen()}),this.board.state.turnColor=this.getTurnColor(),this.board.state.movable.free?(this.board.state.movable.color="both",this.board.state.movable.dests=new Map):(this.board.state.movable.color=this.props.playerColor||this.board.state.turnColor,this.board.state.movable.dests=It(this.game)),this.displayInCheck(this.game.inCheck(),this.board.state.turnColor),this.boardState.showThreats&&this.drawMoves()),this.emitEvents()}displayInCheck(t,o){if(t){for(const[r,s]of this.board.state.pieces)if(s.role==="king"&&s.color===o){this.board.state.check=r;return}}else this.board.state.check=void 0}emitEvents(){this.game.inCheck()&&this.emit(this.game.isCheckmate()?"checkmate":"check",this.board.state.turnColor),this.game.isDraw()&&this.emit("draw"),this.game.isStalemate()&&this.emit("stalemate")}async changeTurn(t,o,r){let s;Xo(o,this.game.get(t))&&(s=await new Promise(n=>{this.boardState.promotionDialogState={isEnabled:!0,color:this.getTurnColor(),callback:n}})),this.move({from:t,to:o,promotion:s})}resetBoard(){this.setConfig(this.props.boardConfig,!0)}undoLastMove(){const t=this.game.undo();if(t!=null&&(this.boardState.historyViewerState.isEnabled&&this.boardState.historyViewerState.plyViewing===this.getCurrentPlyNumber()&&this.stopViewingHistory(),!this.boardState.historyViewerState.isEnabled)){this.board.set({fen:t.before}),this.updateGameState({updateFen:!1});const o=this.getLastMove();this.board.state.lastMove=o?[o?.from,o?.to]:void 0}}getMaterialCount(){const t=this.board.state.pieces,o={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0},r={materialWhite:0,materialBlack:0,materialDiff:0};for(const s of t)s[1].color==="white"?r.materialWhite+=o[s[1].role]:r.materialBlack+=o[s[1].role];return r.materialDiff=r.materialWhite-r.materialBlack,r}getCapturedPieces(){const t={white:[],black:[]};for(const{color:o,captured:r}of this.getHistory(!0))r&&t[We(o)].push(r);return t}toggleOrientation(){this.board.toggleOrientation()}drawMoves(){this.boardState.showThreats=!0,this.board.setShapes(Yo(this.game.moves({verbose:!0})))}hideMoves(){this.boardState.showThreats=!1,this.board.setShapes([])}drawMove(t,o,r){this.board.setShapes([{orig:t,dest:o,brush:r}])}toggleMoves(){this.boardState.showThreats?this.hideMoves():this.drawMoves()}async getOpeningName(){try{const t=this.game.history({verbose:!0}).map(o=>o.lan).join(",");return(await(await fetch(`https://explorer.lichess.ovh/masters?play=${t}`)).json()).opening?.name??null}catch{return null}}move(t){let o;try{o=this.game.move(t)}catch{return typeof t=="object"&&this.board.state.movable.free&&(this.board.move(t.from,t.to),this.updateGameState({updateFen:!1})),!1}return this.emit("move",o),o?.promotion&&this.emit("promotion",{color:We(o.color),promotedTo:o.promotion.toUpperCase(),sanMove:o.san}),this.boardState.historyViewerState.isEnabled||(this.board.move(o.from,o.to),(o.flags==="e"||o?.promotion)&&setTimeout(()=>this.board.set({fen:o.after}),this.board.state.animation.current?this.board.state.animation.duration:0),this.updateGameState({updateFen:!1}),Wt(this.board.playPremove)),!0}getTurnColor(){return We(this.game.turn())}getPossibleMoves(){return It(this.game)}getCurrentTurnNumber(){return this.game.moveNumber()}getCurrentPlyNumber(){return 2*this.getCurrentTurnNumber()-(this.getTurnColor()==="black"?1:2)}getLastMove(){return this.game.history({verbose:!0}).at(-1)}getHistory(t=!1){return this.game.history({verbose:t})}getFen(){return this.game.fen()}getBoardPosition(){return this.game.board()}getPgn(){return this.game.pgn()}getIsGameOver(){return this.game.isGameOver()}getIsCheckmate(){return this.game.isCheckmate()}getIsCheck(){return this.game.isCheck()}getIsStalemate(){return this.game.isStalemate()}getIsDraw(){return this.game.isDraw()}getIsThreefoldRepetition(){return this.game.isThreefoldRepetition()}getIsInsufficientMaterial(){return this.game.isInsufficientMaterial()}getSquareColor(t){return this.game.squareColor(t)}getSquare(t){return this.game.get(t)}setPosition(t){this.game.load(t),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState()}putPiece(t,o){if(this.board.state.movable.free){const r=this.board.state.pieces;return r.set(o,{color:t.color==="w"?"white":"black",role:Jo[t.type]}),this.board.setPieces(r),!0}else{const r=this.game.put(t,o);return r&&this.updateGameState(),r}}removePiece(t){this.board.state.pieces.delete(t),this.game.remove(t)}clearBoard(){this.game.clear(),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState()}setShapes(t){this.board.setShapes(t)}loadPgn(t){this.game.loadPgn(t),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState();const o=this.getLastMove();o&&this.board.set({lastMove:[o.from,o.to]})}getPgnInfo(){return this.game.header()}setPgnInfo(t){return this.game.header(...Object.entries(t).flat())}setConfig(t,o=!1){if(o&&(t=Gt(or,t),this.board.state.selected=void 0),t.movable?.events&&"after"in t.movable.events){const n=t.movable.events.after;t.movable.events.after=n?async(...i)=>{await this.changeTurn(...i),n(...i)}:this.changeTurn.bind(this)}const{fen:r,...s}=t;this.board.set(s),r&&this.setPosition(r),this.board.redrawAll()}viewHistory(t){const o=this.getHistory(!0);if(t<0||t>o.length)return;const r=this.board.state.animation.enabled&&(this.boardState.historyViewerState.isEnabled&&Math.abs(this.boardState.historyViewerState.plyViewing-t)!==1||!this.boardState.historyViewerState.isEnabled&&t!==o.length-1);if(r&&this.board.set({animation:{enabled:!1}}),t<o.length)this.boardState.historyViewerState.isEnabled?this.boardState.historyViewerState.plyViewing=t:this.boardState.historyViewerState={isEnabled:!0,plyViewing:t,viewOnly:this.board.state.viewOnly},this.board.set({fen:o[t].before,viewOnly:!0,lastMove:t>0?[o[t-1].from,o[t-1].to]:void 0,selected:void 0}),this.displayInCheck(t>0?"+#".includes(o[t-1].san.at(-1)):!1,We(o[t].color)),this.board.cancelPremove();else if(this.boardState.historyViewerState.isEnabled){const s=o.at(-1);this.board.set({fen:s.after,viewOnly:this.boardState.historyViewerState.viewOnly,lastMove:[s.from,s.to]}),this.boardState.historyViewerState={isEnabled:!1},this.updateGameState({updateFen:!1})}r&&this.board.set({animation:{enabled:!0}})}stopViewingHistory(){this.boardState.historyViewerState.isEnabled&&this.viewHistory(this.getCurrentPlyNumber())}viewStart(){this.viewHistory(0)}viewNext(){this.boardState.historyViewerState.isEnabled&&this.viewHistory(this.boardState.historyViewerState.plyViewing+1)}viewPrevious(){const t=this.boardState.historyViewerState.isEnabled?this.boardState.historyViewerState.plyViewing:this.getCurrentPlyNumber();this.viewHistory(t-1)}}const Cs={class:"main-board"},Vt=Ht({__name:"TheChessboard",props:{boardConfig:{default:()=>({})},playerColor:{},reactiveConfig:{type:Boolean,default:!1}},emits:["boardCreated","check","checkmate","stalemate","draw","promotion","move"],setup(e,{emit:t}){const o=e,r=Pe(null),s=at({showThreats:!1,promotionDialogState:{isEnabled:!1},historyViewerState:{isEnabled:!1}});return Ft(()=>{if(r.value==null)throw new Error("vue3-chessboard: Failed to mount board.");const n=new ks(r.value,s,o,t);if(t("boardCreated",n),o.reactiveConfig){let i=Ze(o.boardConfig);lt(at(o.boardConfig),a=>{n.setConfig(Ut(i,a)),i=Ze(a)})}}),(n,i)=>(P(),N("section",{class:Me(["main-wrap",{disabledBoard:s.promotionDialogState.isEnabled,viewingHistory:s.historyViewerState.isEnabled}])},[C("div",Cs,[s.promotionDialogState.isEnabled?(P(),Te(Do,{key:0,state:s.promotionDialogState,onPromotionSelected:i[0]||(i[0]=a=>s.promotionDialogState={isEnabled:!1})},null,8,["state"])):xe("",!0),C("div",{ref_key:"boardElement",ref:r},null,512)])],2))}}),Ss={class:"captured-pieces d-flex align-center ga-1"},Es={__name:"CapturedPieces",props:{pieces:{type:Array,required:!0}},setup(e){const t=r=>({p:"mdi-chess-pawn",n:"mdi-chess-knight",b:"mdi-chess-bishop",r:"mdi-chess-rook",q:"mdi-chess-queen"})[r.type]||"",o=r=>r==="w"?"grey":void 0;return(r,s)=>{const n=R("v-icon");return P(),N("div",Ss,[(P(!0),N(Ue,null,Qe(e.pieces,(i,a)=>(P(),Te(n,{key:a,icon:t(i),color:o(i.color),size:"x-small"},null,8,["icon","color"]))),128))])}}},Ps=ft(Es,[["__scopeId","data-v-df8d08c0"]]),Ms={class:"player-info-panel d-flex align-center pa-2"},xs={class:"d-flex align-center flex-grow-1 text-truncate"},Ts={class:"text-truncate"},As={class:"font-weight-bold text-subtitle-2"},Is={class:"text-caption text-medium-emphasis ml-2"},qs={__name:"PlayerInfoPanel",props:{player:{type:Object,required:!0},capturedPieces:{type:Array,default:()=>[]},advantage:{type:Number,default:0}},setup(e){return(t,o)=>{const r=R("v-icon"),s=R("v-avatar"),n=R("v-chip");return P(),N("div",Ms,[C("div",xs,[w(s,{size:"32",class:"mr-3"},{default:W(()=>[w(r,{color:"grey-darken-1"},{default:W(()=>[...o[0]||(o[0]=[ze("mdi-account-circle",-1)])]),_:1})]),_:1}),C("div",Ts,[C("span",As,ee(e.player.name),1),C("span",Is,"("+ee(e.player.rating)+")",1)])]),e.capturedPieces?(P(),Te(Ps,{key:0,pieces:e.capturedPieces,class:"mx-2"},null,8,["pieces"])):xe("",!0),e.advantage>0?(P(),Te(n,{key:1,size:"x-small",label:"",class:"font-weight-bold"},{default:W(()=>[ze("+"+ee(e.advantage),1)]),_:1})):xe("",!0)])}}},je=ft(qs,[["__scopeId","data-v-6489c83b"]]),Ns={key:0,class:"text-center pa-10"},Ls={key:2},Ds={key:0,class:"desktop-layout-container"},Os={class:"board-column"},Rs={class:"px-2 flex-grow-1"},Ks={class:"info-column"},$s={class:"d-flex justify-space-between align-center"},Bs={class:"text-subtitle-1 font-weight-bold"},Vs={class:"text-body-2 text-medium-emphasis"},Hs={class:"text-h6 font-weight-bold"},Fs={class:"move-number text-medium-emphasis"},Ws=["onClick","innerHTML"],js=["onClick","innerHTML"],Gs={key:1,class:"flex-grow-1"},Us={class:"pa-2"},Qs={key:1,class:"mobile-layout"},zs={class:"board-area"},Zs={class:"px-1"},Ys={class:"info-area"},Xs={class:"d-flex align-center pa-2"},Js={class:"font-weight-bold"},en={key:0,class:"text-truncate text-caption text-medium-emphasis"},tn={class:"move-number text-medium-emphasis"},on=["onClick","innerHTML"],rn=["onClick","innerHTML"],sn={key:1,class:"flex-grow-1"},nn={__name:"GameView",props:{gameId:{type:[String,Number],required:!0}},setup(e){const t=e,o=xo(),r=To(),s=ie(()=>o.activeGame);let n=null;const i=Pe([]),a=Pe(0),l=Pe(null),c=Pe(null),f=Pe([]),d=at({orientation:"white",viewOnly:!0,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},responsive:!0}),u=()=>{d.orientation=d.orientation==="white"?"black":"white"},h=v=>{n=v,s.value?.pgn_moves&&p(s.value)};lt(()=>t.gameId,v=>{v&&o.fetchGameData(v)},{immediate:!0});const p=v=>{if(!(!n||!v?.pgn_moves))try{d.orientation="white",n.loadPgn(v.pgn_moves);const k=new Ve;k.loadPgn(v.pgn_moves),i.value=k.history({verbose:!0}),S(v.pgn_moves),ue()}catch(k){console.error("Invalid PGN:",k),i.value=[],n.resetBoard()}},g={p:1,n:3,b:3,r:5,q:9};function S(v){const k=new Ve;k.loadPgn(v);const Y=k.history({verbose:!0});i.value=Y;const $=[];$.push({captured:{w:[],b:[]},advantage:{w:0,b:0}});const be=new Ve;Y.forEach(re=>{be.move(re.san);const X={w:[...$[$.length-1].captured.w],b:[...$[$.length-1].captured.b]};if(re.captured){const E={type:re.captured,color:re.color==="w"?"b":"w"};E.color==="w"?X.w.push(E):X.b.push(E)}const M=X.b.reduce((E,Ee)=>E+g[Ee.type],0),q=X.w.reduce((E,Ee)=>E+g[Ee.type],0);$.push({captured:X,advantage:{w:M>q?M-q:0,b:q>M?q-M:0}})}),f.value=$}const x=ie(()=>{const v=m.value.captured;if(!v)return{w:[],b:[]};const k=["p","n","b","r","q"],Y=k.reduce((M,q)=>(M[q]=v.b.filter(E=>E.type===q).length,M),{}),$=k.reduce((M,q)=>(M[q]=v.w.filter(E=>E.type===q).length,M),{}),be=[],re=[];k.forEach(M=>{const q=Y[M]-$[M];if(q>0)for(let E=0;E<q;E++)be.push({type:M,color:"b"});else if(q<0)for(let E=0;E<-q;E++)re.push({type:M,color:"w"})});const X={q:5,r:4,b:3,n:2,p:1};return be.sort((M,q)=>X[M.type]-X[q.type]),re.sort((M,q)=>X[M.type]-X[q.type]),{w:be,b:re}}),m=ie(()=>(console.log(f.value[a.value]),f.value[a.value]||{captured:{w:[],b:[]},advantage:{w:0,b:0}}));lt(s,v=>{v&&n&&p(v)},{deep:!0});const A=ie(()=>qo(s.value?.result)),H=ie(()=>{if(!s.value?.pgn_moves)return"#";const v=`[White "${s.value.white_name}"]
[Black "${s.value.black_name}"]

${s.value.pgn_moves}`;return`https://lichess.org/paste?pgn=${encodeURIComponent(v)}`}),I=ie(()=>{if(!s.value?.pgn_moves||!o.ecoDatabase)return null;try{const v=new Ve;v.loadPgn(s.value.pgn_moves);const k=v.history();for(let Y=Math.min(k.length,20);Y>0;Y--){const $=Io(k.slice(0,Y));if(o.ecoDatabase[$])return o.ecoDatabase[$]}}catch{return null}return null}),ne=ie(()=>{const v=[];for(let k=0;k<i.value.length;k+=2)v.push({white:i.value[k],black:i.value[k+1]||null});return v}),K=ie(()=>s.value?d.orientation==="white"?{name:s.value.black_name,rating:s.value.black_rating,color:"b"}:{name:s.value.white_name,rating:s.value.white_rating,color:"w"}:{}),y=ie(()=>s.value?d.orientation==="white"?{name:s.value.white_name,rating:s.value.white_rating,color:"w"}:{name:s.value.black_name,rating:s.value.black_rating,color:"b"}:{}),ue=()=>{a.value=0,n?.viewHistory(0),Ae()},Z=()=>{a.value=i.value.length,n?.viewHistory(i.value.length),Ae()},F=()=>{a.value<i.value.length&&(a.value++,n.viewHistory(a.value),Ae())},de=()=>{a.value>0&&(a.value--,n.viewHistory(a.value),Ae())},$e=v=>{a.value=v+1,n?.viewHistory(a.value),Ae()},Be=v=>v===a.value-1,Ae=()=>{Wt(()=>{const v=l.value;if(!v)return;if(a.value===0){v.scrollTo({top:0,behavior:"smooth"});return}const k=c.value?.querySelector(".current-move");if(k){const Y=k.offsetTop-v.clientHeight/2+k.clientHeight/2,$=Math.max(0,Y);v.scrollTo({top:$,behavior:"smooth"})}})},Pt=v=>{v.key==="ArrowRight"?(v.preventDefault(),F()):v.key==="ArrowLeft"&&(v.preventDefault(),de())};return Ft(()=>window.addEventListener("keydown",Pt)),Ao(()=>window.removeEventListener("keydown",Pt)),(v,k)=>{const Y=R("v-progress-circular"),$=R("v-alert"),be=R("v-sheet"),re=R("v-chip"),X=R("v-card-text"),M=R("v-divider"),q=R("v-list-item"),E=R("v-btn"),Ee=R("v-btn-group"),Mt=R("v-spacer"),Eo=R("v-card-actions"),Po=R("v-card"),Mo=R("v-toolbar");return P(),N("div",null,[ae(o).isLoadingDetails&&!s.value?(P(),N("div",Ns,[w(Y,{indeterminate:"",color:"primary",size:"64"}),k[0]||(k[0]=C("div",{class:"mt-4 text-medium-emphasis"}," ...",-1))])):ae(o).error?(P(),Te($,{key:1,type:"error",prominent:""},{default:W(()=>[...k[1]||(k[1]=[ze("     . ,   . ",-1)])]),_:1})):s.value?(P(),N("div",Ls,[ae(r).mdAndUp.value?(P(),N("div",Ds,[C("div",Os,[w(be,{class:"d-flex flex-column",border:"",rounded:"lg"},{default:W(()=>[w(je,{player:K.value,"captured-pieces":x.value[K.value.color],advantage:m.value.advantage[K.value.color]},null,8,["player","captured-pieces","advantage"]),C("div",Rs,[w(ae(Vt),{"board-config":d,"reactive-config":"",onBoardCreated:h},null,8,["board-config"])]),w(je,{player:y.value,"captured-pieces":x.value[y.value.color],advantage:m.value.advantage[y.value.color]},null,8,["player","captured-pieces","advantage"])]),_:1})]),C("div",Ks,[w(Po,{class:"desktop-info-card d-flex flex-column"},{default:W(()=>[w(X,null,{default:W(()=>[C("div",$s,[C("div",null,[C("div",Bs,ee(s.value.tournament_name),1),C("div",Vs," "+ee(s.value.round)+"   "+ee(s.value.board),1)]),w(re,{label:"",color:"primary",variant:"elevated",size:"large"},{default:W(()=>[C("span",Hs,ee(A.value),1)]),_:1})])]),_:1}),w(M),C("div",{class:"moves-scroll-area",ref_key:"scrollWrapper",ref:l},[C("div",{class:"pa-2 moves-container",ref_key:"movesContainer",ref:c},[(P(!0),N(Ue,null,Qe(ne.value,(_e,U)=>(P(),N("div",{key:U,class:"d-flex align-center turn-row"},[C("div",Fs,ee(U+1)+".",1),C("div",{class:Me([{"current-move":Be(U*2)},"move-item flex-grow-1"]),onClick:et=>$e(U*2),innerHTML:ae(He)(_e.white)},null,10,Ws),_e.black?(P(),N("div",{key:0,class:Me([{"current-move":Be(U*2+1)},"move-item flex-grow-1"]),onClick:et=>$e(U*2+1),innerHTML:ae(He)(_e.black)},null,10,js)):(P(),N("div",Gs))]))),128))],512)],512),w(M),C("div",Us,[I.value?(P(),Te(q,{key:0,title:I.value.n,subtitle:I.value.e,"prepend-icon":"mdi-book-open-page-variant-outline",density:"compact"},null,8,["title","subtitle"])):xe("",!0)]),w(Eo,{class:"pa-2"},{default:W(()=>[w(Ee,{variant:"text",density:"comfortable"},{default:W(()=>[w(E,{onClick:ue,icon:"mdi-skip-previous",title:" "}),w(E,{onClick:de,icon:"mdi-chevron-left",title:""}),w(E,{onClick:F,icon:"mdi-chevron-right",title:""}),w(E,{onClick:Z,icon:"mdi-skip-next",title:" "})]),_:1}),w(Mt),w(E,{onClick:u,variant:"text",icon:"mdi-rotate-3d-variant",title:" "}),w(E,{href:H.value,target:"_blank","prepend-icon":"mdi-open-in-new",variant:"text"},{default:W(()=>[...k[2]||(k[2]=[ze("  ",-1)])]),_:1},8,["href"])]),_:1})]),_:1})])])):(P(),N("div",Qs,[C("div",zs,[w(je,{player:K.value,"captured-pieces":x.value[K.value.color],advantage:m.value.advantage[K.value.color]},null,8,["player","captured-pieces","advantage"]),C("div",Zs,[w(ae(Vt),{"board-config":d,"reactive-config":"",onBoardCreated:h},null,8,["board-config"])]),w(je,{player:y.value,"captured-pieces":x.value[y.value.color],advantage:m.value.advantage[y.value.color]},null,8,["player","captured-pieces","advantage"])]),C("div",Ys,[w(Mo,{flat:"",density:"compact",color:"transparent"},{default:W(()=>[w(E,{onClick:u,variant:"text",icon:"mdi-rotate-3d-variant"}),w(Mt),w(Ee,{variant:"text",density:"comfortable"},{default:W(()=>[w(E,{onClick:de,icon:"mdi-chevron-left"}),w(E,{onClick:F,icon:"mdi-chevron-right"})]),_:1})]),_:1}),w(M),C("div",Xs,[w(re,{label:"",color:"primary",variant:"elevated",size:"small",class:"mr-2"},{default:W(()=>[C("span",Js,ee(A.value),1)]),_:1}),I.value?(P(),N("div",en,ee(I.value.n)+" ("+ee(I.value.e)+") ",1)):xe("",!0)]),w(M),C("div",{class:"moves-scroll-area",ref_key:"scrollWrapper",ref:l},[C("div",{class:"pa-2 moves-container",ref_key:"movesContainer",ref:c},[(P(!0),N(Ue,null,Qe(ne.value,(_e,U)=>(P(),N("div",{key:U,class:"d-flex align-center turn-row"},[C("div",tn,ee(U+1)+".",1),C("div",{class:Me([{"current-move":Be(U*2)},"move-item flex-grow-1"]),onClick:et=>$e(U*2),innerHTML:ae(He)(_e.white)},null,10,on),_e.black?(P(),N("div",{key:0,class:Me([{"current-move":Be(U*2+1)},"move-item flex-grow-1"]),onClick:et=>$e(U*2+1),innerHTML:ae(He)(_e.black)},null,10,rn)):(P(),N("div",sn))]))),128))],512)],512)])]))])):xe("",!0)])}}},dn=ft(nn,[["__scopeId","data-v-fdc73003"]]);export{dn as default};
