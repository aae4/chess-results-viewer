import{E as z,j as o,c as r,u as j,G as s}from"./index-D-xIhes9.js";import{f as b}from"./formatters-C8Ln7w-r.js";const J=z("player",()=>{const p=o(null),l=o([]),v=o(null),y=o(!1),g=o(!1),m=o(null),_=o([]),h=o(!1),w=o(null),c=o(null),P=o(null),i=o(null),u=o([]),d=o(!1),H=r(()=>{const e={gold:0,silver:0,bronze:0,tournaments:l.value.length};return l.value&&l.value.forEach(t=>{t.final_rank===1?e.gold++:t.final_rank===2?e.silver++:t.final_rank===3&&e.bronze++}),e}),E=r(()=>!l.value||l.value.length===0?{labels:[],datasets:[]}:{datasets:[{label:"Рейтинг FIDE",backgroundColor:"rgba(0, 82, 204, 0.2)",borderColor:"#0052CC",pointBackgroundColor:"#0052CC",pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBackgroundColor:"white",data:l.value.filter(t=>t.start_date&&t.rating_at_tournament).map(t=>({x:t.start_date,y:t.rating_at_tournament,tournamentName:t.tournament_name,ratingChange:t.rating_change})),fill:!0,tension:.1}]}),L=r(()=>{const t=j().currentTournament;return!t||!l.value||l.value.length===0?null:l.value.find(a=>a.tournament_id===t.id)||null}),R=r(()=>{const e={peakRating:0,latestRating:0};if(!l.value)return e;let t="";return l.value.forEach(a=>{a.rating_at_tournament>e.peakRating&&(e.peakRating=a.rating_at_tournament),a.start_date>t&&(t=a.start_date,e.latestRating=a.rating_at_tournament)}),e}),G=r(()=>{const e={wins:0,draws:0,losses:0,total:0,score:0,percent:0},t={vs_stronger:{...e},vs_equal:{...e},vs_weaker:{...e}};return c.value&&c.value.forEach(a=>{const{opponent_category:n,wins:f,draws:S,losses:C}=a;t[n]={wins:f,draws:S,losses:C,total:f+S+C,score:f+S*.5},t[n].percent=Math.round(t[n].score/t[n].total*100)}),t}),x=r(()=>i.value?i.value:[]),A=r(()=>{const e={white:{w:0,d:0,l:0,total:0,score:0,winPercent:0},black:{w:0,d:0,l:0,total:0,score:0,winPercent:0},total:{w:0,d:0,l:0,total:0,score:0,winPercent:0}};return!u.value||u.value.length===0||(u.value.forEach(t=>{const a=b(t.result,t.player_color),n=t.player_color==="w"?"white":"black";a==="1"?(e[n].w++,e.total.w++):a==="½"?(e[n].d++,e.total.d++):a==="0"&&(e[n].l++,e.total.l++)}),["white","black","total"].forEach(t=>{const a=e[t];a.total=a.w+a.d+a.l,a.score=a.w+a.d*.5,a.total>0&&(a.winPercent=Math.round(a.w/a.total*100))})),e}),D=r(()=>{const e={opening:{score:0,total:0},middlegame:{score:0,total:0},endgame:{score:0,total:0}};return u.value.forEach(t=>{const a=b(t.result,t.player_color),n=a==="1"?1:a==="½"?.5:0,f=t.round/t.rounds_count;f<=.34?(e.opening.score+=n,e.opening.total++):f<=.67?(e.middlegame.score+=n,e.middlegame.total++):(e.endgame.score+=n,e.endgame.total++)}),Object.values(e).forEach(t=>{t.percent=t.total>0?Math.round(t.score/t.total*100):0}),e}),O=r(()=>{let e={opponent_rating:0,opponent_name:null,game_id:null},t={opponent_rating:1/0,opponent_name:null,game_id:null};return u.value.forEach(a=>{const n=b(a.result,a.player_color);n==="1"&&a.opponent_rating>e.opponent_rating&&(e=a),n==="0"&&a.opponent_rating<t.opponent_rating&&(t=a)}),{bestWin:e.game_id?e:null,worstLoss:t.game_id?t:null}});async function B(e){y.value=!0,m.value=null,v.value=null,k(e);try{const[t,a]=await Promise.all([s.getPlayerGlobalProfile(e),s.getPlayerCareer(e)]);p.value=t,l.value=a}catch(t){m.value=t.message,console.error("Ошибка при загрузке глобального профиля игрока:",t)}finally{y.value=!1}}async function k(e){g.value=!0;try{const t=await s.getPlayerNextGame(e);v.value=t||null}catch(t){console.error("Ошибка при загрузке следующей игры:",t),v.value=null}finally{g.value=!1}}async function M(e){if(!c.value){d.value=!0;try{const[t,a,n]=await Promise.all([s.getPlayerOpponentStats(e),s.getPlayerOpeningStats(e),s.getPlayerGamesForAnalytics(e)]);c.value=t,P.value=a,u.value=n}catch(t){console.error("Ошибка при загрузке аналитики:",t)}finally{d.value=!1}}}async function N(e){if(!i.value){d.value=!0;try{i.value=await s.getPlayerHeadToHead(e)}catch(t){console.error("Ошибка при загрузке H2H:",t)}finally{d.value=!1}}}function T(){p.value=null,l.value=[],v.value=null,g.value=!1,c.value=null,P.value=null,i.value=null,u.value=[]}async function W(){if(!(_.value.length>0)){h.value=!0,w.value=null;try{_.value=await s.getAllPlayersWithStatsOptimized()}catch(e){w.value=e.message,console.error("Ошибка при загрузке списка всех игроков:",e)}finally{h.value=!1}}}return{playerProfile:p,playerCareer:l,nextGame:v,isLoading:y,isLoadingNextGame:g,error:m,careerStats:H,ratingHistory:E,keyMetrics:R,fetchPlayerData:B,fetchNextGame:k,clearPlayerData:T,playerList:_,isLoadingList:h,errorList:w,fetchAllPlayers:W,opponentStats:c,openingStats:P,h2hStats:i,isLoadingAnalytics:d,processedOpponentStats:G,processedH2HStats:x,fetchPlayerAnalytics:M,fetchPlayerH2H:N,careerPerformanceStats:A,performanceByRounds:D,notableResults:O,participationInCurrentTournament:L}});export{J as u};
