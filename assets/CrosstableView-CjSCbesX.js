import{u as Q,A as W,c as L,a as i,d as v,l as h,b as p,r as c,w as r,C as X,H as Y,f as n,e as s,F as x,i as w,t as _,D as Z,K as tt,g as I,h as z}from"./index-BFxfVSnb.js";import{b as et,f as nt,c as M,d as S}from"./formatters-CuXF23sB.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ot(R,f){if(!R||R.length===0)return[];const u=new Map;return R.forEach(l=>{u.has(l.player_id)||u.set(l.player_id,{player_id:l.player_id,player_name:l.player_name,starting_rank:l.starting_rank,results:new Array(f).fill(null),games:[],totalPoints:0}),u.get(l.player_id).games.push(l)}),u.forEach(l=>{let m=0;l.games.forEach(d=>{if(!d.round||!d.opponent_player_id)return;const A=parseInt(d.round)-1,y=et(nt(d.result,d.color));y!==null&&(m+=y);const B=u.get(d.opponent_player_id);l.results[A]={points:y,color:d.color,opponent_name:d.opponent_name,opponent_starting_rank:B?.starting_rank||"?",game_id:d.game_id}}),l.totalPoints=m}),Array.from(u.values()).sort((l,m)=>m.totalPoints!==l.totalPoints?m.totalPoints-l.totalPoints:l.starting_rank-m.starting_rank)}const at={key:0,class:"text-center pa-10"},lt={class:"text-center rank-col sticky-col"},it={class:"player-col sticky-col"},rt=["onClick"],ct=["onClick"],_t={class:"mr-1"},pt={key:1},dt={class:"text-center points-col font-weight-bold text-h6"},ut={key:2,class:"mobile-crosstable"},mt={class:"d-flex align-center w-100"},ft={class:"mr-4 text-medium-emphasis"},vt={class:"d-flex flex-column"},gt={class:"font-weight-bold text-subtitle-1"},ht={class:"text-caption"},xt={class:"d-flex flex-column h-100"},yt={class:"d-flex justify-space-between align-center mb-1"},kt={class:"text-caption font-weight-bold text-medium-emphasis"},bt={class:"d-flex align-center"},Ct={key:1,class:"opponent-name text-body-1"},Pt={key:2,class:"opponent-name text-body-1 text-medium-emphasis"},wt={__name:"CrosstableView",setup(R){const f=Q(),u=X(),D=Y(),l=W(),m=L(()=>{if(f.activeTournament?.rounds_count>0)return Array.from({length:f.activeTournament.rounds_count},(t,o)=>o+1);if(f.games?.length>0){const t=Math.max(...f.games.map(o=>parseInt(o.round)||0));return t>0?Array.from({length:t},(o,k)=>k+1):[1]}return[1]}),d=L(()=>ot(f.crosstableData,m.value.length)),A=(t,o)=>{const k=t.results[o-1],b=t.results.slice(0,o-1).reduce((C,P)=>C+(P?.points||0),0),T=t.results.slice(0,o).reduce((C,P)=>C+(P?.points||0),0);return!k&&T>b},y=t=>{t&&u.push({name:"Player",params:{tournamentId:D.params.tournamentId,playerId:t}})},B=t=>{t&&t.game_id&&u.push({name:"Game",params:{gameId:t.game_id}})},$=t=>t?t.points===1?"result-win":t.points===.5?"result-draw":t.points===0?"result-loss":"":"",G=t=>t===1?"success":t===.5?"grey":t===0?"error":"default";return(t,o)=>{const k=c("v-progress-circular"),b=c("v-icon"),T=c("v-tooltip"),C=c("v-table"),P=c("v-card-text"),N=c("v-card"),j=c("v-spacer"),V=c("v-chip"),H=c("v-expansion-panel-title"),F=c("v-divider"),K=c("v-list-item"),U=c("v-list"),q=c("v-expansion-panel-text"),J=c("v-expansion-panel"),O=c("v-expansion-panels");return n(),i("div",null,[h(f).isLoadingDetails?(n(),i("div",at,[p(k,{indeterminate:"",color:"primary"})])):h(l).mdAndUp.value?(n(),v(N,{key:1},{default:r(()=>[p(P,{class:"crosstable-wrapper pa-0"},{default:r(()=>[p(C,{class:"crosstable",density:"compact"},{default:r(()=>[s("thead",null,[s("tr",null,[o[0]||(o[0]=s("th",{class:"rank-col sticky-col"},"#",-1)),o[1]||(o[1]=s("th",{class:"player-col sticky-col"},"Игрок",-1)),(n(!0),i(x,null,w(m.value,a=>(n(),i("th",{key:a,class:"text-center round-col"},_(a),1))),128)),o[2]||(o[2]=s("th",{class:"text-center points-col"},"Очки",-1))])]),s("tbody",null,[(n(!0),i(x,null,w(d.value,a=>(n(),i("tr",{key:a.player_id},[s("td",lt,_(a.starting_rank),1),s("td",it,[s("div",{onClick:e=>y(a.player_id),class:"player-link text-subtitle-1 font-weight-medium"},_(a.player_name),9,rt)]),(n(!0),i(x,null,w(a.results,(e,g)=>(n(),i("td",{key:g,class:Z(["text-center round-col result-cell",$(e)]),onClick:E=>B(e)},[e?(n(),v(T,{key:0,location:"top",disabled:!e.opponent_name},{activator:r(({props:E})=>[s("div",tt({ref_for:!0},E,{class:"cell-content"}),[s("span",_t,_(e.opponent_starting_rank),1),p(b,{icon:h(S)(e.color),size:"x-small"},null,8,["icon"])],16)]),default:r(()=>[s("span",null,_(h(M)(e.points))+" vs "+_(e.opponent_name),1)]),_:2},1032,["disabled"])):(n(),i("span",pt,"-"))],10,ct))),128)),s("td",dt,_(a.totalPoints),1)]))),128))])]),_:1})]),_:1})]),_:1})):(n(),i("div",ut,[p(O,{variant:"accordion"},{default:r(()=>[(n(!0),i(x,null,w(d.value,a=>(n(),v(J,{key:a.player_id,rounded:"lg",class:"mb-2 elevation-1"},{default:r(()=>[p(H,null,{default:r(()=>[s("div",mt,[s("span",ft,_(a.starting_rank),1),s("div",vt,[s("span",gt,_(a.player_name.split(",")[0]),1),s("span",ht,_(a.player_name.split(",")[1]),1)]),p(j),p(V,{label:"",size:"large",class:"font-weight-bold",variant:"tonal",color:"primary"},{default:r(()=>[I(_(a.totalPoints),1)]),_:2},1024)])]),_:2},1024),p(q,{class:"pa-0"},{default:r(()=>[p(F),p(U,{class:"py-0"},{default:r(()=>[(n(!0),i(x,null,w(a.results,(e,g)=>(n(),i(x,null,[e||A(a,g+1)?(n(),i("div",{key:g},[p(K,{disabled:!e||!e.game_id,onClick:E=>B(e),class:"game-list-item",lines:"two"},{append:r(()=>[e&&e.game_id?(n(),v(b,{key:0,color:"medium-emphasis"},{default:r(()=>[...o[4]||(o[4]=[I("mdi-chevron-right",-1)])]),_:1})):z("",!0)]),default:r(()=>[s("div",xt,[s("div",yt,[s("span",kt,"ТУР "+_(g+1),1),e?(n(),v(V,{key:0,color:G(e.points),label:"",size:"small",variant:"text",class:"font-weight-bold px-1"},{default:r(()=>[I(_(h(M)(e.points)),1)]),_:2},1032,["color"])):A(a,g+1)?(n(),v(V,{key:1,label:"",size:"small",variant:"text",class:"font-weight-bold px-1"},{default:r(()=>[...o[3]||(o[3]=[I(" +1 (Bye) ",-1)])]),_:1})):z("",!0)]),s("div",bt,[e?(n(),v(b,{key:0,icon:h(S)(e.color),size:"small",class:"mr-2"},null,8,["icon"])):z("",!0),e?(n(),i("span",Ct,"vs "+_(e.opponent_name),1)):(n(),i("span",Pt,"Пропуск тура"))])])]),_:2},1032,["disabled","onClick"]),p(F)])):z("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))])}}},It=st(wt,[["__scopeId","data-v-117e5e4f"]]);export{It as default};
