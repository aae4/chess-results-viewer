import{_ as Q,c as U,a as R,u as X,b as l,f as c,e as t,n as Y,i as m,j as d,d as P,h as S,g as a,t as o,F as Z,k as tt,x as z,y as et,z as B}from"./index-BVeWO99H.js";import{u as lt}from"./tournamentStore-BCHhv6ko.js";import{f as E}from"./formatters-D4D2rNmP.js";import{h as st}from"./pgn-B4xuOwQ5.js";import{C as j}from"./chess-DX7QKCjj.js";const nt={key:0,class:"text-center pa-10"},at={key:1,class:"text-center text-grey pa-10"},it={key:2},ot={class:"text-h6"},rt={class:"text-h5 font-weight-bold text-success"},ut={class:"text-h6"},dt={class:"text-h5 font-weight-bold"},ct={class:"stacked-bar mb-4"},_t={class:"results-legend"},vt={class:"legend-item"},mt={class:"text-caption"},pt={class:"legend-item"},ft={class:"text-caption"},gt={class:"legend-item"},bt={class:"text-caption"},yt={class:"text-caption text-grey"},wt={class:"stacked-bar-mini my-1"},ht={__name:"StatisticsView",setup(kt){const x=lt(),L=Y(),e=U(()=>{const y=x.participants,s=x.statisticsData,C=x.standings;if(!y.length||!s.length||!C.length)return null;const w=y.length,b=x.activeTournament?.rounds_count||0,$=Math.round(y.reduce((n,r)=>n+(r.rating||0),0)/y.length);let p=0,_=0,G=0,h={moves:1/0,game:null},O={moves:0,game:null},V=0,W=0;const f={},D={};let M=0,T=0;s.forEach(n=>{const r=E(n.result);if(r==="1-0"?p++:r==="0-1"?_++:r==="½-½"&&(G++,D[n.white_player_id]=(D[n.white_player_id]||0)+1,D[n.black_player_id]=(D[n.black_player_id]||0)+1),n.pgn_moves){const g=new j;g.loadPgn(n.pgn_moves);const k=g.history();try{const v=new j;v.loadPgn(n.pgn_moves);const u=v.history().length/2;u>0&&(W++,V+=u,u<h.moves&&(h={moves:Math.ceil(u),game:n}),u>O.moves&&(O={moves:Math.ceil(u),game:n}))}catch{}if(k.forEach(v=>{(v==="O-O"||v==="O-O-O")&&M++,v.includes("=")&&T++}),n.pgn_moves&&x.ecoDatabase)try{let v=null;for(let u=Math.min(k.length,20);u>0;u--){const N=st(k.slice(0,u));if(x.ecoDatabase[N]){v=x.ecoDatabase[N];break}}if(v){const u=v.e;f[u]||(f[u]={eco:u,name:v.n,count:0,white:0,draw:0,black:0}),f[u].count++,r==="1-0"?f[u].white++:r==="0-1"?f[u].black++:r==="½-½"&&f[u].draw++}}catch{}}});const i=p+_+G,I={whiteWins:p,blackWins:_,draws:G,whiteWinPercent:i>0?Math.round(p/i*100):0,blackWinPercent:i>0?Math.round(_/i*100):0,drawPercent:i>0?Math.round(G/i*100):0},q=y.map(n=>{const r=s.filter(k=>k.white_player_id===n.id||k.black_player_id===n.id).length,g=D[n.id]||0;return{player:n,drawRate:r>0?g/r*100:100}}).sort((n,r)=>n.drawRate-r.drawRate)[0],A=C.filter(n=>n.performance_rating&&n.rating_at_tournament).map(n=>({player:n,diff:n.performance_rating-n.rating_at_tournament})).sort((n,r)=>r.diff-n.diff)[0],J=C.filter(n=>!s.filter(g=>g.white_player_id===n.player_id||g.black_player_id===n.player_id).some(g=>{const k=E(g.result);return g.white_player_id===n.player_id&&k==="0-1"||g.black_player_id===n.player_id&&k==="1-0"})),K=Object.values(f).sort((n,r)=>r.count-n.count||n.name.localeCompare(r.name)).slice(0,10);return{totalPlayers:w,totalRounds:b,averageRating:$,resultDistribution:I,shortestGame:h,longestGame:O,averageMoveCount:W>0?Math.round(V/W):0,biggestOverperformer:A,undefeatedPlayers:J,mostDecisivePlayer:q,topOpenings:K,totalCastles:M,totalPromotions:T}}),H=[{title:"Дебют",key:"name",sortable:!1,align:"start"},{title:"Партий",key:"count",sortable:!1,align:"center",width:"120px"},{title:"Результаты (Б/Н/Ч)",key:"results",sortable:!1,align:"center",width:"200px"}],F=y=>{y&&L.push({name:"Game",params:{gameId:y}})};return(y,s)=>{const C=c("v-progress-circular"),w=c("v-card-title"),b=c("v-list-item"),$=c("v-list"),p=c("v-card"),_=c("v-col"),G=c("v-icon"),h=c("v-card-text"),O=c("v-card-subtitle"),V=c("v-chip"),W=c("v-row"),f=c("v-tooltip"),D=c("v-list-item-title"),M=c("v-list-item-subtitle"),T=c("v-data-table");return m(),R("div",null,[X(x).isLoadingDetails?(m(),R("div",nt,[l(C,{indeterminate:"",color:"primary"})])):e.value?(m(),R("div",it,[l(W,null,{default:t(()=>[l(_,{cols:"12",md:"4"},{default:t(()=>[l(W,null,{default:t(()=>[l(_,{cols:"12"},{default:t(()=>[l(p,null,{default:t(()=>[l(w,null,{default:t(()=>[...s[2]||(s[2]=[d("Обзор турнира",-1)])]),_:1}),l($,{density:"compact"},{default:t(()=>[l(b,{title:`${e.value.totalPlayers}`,subtitle:"Участников","prepend-icon":"mdi-account-group-outline"},null,8,["title"]),l(b,{title:`${e.value.totalRounds}`,subtitle:"Туров","prepend-icon":"mdi-recycle"},null,8,["title"]),l(b,{title:`${e.value.averageRating}`,subtitle:"Средний рейтинг","prepend-icon":"mdi-finance"},null,8,["title"])]),_:1})]),_:1})]),_:1}),l(_,{cols:"12"},{default:t(()=>[l(p,{class:"text-center pa-4 fill-height"},{default:t(()=>[l(G,{size:"x-large",color:"amber"},{default:t(()=>[...s[3]||(s[3]=[d("mdi-rocket-launch-outline",-1)])]),_:1}),l(w,null,{default:t(()=>[...s[4]||(s[4]=[d("Главный прорыв",-1)])]),_:1}),e.value.biggestOverperformer?(m(),P(h,{key:0},{default:t(()=>[a("div",ot,o(e.value.biggestOverperformer.player.name),1),a("div",rt,"+"+o(e.value.biggestOverperformer.diff),1),s[5]||(s[5]=a("div",{class:"text-caption"},"пунктов перфоманса к рейтингу",-1))]),_:1})):S("",!0)]),_:1})]),_:1}),l(_,{cols:"12"},{default:t(()=>[l(p,{class:"text-center pa-4 fill-height"},{default:t(()=>[l(G,{size:"x-large",color:"red-lighten-1"},{default:t(()=>[...s[6]||(s[6]=[d("mdi-sword-cross",-1)])]),_:1}),l(w,null,{default:t(()=>[...s[7]||(s[7]=[d("Самый бескомпромиссный",-1)])]),_:1}),e.value.mostDecisivePlayer?(m(),P(h,{key:0},{default:t(()=>[a("div",ut,o(e.value.mostDecisivePlayer.player.name),1),a("div",dt,o(e.value.mostDecisivePlayer.drawRate.toFixed(0))+"% ничьих",1),s[8]||(s[8]=a("div",{class:"text-caption"},"самый низкий процент в турнире",-1))]),_:1})):S("",!0)]),_:1})]),_:1}),l(_,{cols:"12"},{default:t(()=>[l(p,null,{default:t(()=>[l(w,null,{default:t(()=>[...s[9]||(s[9]=[d("Непобежденные игроки",-1)])]),_:1}),e.value.undefeatedPlayers.length>0?(m(),P(O,{key:0},{default:t(()=>[d("Всего: "+o(e.value.undefeatedPlayers.length),1)]),_:1})):S("",!0),e.value.undefeatedPlayers.length>0?(m(),P(h,{key:1},{default:t(()=>[(m(!0),R(Z,null,tt(e.value.undefeatedPlayers,i=>(m(),P(V,{key:i.name,class:"ma-1"},{default:t(()=>[d(o(i.name)+" ("+o(i.score)+")",1)]),_:2},1024))),128))]),_:1})):(m(),P(h,{key:2,class:"text-center text-grey"},{default:t(()=>[...s[10]||(s[10]=[d("Таких игроков нет.",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),l(_,{cols:"12",md:"8"},{default:t(()=>[l(W,null,{default:t(()=>[l(_,{cols:"12"},{default:t(()=>[l(p,null,{default:t(()=>[l(w,null,{default:t(()=>[...s[11]||(s[11]=[d("Распределение результатов",-1)])]),_:1}),l(h,null,{default:t(()=>[a("div",ct,[l(f,{location:"top"},{activator:t(({props:i})=>[a("div",z(i,{class:"bar-segment white-wins",style:{width:e.value.resultDistribution.whiteWinPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Белые: "+o(e.value.resultDistribution.whiteWins)+" ("+o(e.value.resultDistribution.whiteWinPercent)+"%)",1)]),_:1}),l(f,{location:"top"},{activator:t(({props:i})=>[a("div",z(i,{class:"bar-segment draws",style:{width:e.value.resultDistribution.drawPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Ничьи: "+o(e.value.resultDistribution.draws)+" ("+o(e.value.resultDistribution.drawPercent)+"%)",1)]),_:1}),l(f,{location:"top"},{activator:t(({props:i})=>[a("div",z(i,{class:"bar-segment black-wins",style:{width:e.value.resultDistribution.blackWinPercent+"%"}}),null,16)]),default:t(()=>[a("span",null,"Черные: "+o(e.value.resultDistribution.blackWins)+" ("+o(e.value.resultDistribution.blackWinPercent)+"%)",1)]),_:1})]),a("div",_t,[a("div",vt,[s[13]||(s[13]=a("span",{class:"legend-dot white-wins"},null,-1)),a("div",null,[s[12]||(s[12]=a("div",{class:"font-weight-bold"},"Победы белых",-1)),a("div",mt,o(e.value.resultDistribution.whiteWins)+" ("+o(e.value.resultDistribution.whiteWinPercent)+"%)",1)])]),a("div",pt,[s[15]||(s[15]=a("span",{class:"legend-dot draws"},null,-1)),a("div",null,[s[14]||(s[14]=a("div",{class:"font-weight-bold"},"Ничьи",-1)),a("div",ft,o(e.value.resultDistribution.draws)+" ("+o(e.value.resultDistribution.drawPercent)+"%)",1)])]),a("div",gt,[s[17]||(s[17]=a("span",{class:"legend-dot black-wins"},null,-1)),a("div",null,[s[16]||(s[16]=a("div",{class:"font-weight-bold"},"Победы черных",-1)),a("div",bt,o(e.value.resultDistribution.blackWins)+" ("+o(e.value.resultDistribution.blackWinPercent)+"%)",1)])])])]),_:1})]),_:1})]),_:1}),l(_,{cols:"12"},{default:t(()=>[l(p,null,{default:t(()=>[l(w,null,{default:t(()=>[...s[18]||(s[18]=[d("Динамика партий",-1)])]),_:1}),l($,null,{default:t(()=>[e.value.longestGame?(m(),P(b,{key:0,"prepend-icon":"mdi-timer-sand-complete",onClick:s[0]||(s[0]=i=>F(e.value.longestGame.game.id)),style:{cursor:"pointer"}},{default:t(()=>[l(D,null,{default:t(()=>[d("Самая длинная партия: "+o(e.value.longestGame.moves)+" ходов",1)]),_:1}),l(M,null,{default:t(()=>[d(o(e.value.longestGame.game.white_name)+" vs "+o(e.value.longestGame.game.black_name),1)]),_:1})]),_:1})):S("",!0),e.value.shortestGame?(m(),P(b,{key:1,"prepend-icon":"mdi-timer-sand-empty",onClick:s[1]||(s[1]=i=>F(e.value.shortestGame.game.id)),style:{cursor:"pointer"}},{default:t(()=>[l(D,null,{default:t(()=>[d("Самая короткая партия: "+o(e.value.shortestGame.moves)+" ходов",1)]),_:1}),l(M,null,{default:t(()=>[d(o(e.value.shortestGame.game.white_name)+" vs "+o(e.value.shortestGame.game.black_name),1)]),_:1})]),_:1})):S("",!0),l(b,{"prepend-icon":"mdi-timer-sand",title:`Средняя длина партии: ${e.value.averageMoveCount} ходов`},null,8,["title"]),l(b,{"prepend-icon":"mdi-chess-rook",title:`Всего рокировок: ${e.value.totalCastles}`},null,8,["title"]),l(b,{"prepend-icon":"mdi-chess-pawn",title:`Всего превращений пешек: ${e.value.totalPromotions}`},null,8,["title"])]),_:1})]),_:1})]),_:1}),l(_,{cols:"12"},{default:t(()=>[l(p,null,{default:t(()=>[l(w,null,{default:t(()=>[...s[19]||(s[19]=[d("Дебютные тренды",-1)])]),_:1}),l(T,{headers:H,items:e.value.topOpenings,"items-per-page":10,density:"compact"},et({"item.name":t(({item:i})=>[a("div",null,o(i.name),1),a("div",yt,o(i.eco),1)]),"item.results":t(({item:i})=>[a("div",wt,[a("div",{class:"bar-segment white-wins",style:B({width:i.white/i.count*100+"%"})},null,4),a("div",{class:"bar-segment draws",style:B({width:i.draw/i.count*100+"%"})},null,4),a("div",{class:"bar-segment black-wins",style:B({width:i.black/i.count*100+"%"})},null,4)])]),_:2},[e.value.resultDistribution?{name:"item.count",fn:t(({item:i})=>[d(o(i.count)+" ("+o((i.count/(e.value.resultDistribution.whiteWins+e.value.resultDistribution.blackWins+e.value.resultDistribution.draws)*100).toFixed(0))+"%) ",1)]),key:"0"}:void 0]),1032,["items"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):(m(),R("div",at," Недостаточно данных для генерации статистики. "))])}}},Ct=Q(ht,[["__scopeId","data-v-fb16d7da"]]);export{Ct as default};
