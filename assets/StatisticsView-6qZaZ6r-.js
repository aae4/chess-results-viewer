import{u as M,m as U,c as $,a as v,l as B,b as s,r as d,e as a,w as e,g as o,G as q,f as r,t as i,d as u,h as _,F as S,i as R,n as W,N as J,O as y}from"./index-Dt_vqeZS.js";import{c as K}from"./statisticsCalculator-WJirSdA7.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./formatters-C8Ln7w-r.js";import"./chess-f0FuLRjZ.js";const X={key:0,class:"text-center pa-10"},Y={key:1,class:"text-center text-medium-emphasis pa-10"},Z={key:2},tt={class:"text-h4 font-weight-bold"},et={class:"text-h4 font-weight-bold"},st={class:"text-h4 font-weight-bold"},lt={class:"text-h4 font-weight-bold text-success my-1"},at={class:"text-h4 font-weight-bold my-1"},nt={class:"text-caption"},it={class:"stacked-bar mb-2"},ot={class:"d-flex justify-center flex-wrap ga-4 text-caption"},rt={class:"d-flex align-center"},dt={class:"d-flex align-center"},ut={class:"d-flex align-center"},ct={key:2,class:"text-caption text-medium-emphasis text-center py-2"},mt={class:"font-weight-bold"},vt={class:"font-weight-bold"},pt={class:"font-weight-bold"},gt={key:1},ft={class:"text-caption text-grey"},_t={class:"stacked-bar-mini my-1"},yt={class:"stacked-bar-mini my-2"},bt={key:2,class:"text-center text-medium-emphasis pa-4"},xt={__name:"StatisticsView",setup(kt){const p=M(),T=q(),j=U(),l=$(()=>!p.participants.length||!p.statisticsData.length?null:K({participants:p.participants,gamesForStats:p.statisticsData,standings:p.standings,tournamentDetails:p.activeTournament,ecoDatabase:p.ecoDatabase})),b=$(()=>!l.value||!l.value.resultDistribution?0:l.value.resultDistribution.totalGames||0),L=[{title:"Дебют",key:"name",sortable:!1,align:"start",width:"50%"},{title:"Партий",key:"count",sortable:!1,align:"center",width:"15%"},{title:"Результаты (Б/Н/Ч)",key:"results",sortable:!1,align:"start",width:"35%"}],F=f=>{f&&T.push({name:"Game",params:{gameId:f}})},D=f=>{f&&T.push({name:"Player",params:{tournamentId:p.activeTournament.id,playerId:f}})};return(f,t)=>{const A=d("v-progress-circular"),c=d("v-icon"),P=d("v-sheet"),m=d("v-col"),x=d("v-row"),k=d("v-card-title"),g=d("v-card-text"),w=d("v-card"),E=d("v-card-subtitle"),H=d("v-chip"),h=d("v-divider"),G=d("v-tooltip"),C=d("v-list-item-title"),O=d("v-list-item-subtitle"),z=d("v-list-item"),V=d("v-list"),I=d("v-data-table");return r(),v("div",null,[B(p).isLoadingDetails?(r(),v("div",X,[s(A,{indeterminate:"",color:"primary",size:"64"})])):!l.value||b.value===0?(r(),v("div",Y,[s(c,{size:"64",class:"mb-4"},{default:e(()=>[...t[4]||(t[4]=[o("mdi-chart-bar-off",-1)])]),_:1}),t[5]||(t[5]=a("div",{class:"text-h6"},"Статистика недоступна",-1)),t[6]||(t[6]=a("div",{class:"text-body-2 mt-2"},[o(" Пока недостаточно данных о сыгранных партиях. "),a("br"),o(" Статистика появится после завершения первых игр и ввода ходов. ")],-1))])):(r(),v("div",Z,[s(x,{class:"mb-4"},{default:e(()=>[s(m,{cols:"12",sm:"4"},{default:e(()=>[s(P,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:e(()=>[s(c,{size:"48",color:"primary",class:"mr-4"},{default:e(()=>[...t[7]||(t[7]=[o("mdi-account-group-outline",-1)])]),_:1}),a("div",null,[a("div",tt,i(l.value.totalPlayers),1),t[8]||(t[8]=a("div",{class:"text-caption text-medium-emphasis"},"Участников",-1))])]),_:1})]),_:1}),s(m,{cols:"12",sm:"4"},{default:e(()=>[s(P,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:e(()=>[s(c,{size:"48",color:"primary",class:"mr-4"},{default:e(()=>[...t[9]||(t[9]=[o("mdi-recycle",-1)])]),_:1}),a("div",null,[a("div",et,i(l.value.totalRounds),1),t[10]||(t[10]=a("div",{class:"text-caption text-medium-emphasis"},"Туров",-1))])]),_:1})]),_:1}),s(m,{cols:"12",sm:"4"},{default:e(()=>[s(P,{rounded:"lg",class:"pa-4 text-center d-flex align-center stat-card"},{default:e(()=>[s(c,{size:"48",color:"primary",class:"mr-4"},{default:e(()=>[...t[11]||(t[11]=[o("mdi-finance",-1)])]),_:1}),a("div",null,[a("div",st,i(l.value.averageRating),1),t[12]||(t[12]=a("div",{class:"text-caption text-medium-emphasis"},"Средний рейтинг",-1))])]),_:1})]),_:1})]),_:1}),s(x,null,{default:e(()=>[s(m,{cols:"12",md:"4"},{default:e(()=>[s(x,null,{default:e(()=>[s(m,{cols:"12",sm:"6",md:"12"},{default:e(()=>[s(w,{class:"text-center pa-4 fill-height highlight-card"},{default:e(()=>[s(c,{size:"x-large",color:"amber"},{default:e(()=>[...t[13]||(t[13]=[o("mdi-rocket-launch-outline",-1)])]),_:1}),s(k,{class:"text-wrap"},{default:e(()=>[...t[14]||(t[14]=[o("Главный прорыв",-1)])]),_:1}),l.value.biggestOverperformer?(r(),u(g,{key:0,class:"d-flex flex-column flex-grow-1 justify-center"},{default:e(()=>[a("div",{class:"text-h6 cursor-pointer",onClick:t[0]||(t[0]=n=>D(l.value.biggestOverperformer.player.player_id))},i(l.value.biggestOverperformer.player.name),1),a("div",lt,"+"+i(l.value.biggestOverperformer.diff),1),t[15]||(t[15]=a("div",{class:"text-caption"},"пунктов перфоманса к рейтингу",-1))]),_:1})):(r(),u(g,{key:1,class:"text-medium-emphasis"},{default:e(()=>[...t[16]||(t[16]=[o("Нет данных для расчета",-1)])]),_:1}))]),_:1})]),_:1}),s(m,{cols:"12",sm:"6",md:"12"},{default:e(()=>[s(w,{class:"text-center pa-4 fill-height highlight-card"},{default:e(()=>[s(c,{size:"x-large",color:"red-lighten-1"},{default:e(()=>[...t[17]||(t[17]=[o("mdi-sword-cross",-1)])]),_:1}),s(k,{class:"text-wrap"},{default:e(()=>[...t[18]||(t[18]=[o("Самый бескомпромиссный",-1)])]),_:1}),l.value.mostDecisivePlayer?(r(),u(g,{key:0,class:"d-flex flex-column flex-grow-1 justify-center"},{default:e(()=>[a("div",{class:"text-h6 cursor-pointer",onClick:t[1]||(t[1]=n=>D(l.value.mostDecisivePlayer.player.player_id))},i(l.value.mostDecisivePlayer.player.name),1),a("div",at,i(l.value.mostDecisivePlayer.drawRate.toFixed(0))+"% ничьих",1),a("div",nt,"из "+i(l.value.mostDecisivePlayer.playedGames)+" сыгранных партий",1)]),_:1})):(r(),u(g,{key:1,class:"text-medium-emphasis"},{default:e(()=>[...t[19]||(t[19]=[o("Нет данных для расчета",-1)])]),_:1}))]),_:1})]),_:1}),s(m,{cols:"12"},{default:e(()=>[s(w,null,{default:e(()=>[s(k,null,{default:e(()=>[...t[20]||(t[20]=[o("Непобежденные игроки",-1)])]),_:1}),l.value.undefeatedPlayers?.length>0?(r(),u(E,{key:0},{default:e(()=>[o("Всего: "+i(l.value.undefeatedPlayers.length),1)]),_:1})):_("",!0),l.value.undefeatedPlayers?.length>0?(r(),u(g,{key:1},{default:e(()=>[(r(!0),v(S,null,R(l.value.undefeatedPlayers,n=>(r(),u(H,{key:n.id,class:"ma-1",onClick:N=>D(n.player_id),label:""},{default:e(()=>[o(i(n.name)+" ("+i(n.score)+")",1)]),_:2},1032,["onClick"]))),128))]),_:1})):(r(),u(g,{key:2,class:"text-center text-medium-emphasis"},{default:e(()=>[...t[21]||(t[21]=[o("Пока таких игроков нет.",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",md:"8"},{default:e(()=>[s(w,null,{default:e(()=>[s(k,null,{default:e(()=>[...t[22]||(t[22]=[o("Аналитика турнира",-1)])]),_:1}),s(h),l.value.resultDistribution?(r(),u(g,{key:0},{default:e(()=>[t[23]||(t[23]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"Распределение результатов",-1)),a("div",it,[s(G,{location:"top"},{activator:e(({props:n})=>[a("div",W(n,{class:"bar-segment bg-grey-lighten-2",style:{width:l.value.resultDistribution.whiteWinPercent+"%"}}),null,16)]),default:e(()=>[a("span",null,"Белые: "+i(l.value.resultDistribution.whiteWins)+" ("+i(l.value.resultDistribution.whiteWinPercent)+"%)",1)]),_:1}),s(G,{location:"top"},{activator:e(({props:n})=>[a("div",W(n,{class:"bar-segment bg-grey-darken-1",style:{width:l.value.resultDistribution.drawPercent+"%"}}),null,16)]),default:e(()=>[a("span",null,"Ничьи: "+i(l.value.resultDistribution.draws)+" ("+i(l.value.resultDistribution.drawPercent)+"%)",1)]),_:1}),s(G,{location:"top"},{activator:e(({props:n})=>[a("div",W(n,{class:"bar-segment bg-grey-darken-4",style:{width:l.value.resultDistribution.blackWinPercent+"%"}}),null,16)]),default:e(()=>[a("span",null,"Черные: "+i(l.value.resultDistribution.blackWins)+" ("+i(l.value.resultDistribution.blackWinPercent)+"%)",1)]),_:1})]),a("div",ot,[a("div",rt,[s(c,{icon:"mdi-circle-slice-8",color:"grey-lighten-2",class:"mr-1"}),o(" Победы белых ("+i(l.value.resultDistribution.whiteWinPercent)+"%)",1)]),a("div",dt,[s(c,{icon:"mdi-circle-slice-8",color:"grey-darken-1",class:"mr-1"}),o(" Ничьи ("+i(l.value.resultDistribution.drawPercent)+"%)",1)]),a("div",ut,[s(c,{icon:"mdi-circle-slice-8",color:"grey-darken-4",class:"mr-1"}),o(" Победы черных ("+i(l.value.resultDistribution.blackWinPercent)+"%)",1)])])]),_:1})):_("",!0),s(h,{class:"mx-4"}),s(g,null,{default:e(()=>[t[32]||(t[32]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-2"},"Динамика партий",-1)),s(V,{lines:"two",density:"compact"},{default:e(()=>[l.value.longestGame?.game?(r(),u(z,{key:0,class:"list-item-hover","prepend-icon":"mdi-timer-sand-complete",onClick:t[2]||(t[2]=n=>F(l.value.longestGame.game.id))},{default:e(()=>[s(C,null,{default:e(()=>[t[24]||(t[24]=o("Самая длинная партия: ",-1)),a("strong",null,i(l.value.longestGame.moves)+" ходов",1)]),_:1}),s(O,null,{default:e(()=>[o(i(l.value.longestGame.game.white_name)+" vs "+i(l.value.longestGame.game.black_name),1)]),_:1})]),_:1})):_("",!0),l.value.shortestGame?.game?(r(),u(z,{key:1,class:"list-item-hover","prepend-icon":"mdi-timer-sand-empty",onClick:t[3]||(t[3]=n=>F(l.value.shortestGame.game.id))},{default:e(()=>[s(C,null,{default:e(()=>[t[25]||(t[25]=o("Самая короткая партия: ",-1)),a("strong",null,i(l.value.shortestGame.moves)+" ходов",1)]),_:1}),s(O,null,{default:e(()=>[o(i(l.value.shortestGame.game.white_name)+" vs "+i(l.value.shortestGame.game.black_name),1)]),_:1})]),_:1})):_("",!0),!l.value.longestGame&&!l.value.shortestGame?(r(),v("div",ct," Нет данных о ходах в партиях. ")):_("",!0)]),_:1}),s(x,{dense:"",class:"text-center mt-2"},{default:e(()=>[s(m,null,{default:e(()=>[s(c,null,{default:e(()=>[...t[26]||(t[26]=[o("mdi-timer-sand",-1)])]),_:1}),a("div",mt,i(l.value.averageMoveCount),1),t[27]||(t[27]=a("div",{class:"text-caption"},"ср. длина",-1))]),_:1}),s(m,null,{default:e(()=>[s(c,null,{default:e(()=>[...t[28]||(t[28]=[o("mdi-chess-rook",-1)])]),_:1}),a("div",vt,i(l.value.totalCastles),1),t[29]||(t[29]=a("div",{class:"text-caption"},"рокировок",-1))]),_:1}),s(m,null,{default:e(()=>[s(c,null,{default:e(()=>[...t[30]||(t[30]=[o("mdi-chess-pawn",-1)])]),_:1}),a("div",pt,i(l.value.totalPromotions),1),t[31]||(t[31]=a("div",{class:"text-caption"},"превращений",-1))]),_:1})]),_:1})]),_:1}),s(h,{class:"mx-4"}),s(g,null,{default:e(()=>[...t[33]||(t[33]=[a("h3",{class:"text-subtitle-1 font-weight-bold mb-2"},"Дебютные тренды",-1)])]),_:1}),l.value.topOpenings?.length>0?(r(),v("div",gt,[B(j).mdAndUp.value?(r(),u(I,{key:0,headers:L,items:l.value.topOpenings,"items-per-page":10,density:"compact"},J({"item.name":e(({item:n})=>[a("div",null,i(n.name),1),a("div",ft,i(n.eco),1)]),"item.results":e(({item:n})=>[a("div",_t,[a("div",{class:"bar-segment bg-grey-lighten-2",style:y({width:n.white/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-1",style:y({width:n.draw/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-4",style:y({width:n.black/n.count*100+"%"})},null,4)])]),_:2},[l.value.resultDistribution?{name:"item.count",fn:e(({item:n})=>[o(i(n.count)+" ("+i(b.value>0?(n.count/b.value*100).toFixed(0):0)+"%)",1)]),key:"0"}:void 0]),1032,["items"])):(r(),u(V,{key:1,lines:"three",class:"py-0"},{default:e(()=>[(r(!0),v(S,null,R(l.value.topOpenings,(n,N)=>(r(),v(S,{key:n.eco},[s(z,null,{default:e(()=>[s(C,{class:"font-weight-medium text-wrap"},{default:e(()=>[o(i(n.name),1)]),_:2},1024),s(O,{class:"mt-1"},{default:e(()=>[o(i(n.eco)+" · "+i(n.count)+" "+i(n.count>1?"партии":"партия")+" ("+i(b.value>0?(n.count/b.value*100).toFixed(0):0)+"%)",1)]),_:2},1024),a("div",yt,[a("div",{class:"bar-segment bg-grey-lighten-2",style:y({width:n.white/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-1",style:y({width:n.draw/n.count*100+"%"})},null,4),a("div",{class:"bar-segment bg-grey-darken-4",style:y({width:n.black/n.count*100+"%"})},null,4)])]),_:2},1024),N<l.value.topOpenings.length-1?(r(),u(h,{key:0})):_("",!0)],64))),128))]),_:1}))])):(r(),v("div",bt," Данных по дебютам пока нет. "))]),_:1})]),_:1})]),_:1})]))])}}},Ct=Q(xt,[["__scopeId","data-v-5664da7b"]]);export{Ct as default};
