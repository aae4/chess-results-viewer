import{a as v,b as z,f as B}from"./formatters-C8Ln7w-r.js";import{C as T,h as j}from"./chess-f0FuLRjZ.js";const x=i=>{const f=v(i);return["1-0","0-1","½-½","1/2-1/2"].includes(f)};function K({playerGames:i,ecoDatabase:f}){const r={colorStats:{white:{games:0,points:0,percent:0},black:{games:0,points:0,percent:0}},openingStats:[]};if(!i||i.length===0||!f)return r;const h={};return i.forEach(n=>{if(!x(n.result))return;const c=z(B(n.result,n.color));if(c!==null&&(n.color==="w"?(r.colorStats.white.games++,r.colorStats.white.points+=c):n.color==="b"&&(r.colorStats.black.games++,r.colorStats.black.points+=c),n.pgn_moves))try{const m=new T;m.loadPgn(n.pgn_moves);const g=m.history();let u=null;for(let l=Math.min(g.length,20);l>0;l--){const p=j(g.slice(0,l));if(f[p]){u=f[p];break}}if(u){const l=u.e;h[l]||(h[l]={eco:l,name:u.n,count:0,points:0}),h[l].count++,h[l].points+=c}}catch{}}),r.colorStats.white.games>0&&(r.colorStats.white.percent=Math.round(r.colorStats.white.points/r.colorStats.white.games*100)),r.colorStats.black.games>0&&(r.colorStats.black.percent=Math.round(r.colorStats.black.points/r.colorStats.black.games*100)),r.openingStats=Object.values(h).sort((n,c)=>c.count-n.count||c.points-n.points),r}function N({participants:i,gamesForStats:f,standings:r,tournamentDetails:h,ecoDatabase:n}){if(!i?.length||!f?.length||!r?.length||!n)return null;const c=i.length,m=h?.rounds_count||0,g=Math.round(i.reduce((t,e)=>t+(e.rating||0),0)/i.length);let u=0,l=0,p=0,M=null,b=null,O=1/0,G=0,R=0,P=0,C=0,W=0;const d={},w={},k=f.filter(t=>x(t.result));k.forEach(t=>{const e=v(t.result);if(e==="1-0"?u++:e==="0-1"?l++:(e==="½-½"||e==="1/2-1/2")&&(p++,w[t.white_player_id]=(w[t.white_player_id]||0)+1,w[t.black_player_id]=(w[t.black_player_id]||0)+1),t.pgn_moves)try{const _=new T;_.loadPgn(t.pgn_moves);const s=_.history(),a=Math.ceil(s.length/2);a>0&&(P++,R+=a,a<O&&(O=a,M={moves:a,game:t}),a>G&&(G=a,b={moves:a,game:t})),s.forEach(o=>{(o==="O-O"||o==="O-O-O")&&C++,o.includes("=")&&W++});let S=null;for(let o=Math.min(s.length,4);o>0;o--){const E=j(s.slice(0,o));if(n[E]){S=n[E];break}}if(S){const o=S.e;d[o]||(d[o]={eco:o,name:S.n,count:0,white:0,draw:0,black:0}),d[o].count++,e==="1-0"?d[o].white++:e==="0-1"?d[o].black++:(e==="½-½"||e==="1/2-1/2")&&d[o].draw++}}catch{}});const y=u+l+p,I={whiteWins:u,blackWins:l,draws:p,totalGames:y,whiteWinPercent:y>0?Math.round(u/y*100):0,blackWinPercent:y>0?Math.round(l/y*100):0,drawPercent:y>0?Math.round(p/y*100):0},L=r.filter(t=>t.performance_rating&&t.rating_at_tournament).map(t=>({player:t,diff:t.performance_rating-t.rating_at_tournament})).sort((t,e)=>e.diff-t.diff)[0],A=r.map(t=>{const e=k.filter(s=>s.white_player_id===t.player_id||s.black_player_id===t.player_id).length,_=w[t.player_id]||0;return{player:{player_id:t.player_id,name:t.name},drawRate:e>0?_/e*100:100,playedGames:e,score:t.score,final_rank:t.final_rank}}).filter(t=>t.playedGames>0).sort((t,e)=>t.drawRate!==e.drawRate?t.drawRate-e.drawRate:t.playedGames!==e.playedGames?e.playedGames-t.playedGames:t.score!==e.score?e.score-t.score:t.final_rank-e.final_rank)[0],F=r.filter(t=>k.some(s=>{const a=v(s.result);return s.white_player_id===t.player_id&&a==="0-1"||s.black_player_id===t.player_id&&a==="1-0"})?!1:k.some(s=>s.white_player_id===t.player_id||s.black_player_id===t.player_id)),q=Object.values(d).sort((t,e)=>e.count-t.count||t.name.localeCompare(e.name)).slice(0,10);return{totalPlayers:c,totalRounds:m,averageRating:g,resultDistribution:I,shortestGame:M,longestGame:b,averageMoveCount:P>0?Math.round(R/P):0,biggestOverperformer:L,undefeatedPlayers:F,mostDecisivePlayer:A,topOpenings:q,totalCastles:C,totalPromotions:W}}export{K as a,N as c};
