import{_ as Q,c as y,w as U,a as b,d as S,u as k,b as e,g as s,f as r,e as o,n as W,i as _,t as l,j as c,q as X,F as R,k as T,h as Y}from"./index-BZw3c7fe.js";import{u as Z}from"./tournamentStore-BsuTmOw7.js";import{h as tt}from"./pgn-B4xuOwQ5.js";import{a as et,b as N,g as st,d as ot}from"./formatters-D4D2rNmP.js";import{C as nt}from"./chess-DX7QKCjj.js";const lt={key:0,class:"text-center pa-10"},at={key:1,class:"player-dashboard"},rt={class:"text-h4 font-weight-light"},it={class:"text-h4 font-weight-bold"},ct={class:"text-subtitle-1 text-grey-darken-1"},dt={class:"text-center mx-4"},ut={class:"text-h3 font-weight-bold"},_t={class:"text-center mx-4"},vt={class:"text-h3 font-weight-bold"},pt={class:"text-h6"},mt={class:"text-h6"},gt={class:"d-flex align-center mb-3"},ft={style:{width:"100px"}},xt={class:"d-flex align-center"},ht={style:{width:"100px"}},yt={class:"text-caption text-grey"},bt={class:"text-center"},kt={class:"text-center font-weight-bold"},wt={class:"mr-4 text-center",style:{width:"40px"}},St={class:"text-body-1 font-weight-medium"},Ct={class:"text-caption text-grey ml-2"},Pt={__name:"PlayerView",props:{tournamentId:{type:[String,Number],required:!0},playerId:{type:[String,Number],required:!0}},setup(j){const P=j,v=Z(),V=W(),d=y(()=>v.activePlayer),I=y(()=>v.activePlayerGames);U(()=>P.playerId,n=>{n&&P.tournamentId&&v.fetchPlayerData(n,P.tournamentId)},{immediate:!0});const q=()=>V.back(),F=n=>{n.pgn_moves&&V.push({name:"Game",params:{gameId:n.id}})},E=n=>{const t=N(n.result,n.color);return t==="1"?"success":t==="0"?"error":"grey"},B=y(()=>d.value?.rating_change||0),L=y(()=>{const n=B.value;return n>0?`+${n}`:n||0}),O=y(()=>{const n=B.value;return n>0?"text-success":n<0?"text-error":""}),m=y(()=>{const n={colorStats:{white:{games:0,points:0,percent:0},black:{games:0,points:0,percent:0}},openingStats:[]};if(!I.value||I.value.length===0)return n;const t={};return I.value.forEach(u=>{const p=et(N(u.result,u.color));if(p!==null&&(u.color==="w"?(n.colorStats.white.games++,n.colorStats.white.points+=p):u.color==="b"&&(n.colorStats.black.games++,n.colorStats.black.points+=p),u.pgn_moves&&v.ecoDatabase))try{const w=new nt;w.loadPgn(u.pgn_moves);const C=w.history();let x=null;for(let i=Math.min(C.length,20);i>0;i--){const g=tt(C.slice(0,i));if(v.ecoDatabase[g]){x=v.ecoDatabase[g];break}}if(x){const i=x.e;t[i]||(t[i]={eco:i,name:x.n,count:0,points:0}),t[i].count++,t[i].points+=p}}catch{}}),n.colorStats.white.games>0&&(n.colorStats.white.percent=n.colorStats.white.points/n.colorStats.white.games*100),n.colorStats.black.games>0&&(n.colorStats.black.percent=n.colorStats.black.points/n.colorStats.black.games*100),n.openingStats=Object.values(t).sort((u,p)=>p.count-u.count||p.points-u.points),n});return(n,t)=>{const u=r("v-progress-circular"),p=r("v-btn"),w=r("v-avatar"),C=r("v-spacer"),x=r("v-divider"),i=r("v-card-text"),g=r("v-card"),h=r("v-icon"),f=r("v-col"),D=r("v-row"),G=r("v-card-title"),z=r("v-progress-linear"),$=r("v-table"),A=r("v-list-item-title"),M=r("v-chip"),H=r("v-list-item"),J=r("v-list"),K=r("v-alert");return _(),b("div",null,[k(v).isLoadingDetails&&!d.value?(_(),b("div",lt,[e(u,{indeterminate:"",color:"primary",size:"64"}),t[0]||(t[0]=s("div",{class:"mt-4 text-grey"},"Загрузка профиля игрока...",-1))])):d.value?(_(),b("div",at,[e(g,{class:"mb-6"},{default:o(()=>[e(i,{class:"d-flex align-center"},{default:o(()=>[e(p,{icon:"mdi-arrow-left",variant:"text",onClick:q,class:"mr-4"}),e(w,{color:"primary",size:"64",class:"mr-6"},{default:o(()=>[s("span",rt,l(k(st)(d.value.canonical_name)),1)]),_:1}),s("div",null,[s("h1",it,l(d.value.canonical_name),1),s("div",ct,l(d.value.club_city||d.value.federation),1)]),e(C),s("div",dt,[t[1]||(t[1]=s("div",{class:"text-caption text-grey"},"МЕСТО",-1)),s("div",ut,l(d.value.final_rank||"-"),1)]),e(x,{vertical:"",class:"mx-2"}),s("div",_t,[t[2]||(t[2]=s("div",{class:"text-caption text-grey"},"ОЧКИ",-1)),s("div",vt,l(d.value.score||"-"),1)])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(f,{cols:"12",md:"5"},{default:o(()=>[e(D,null,{default:o(()=>[e(f,{cols:"12"},{default:o(()=>[e(g,null,{default:o(()=>[e(i,null,{default:o(()=>[e(D,null,{default:o(()=>[e(f,{class:"text-center"},{default:o(()=>[e(h,{color:"grey-darken-1",class:"mb-1"},{default:o(()=>[...t[3]||(t[3]=[c("mdi-chess-king",-1)])]),_:1}),t[4]||(t[4]=s("div",{class:"text-caption text-grey"},"Рейтинг",-1)),s("div",pt,l(d.value.rating_at_tournament),1)]),_:1}),e(f,{class:"text-center"},{default:o(()=>[e(h,{color:"grey-darken-1",class:"mb-1"},{default:o(()=>[...t[5]||(t[5]=[c("mdi-finance",-1)])]),_:1}),t[6]||(t[6]=s("div",{class:"text-caption text-grey"},"Перфоманс",-1)),s("div",mt,l(d.value.performance_rating||"-"),1)]),_:1}),e(f,{class:"text-center"},{default:o(()=>[e(h,{color:"grey-darken-1",class:"mb-1"},{default:o(()=>[...t[7]||(t[7]=[c("mdi-arrow-up-down-bold",-1)])]),_:1}),t[8]||(t[8]=s("div",{class:"text-caption text-grey"},"+/- Рейтинга",-1)),s("div",{class:X(["text-h6",O.value])},l(L.value),3)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12"},{default:o(()=>[e(g,null,{default:o(()=>[e(G,{class:"text-subtitle-1"},{default:o(()=>[...t[9]||(t[9]=[c("Результативность по цвету",-1)])]),_:1}),e(i,null,{default:o(()=>[s("div",gt,[s("div",ft,[e(h,{icon:"mdi-circle-outline",class:"mr-2"}),t[10]||(t[10]=c("Белые",-1))]),e(z,{"model-value":m.value.colorStats.white.percent,color:"grey-lighten-2",height:"22",rounded:""},{default:o(()=>[s("strong",null,l(m.value.colorStats.white.points)+" / "+l(m.value.colorStats.white.games),1)]),_:1},8,["model-value"])]),s("div",xt,[s("div",ht,[e(h,{icon:"mdi-circle",class:"mr-2"}),t[11]||(t[11]=c("Черные",-1))]),e(z,{"model-value":m.value.colorStats.black.percent,color:"grey-darken-2",height:"22",rounded:""},{default:o(()=>[s("strong",null,l(m.value.colorStats.black.points)+" / "+l(m.value.colorStats.black.games),1)]),_:1},8,["model-value"])])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12"},{default:o(()=>[e(g,null,{default:o(()=>[e(G,{class:"text-subtitle-1"},{default:o(()=>[...t[12]||(t[12]=[c("Дебютный репертуар",-1)])]),_:1}),m.value.openingStats.length>0?(_(),S(i,{key:0},{default:o(()=>[e($,{density:"compact"},{default:o(()=>[t[13]||(t[13]=s("thead",null,[s("tr",null,[s("th",null,"Дебют"),s("th",{class:"text-center"},"Партий"),s("th",{class:"text-center"},"Результат")])],-1)),s("tbody",null,[(_(!0),b(R,null,T(m.value.openingStats,a=>(_(),b("tr",{key:a.name},[s("td",null,[s("div",null,l(a.name),1),s("div",yt,l(a.eco),1)]),s("td",bt,l(a.count),1),s("td",kt,l(a.points)+" / "+l(a.count),1)]))),128))])]),_:1})]),_:1})):(_(),S(i,{key:1,class:"text-center text-grey"},{default:o(()=>[...t[14]||(t[14]=[c(" Нет данных по дебютам. ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"7"},{default:o(()=>[e(g,{class:"fill-height"},{default:o(()=>[e(G,{class:"text-subtitle-1"},{default:o(()=>[c("Сыгранные партии ("+l(k(v).activePlayerGames.length)+")",1)]),_:1}),e(x),e(J,{class:"game-list"},{default:o(()=>[(_(!0),b(R,null,T(k(v).activePlayerGames,a=>(_(),S(H,{key:a.game_id,onClick:It=>F(a),disabled:!a.pgn_moves,class:"game-list-item"},{prepend:o(()=>[s("div",wt,[t[15]||(t[15]=s("div",{class:"text-caption text-grey"},"Тур",-1)),s("div",St,l(a.round),1)])]),append:o(()=>[e(M,{color:E(a),label:"",class:"font-weight-bold",style:{width:"50px","justify-content":"center"}},{default:o(()=>[c(l(k(N)(a.result,a.color)),1)]),_:2},1032,["color"]),a.pgn_moves?(_(),S(h,{key:0,class:"ml-4 text-grey"},{default:o(()=>[...t[16]||(t[16]=[c("mdi-chevron-right",-1)])]),_:1})):Y("",!0)]),default:o(()=>[e(A,{class:"font-weight-bold d-flex align-center"},{default:o(()=>[e(h,{size:"small",icon:k(ot)(a.color),class:"mr-2"},null,8,["icon"]),s("span",null,"vs "+l(a.opponent_name),1),s("span",Ct,"("+l(a.opponent_rating||"-")+")",1)]),_:2},1024)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):(_(),S(K,{key:2,type:"warning",class:"mt-4"},{default:o(()=>[...t[17]||(t[17]=[c("Игрок не найден.",-1)])]),_:1}))])}}},zt=Q(Pt,[["__scopeId","data-v-ddd538c8"]]);export{zt as default};
