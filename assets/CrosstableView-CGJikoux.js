import{u as F,A as L,c as A,a as c,d as B,l as f,b as C,r as y,w as h,C as M,H as S,f as a,e as s,D as N,F as P,i as x,t as p,K as w}from"./index-D-y_KBvG.js";import{b as z,f as G,c as H,d as K}from"./formatters-B-FefROx.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";function q(g,_){if(!g||g.length===0)return[];const l=new Map;return g.forEach(n=>{l.has(n.player_id)||l.set(n.player_id,{player_id:n.player_id,player_name:n.player_name,starting_rank:n.starting_rank,results:new Array(_).fill(null),games:[],totalPoints:0}),l.get(n.player_id).games.push(n)}),l.forEach(n=>{let u=0;n.games.forEach(e=>{if(!e.round||!e.opponent_player_id)return;const k=parseInt(e.round)-1,d=z(G(e.result,e.color));d!==null&&(u+=d);const v=l.get(e.opponent_player_id);n.results[k]={points:d,color:e.color,opponent_name:e.opponent_name,opponent_starting_rank:v?.starting_rank||"?",game_id:e.game_id,is_technical:e.is_technical}}),n.totalPoints=u}),Array.from(l.values()).sort((n,u)=>u.totalPoints!==n.totalPoints?u.totalPoints-n.totalPoints:n.starting_rank-u.starting_rank)}const J={key:0,class:"text-center pa-10"},O={class:"crosstable-wrapper"},Q={class:"sticky-col rank-col text-center"},U={class:"sticky-col player-col"},W=["onClick","title"],X=["onClick"],Y={class:"mr-1"},Z={key:1},tt={class:"sticky-col-right points-col text-center font-weight-bold"},nt={__name:"CrosstableView",setup(g){const _=F(),l=M(),I=S(),{mobile:n}=L(),u=t=>{if(!t)return"";const o=t.replace(",","").split(" ").filter(Boolean);if(o.length>=2){const m=o[0],b=o[1];return`${m} ${b.charAt(0)}.`}return t},e=A(()=>{if(_.activeTournament?.rounds_count>0)return Array.from({length:_.activeTournament.rounds_count},(t,o)=>o+1);if(_.games?.length>0){const t=Math.max(..._.games.map(o=>parseInt(o.round)||0));return t>0?Array.from({length:t},(o,m)=>m+1):[1]}return[1]}),k=A(()=>q(_.crosstableData,e.value.length)),d=t=>{t&&l.push({name:"Player",params:{tournamentId:I.params.tournamentId,playerId:t}})},v=t=>{t&&t.game_id&&t.is_technical===0&&l.push({name:"Game",params:{gameId:t.game_id}})},T=t=>t?t.points===1?"result-win":t.points===.5?"result-draw":t.points===0?"result-loss":"":"";return(t,o)=>{const m=y("v-progress-circular"),b=y("v-icon"),E=y("v-tooltip"),V=y("v-table"),$=y("v-card");return a(),c("div",null,[f(_).isLoadingDetails?(a(),c("div",J,[C(m,{indeterminate:"",color:"primary"})])):(a(),B($,{key:1},{default:h(()=>[s("div",O,[C(V,{class:N(["crosstable",{"is-mobile":f(n)}]),density:"compact"},{default:h(()=>[s("thead",null,[s("tr",null,[o[0]||(o[0]=s("th",{class:"sticky-col rank-col"},"#",-1)),o[1]||(o[1]=s("th",{class:"sticky-col player-col"},"Игрок",-1)),(a(!0),c(P,null,x(e.value,r=>(a(),c("th",{key:r,class:"text-center round-col"},p(r),1))),128)),o[2]||(o[2]=s("th",{class:"sticky-col-right points-col"},"Очки",-1))])]),s("tbody",null,[(a(!0),c(P,null,x(k.value,r=>(a(),c("tr",{key:r.player_id},[s("td",Q,p(r.starting_rank),1),s("td",U,[s("div",{onClick:i=>d(r.player_id),class:"player-link",title:r.player_name},p(f(n)?u(r.player_name):r.player_name),9,W)]),(a(!0),c(P,null,x(r.results,(i,D)=>(a(),c("td",{key:D,class:N(["text-center round-col result-cell",T(i)]),onClick:R=>v(i)},[i?(a(),B(E,{key:0,location:"top",disabled:!i.opponent_name},{activator:h(({props:R})=>[s("div",w({ref_for:!0},R,{class:"cell-content"}),[s("span",Y,p(i.opponent_starting_rank),1),C(b,{icon:f(K)(i.color),size:"x-small"},null,8,["icon"])],16)]),default:h(()=>[s("span",null,p(f(H)(i.points))+" vs "+p(i.opponent_name),1)]),_:2},1032,["disabled"])):(a(),c("span",Z,"-"))],10,X))),128)),s("td",tt,p(r.totalPoints),1)]))),128))])]),_:1},8,["class"])])]),_:1}))])}}},rt=j(nt,[["__scopeId","data-v-ab652457"]]);export{rt as default};
