import{E as z,j as r,c as o,u as N,G as s}from"./index-OFearDcG.js";import{f as S}from"./formatters-C8Ln7w-r.js";const q=z("player",()=>{const g=r(null),l=r([]),d=r(null),p=r(!1),y=r(null),m=r([]),_=r(!1),h=r(null),c=r(null),w=r(null),i=r(null),u=r([]),v=r(!1),C=o(()=>{const e={gold:0,silver:0,bronze:0,tournaments:l.value.length};return l.value&&l.value.forEach(t=>{t.final_rank===1?e.gold++:t.final_rank===2?e.silver++:t.final_rank===3&&e.bronze++}),e}),H=o(()=>!l.value||l.value.length===0?{labels:[],datasets:[]}:{datasets:[{label:"Рейтинг FIDE",backgroundColor:"rgba(0, 82, 204, 0.2)",borderColor:"#0052CC",pointBackgroundColor:"#0052CC",pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBackgroundColor:"white",data:l.value.filter(t=>t.start_date&&t.rating_at_tournament).map(t=>({x:t.start_date,y:t.rating_at_tournament,tournamentName:t.tournament_name,ratingChange:t.rating_change})),fill:!0,tension:.1}]}),E=o(()=>{const t=N().currentTournament;return!t||!l.value||l.value.length===0?null:l.value.find(a=>a.tournament_id===t.id)||null}),R=o(()=>{const e={peakRating:0,latestRating:0};if(!l.value)return e;let t="";return l.value.forEach(a=>{a.rating_at_tournament>e.peakRating&&(e.peakRating=a.rating_at_tournament),a.start_date>t&&(t=a.start_date,e.latestRating=a.rating_at_tournament)}),e}),L=o(()=>{const e={wins:0,draws:0,losses:0,total:0,score:0,percent:0},t={vs_stronger:{...e},vs_equal:{...e},vs_weaker:{...e}};return c.value&&c.value.forEach(a=>{const{opponent_category:n,wins:f,draws:P,losses:k}=a;t[n]={wins:f,draws:P,losses:k,total:f+P+k,score:f+P*.5},t[n].percent=Math.round(t[n].score/t[n].total*100)}),t}),G=o(()=>i.value?i.value:[]),A=o(()=>{const e={white:{w:0,d:0,l:0,total:0,score:0,winPercent:0},black:{w:0,d:0,l:0,total:0,score:0,winPercent:0},total:{w:0,d:0,l:0,total:0,score:0,winPercent:0}};return!u.value||u.value.length===0||(u.value.forEach(t=>{const a=S(t.result,t.player_color),n=t.player_color==="w"?"white":"black";a==="1"?(e[n].w++,e.total.w++):a==="½"?(e[n].d++,e.total.d++):a==="0"&&(e[n].l++,e.total.l++)}),["white","black","total"].forEach(t=>{const a=e[t];a.total=a.w+a.d+a.l,a.score=a.w+a.d*.5,a.total>0&&(a.winPercent=Math.round(a.w/a.total*100))})),e}),D=o(()=>{const e={opening:{score:0,total:0},middlegame:{score:0,total:0},endgame:{score:0,total:0}};return u.value.forEach(t=>{const a=S(t.result,t.player_color),n=a==="1"?1:a==="½"?.5:0,f=t.round/t.rounds_count;f<=.34?(e.opening.score+=n,e.opening.total++):f<=.67?(e.middlegame.score+=n,e.middlegame.total++):(e.endgame.score+=n,e.endgame.total++)}),Object.values(e).forEach(t=>{t.percent=t.total>0?Math.round(t.score/t.total*100):0}),e}),x=o(()=>{let e={opponent_rating:0,opponent_name:null,game_id:null},t={opponent_rating:1/0,opponent_name:null,game_id:null};return u.value.forEach(a=>{const n=S(a.result,a.player_color);n==="1"&&a.opponent_rating>e.opponent_rating&&(e=a),n==="0"&&a.opponent_rating<t.opponent_rating&&(t=a)}),{bestWin:e.game_id?e:null,worstLoss:t.game_id?t:null}});async function O(e){p.value=!0,y.value=null;try{const[t,a]=await Promise.all([s.getPlayerGlobalProfile(e),s.getPlayerCareer(e)]);g.value=t,l.value=a,await b(e)}catch(t){y.value=t.message,console.error("Ошибка при загрузке глобального профиля игрока:",t)}finally{p.value=!1}}async function b(e){try{const t=await s.getPlayerNextGame(e);d.value=t||null}catch(t){console.error("Ошибка при загрузке следующей игры:",t),d.value=null}}async function B(e){if(!c.value){v.value=!0;try{const[t,a,n]=await Promise.all([s.getPlayerOpponentStats(e),s.getPlayerOpeningStats(e),s.getPlayerGamesForAnalytics(e)]);c.value=t,w.value=a,u.value=n}catch(t){console.error("Ошибка при загрузке аналитики:",t)}finally{v.value=!1}}}async function M(e){if(!i.value){v.value=!0;try{i.value=await s.getPlayerHeadToHead(e)}catch(t){console.error("Ошибка при загрузке H2H:",t)}finally{v.value=!1}}}function T(){g.value=null,l.value=[],d.value=null,c.value=null,w.value=null,i.value=null,u.value=[]}async function W(){if(!(m.value.length>0)){_.value=!0,h.value=null;try{m.value=await s.getAllPlayersWithStatsOptimized()}catch(e){h.value=e.message,console.error("Ошибка при загрузке списка всех игроков:",e)}finally{_.value=!1}}}return{playerProfile:g,playerCareer:l,nextGame:d,isLoading:p,error:y,careerStats:C,ratingHistory:H,keyMetrics:R,fetchPlayerData:O,fetchNextGame:b,clearPlayerData:T,playerList:m,isLoadingList:_,errorList:h,fetchAllPlayers:W,opponentStats:c,openingStats:w,h2hStats:i,isLoadingAnalytics:v,processedOpponentStats:L,processedH2HStats:G,fetchPlayerAnalytics:B,fetchPlayerH2H:M,careerPerformanceStats:A,performanceByRounds:D,notableResults:x,participationInCurrentTournament:E}});export{q as u};
