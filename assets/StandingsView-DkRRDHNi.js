import{u as re,m as ie,j as z,c as C,a as r,e as s,h as _,d as b,b as o,r as v,w as l,n as de,p as ue,l as U,G as ce,J as ve,f as n,g as u,t as i,q as $,F as M,i as j}from"./index-B9nZb7CB.js";import{g as _e}from"./formatters-C8Ln7w-r.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"d-flex align-center ga-2 mb-4 sticky-search"},me={key:0,class:"d-flex flex-wrap ga-2 mb-4"},ge={key:1,class:"text-center pa-10"},ye={key:2,class:"text-center text-medium-emphasis pa-10"},ke={class:"text-center rank-col font-weight-bold"},be={key:0,class:"text-center"},xe={key:1,class:"text-center"},he=["onClick"],Ce={class:"text-center rank-col"},we={key:1,class:"text-body-1 font-weight-medium text-medium-emphasis"},Ve={key:1,class:"text-body-1 text-medium-emphasis"},ze={class:"d-flex align-center py-2"},Fe={class:"text-white text-caption font-weight-bold"},Be={class:"font-weight-bold text-body-1"},Ae={class:"text-caption text-medium-emphasis d-flex align-center ga-2"},Ue={key:0,class:"d-flex align-center"},$e={key:1,class:"d-flex align-center"},Se={key:0,class:"text-center"},Ie={class:"text-body-2"},De={key:1,class:"text-center text-body-2 text-medium-emphasis"},Ne={class:"text-center points-col"},Re={key:4,class:"mobile-standings"},Le={class:"d-flex align-center pa-3"},Pe={class:"d-flex align-center justify-center mr-3",style:{width:"32px"}},Ee={key:0},Me={key:1,class:"text-h6 font-weight-bold text-medium-emphasis"},je={class:"flex-grow-1 overflow-hidden"},Te={class:"text-subtitle-1 font-weight-bold text-truncate"},qe={class:"text-caption text-medium-emphasis d-flex align-center ga-2"},Ge={key:1,class:"text-uppercase"},Je={class:"ml-2"},Qe={__name:"StandingsView",setup(We){const y=re(),T=ce(),q=ve(),F=ie(),h=z(""),c=z("rank"),w=z(!1),p=z(null),f=z(null),G=C(()=>F.mdAndUp.value?"v-dialog":"v-bottom-sheet"),J=C(()=>F.mdAndUp.value?{maxWidth:"500"}:{inset:!0}),Q=C(()=>{const a=y.participants||[],e=new Set(a.map(d=>d.federation).filter(Boolean));return Array.from(e).sort()}),W=C(()=>{const a=y.standings||[],e=new Set(a.map(d=>d.club_city).filter(Boolean));return e.size===0&&y.participants&&y.participants.forEach(d=>{d.club_city&&e.add(d.club_city)}),Array.from(e).sort()}),k=a=>y.participants?.find(e=>e.id===a),B=C(()=>{if(!y.standings)return[];let a=[...y.standings];if(h.value||p.value||f.value){const e=h.value?h.value.toLowerCase():"";a=a.filter(d=>{const m=!e||d.name.toLowerCase().includes(e),V=d.federation||k(d.player_id)?.federation,x=!p.value||V===p.value,g=d.club_city||k(d.player_id)?.club_city,S=!f.value||g===f.value;return m&&x&&S})}return c.value==="name"?a.sort((e,d)=>e.name.localeCompare(d.name)):c.value==="rating"&&a.sort((e,d)=>(d.rating_at_tournament||0)-(e.rating_at_tournament||0)),a}),A=C(()=>{let a=0;return c.value!=="rank"&&a++,p.value&&a++,f.value&&a++,a}),D=a=>{T.push({name:"Player",params:{tournamentId:q.params.tournamentId,playerId:a}})},N=()=>{h.value="",p.value=null,f.value=null,c.value="rank"},H=a=>({rank:"Место",name:"Имя",rating:"Рейтинг"})[a]||a,K=a=>{const e=["#0052CC","#DE350B","#36B37E","#FFAB00","#6554C0","#00B8D9"],d=a.split("").reduce((m,V)=>m+V.charCodeAt(0),0)%e.length;return e[d]},O=a=>{const e=parseInt(a);return e===1?"rank-gold":e===2?"rank-silver":e===3?"rank-bronze":""},R=a=>{const e=parseInt(a);return e===1?"amber":e===2?"blue-grey-lighten-2":e===3?"brown-lighten-2":"grey"},L=a=>{if(a==null)return"";const e=parseFloat(a);return e>0?`+${e.toFixed(1)}`:e.toFixed(1)},P=a=>a==null?"text-medium-emphasis":parseFloat(a)>0?"text-success":"text-error";return(a,e)=>{const d=v("v-text-field"),m=v("v-icon"),V=v("v-badge"),x=v("v-btn"),g=v("v-chip"),S=v("v-card-title"),X=v("v-divider"),Y=v("v-chip-group"),E=v("v-select"),Z=v("v-card-text"),ee=v("v-card-actions"),I=v("v-card"),te=v("v-progress-circular"),ae=v("v-avatar"),le=v("v-table"),ne=v("v-col"),oe=v("v-row");return n(),r("div",null,[s("div",fe,[o(d,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),label:"Найти участника...",placeholder:"Имя участника","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"comfortable","hide-details":"","single-line":"",class:"flex-grow-1",clearable:""},null,8,["modelValue"]),o(x,{size:"large",height:"48",width:"48",variant:"tonal",color:"primary",onClick:e[1]||(e[1]=t=>w.value=!0),"aria-label":"Открыть фильтры"},{default:l(()=>[o(V,{"model-value":A.value>0,content:A.value,color:"error",floating:""},{default:l(()=>[o(m,null,{default:l(()=>[...e[11]||(e[11]=[u("mdi-tune-variant",-1)])]),_:1})]),_:1},8,["model-value","content"])]),_:1})]),A.value>0?(n(),r("div",me,[c.value!=="rank"?(n(),b(g,{key:0,closable:"",color:"secondary",label:"",size:"small","onClick:close":e[2]||(e[2]=t=>c.value="rank")},{default:l(()=>[u(" Сорт: "+i(H(c.value)),1)]),_:1})):_("",!0),p.value?(n(),b(g,{key:1,closable:"",color:"primary",label:"",size:"small","onClick:close":e[3]||(e[3]=t=>p.value=null)},{default:l(()=>[u(" Фед: "+i(p.value),1)]),_:1})):_("",!0),f.value?(n(),b(g,{key:2,closable:"",color:"primary",label:"",size:"small","onClick:close":e[4]||(e[4]=t=>f.value=null)},{default:l(()=>[u(" Город: "+i(f.value),1)]),_:1})):_("",!0),A.value>1?(n(),b(x,{key:3,variant:"text",size:"small",color:"medium-emphasis",class:"px-1",onClick:N},{default:l(()=>[...e[12]||(e[12]=[u(" Сбросить все ",-1)])]),_:1})):_("",!0)])):_("",!0),(n(),b(ue(G.value),de(J.value,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=t=>w.value=t)}),{default:l(()=>[o(I,{class:$(U(F).mdAndUp.value?"rounded-lg":"rounded-t-xl")},{default:l(()=>[o(S,{class:"d-flex justify-space-between align-center pa-4"},{default:l(()=>[e[13]||(e[13]=s("span",{class:"text-h6"},"Настройки таблицы",-1)),o(x,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=t=>w.value=!1)})]),_:1}),o(X),o(Z,{class:"pa-4"},{default:l(()=>[e[17]||(e[17]=s("div",{class:"text-subtitle-2 mb-2"},"Сортировать по",-1)),o(Y,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value=t),"selected-class":"text-primary",mandatory:"",class:"mb-4"},{default:l(()=>[o(g,{value:"rank",filter:"",variant:"outlined"},{default:l(()=>[...e[14]||(e[14]=[u("Месту",-1)])]),_:1}),o(g,{value:"name",filter:"",variant:"outlined"},{default:l(()=>[...e[15]||(e[15]=[u("Имени",-1)])]),_:1}),o(g,{value:"rating",filter:"",variant:"outlined"},{default:l(()=>[...e[16]||(e[16]=[u("Рейтингу",-1)])]),_:1})]),_:1},8,["modelValue"]),o(E,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value=t),items:Q.value,label:"Федерация",variant:"outlined",density:"comfortable",clearable:"","hide-details":"auto",class:"mb-4"},null,8,["modelValue","items"]),o(E,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value=t),items:W.value,label:"Город / Клуб",variant:"outlined",density:"comfortable",clearable:"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),o(ee,{class:"pa-4 pt-0"},{default:l(()=>[o(x,{block:"",color:"primary",variant:"flat",size:"large",onClick:e[9]||(e[9]=t=>w.value=!1)},{default:l(()=>[u(" Применить ("+i(B.value.length)+") ",1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},16,["modelValue"])),U(y).isLoadingDetails?(n(),r("div",ge,[o(te,{indeterminate:"",color:"primary",size:"64"})])):B.value.length===0?(n(),r("div",ye,[o(m,{size:"64",color:"grey-lighten-1"},{default:l(()=>[...e[18]||(e[18]=[u("mdi-account-search-outline",-1)])]),_:1}),e[20]||(e[20]=s("div",{class:"mt-4 text-h6"},"Участники не найдены",-1)),o(x,{class:"mt-4",variant:"outlined",color:"primary",onClick:N},{default:l(()=>[...e[19]||(e[19]=[u("Сбросить фильтры",-1)])]),_:1})])):U(F).mdAndUp.value?(n(),b(I,{key:3,elevation:"1",class:"rounded-lg border"},{default:l(()=>[o(le,{class:"leaderboard-table",hover:""},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",ke,i(c.value==="rank"?"Место":"№"),1),e[21]||(e[21]=s("th",{class:"text-left font-weight-bold"},"Участник",-1)),c.value==="rank"?(n(),r("th",be,"Рейтинг")):_("",!0),c.value==="rank"?(n(),r("th",xe,"Перф.")):_("",!0),e[22]||(e[22]=s("th",{class:"text-center points-col font-weight-bold"},"Очки",-1))])]),s("tbody",null,[(n(!0),r(M,null,j(B.value,t=>(n(),r("tr",{key:t.player_id,class:"table-row",onClick:se=>D(t.player_id)},[s("td",Ce,[c.value==="rank"?(n(),r("div",{key:0,class:$(["rank-indicator",O(t.final_rank)])},[t.final_rank<=3?(n(),b(m,{key:0,color:R(t.final_rank),size:"24"},{default:l(()=>[...e[23]||(e[23]=[u("mdi-trophy",-1)])]),_:1},8,["color"])):(n(),r("span",we,i(t.final_rank),1))],2)):(n(),r("div",Ve,i(t.starting_rank),1))]),s("td",null,[s("div",ze,[o(ae,{color:K(t.name),size:"36",class:"mr-3 elevation-1"},{default:l(()=>[s("span",Fe,i(U(_e)(t.name)),1)]),_:2},1032,["color"]),s("div",null,[s("div",Be,i(t.name),1),s("div",Ae,[t.federation||k(t.player_id)?.federation?(n(),r("span",Ue,[o(m,{size:"x-small",start:""},{default:l(()=>[...e[24]||(e[24]=[u("mdi-flag-outline",-1)])]),_:1}),u(" "+i(t.federation||k(t.player_id)?.federation),1)])):_("",!0),t.club_city||k(t.player_id)?.club_city?(n(),r("span",$e,[o(m,{size:"x-small",start:""},{default:l(()=>[...e[25]||(e[25]=[u("mdi-map-marker-outline",-1)])]),_:1}),u(" "+i(t.club_city||k(t.player_id)?.club_city),1)])):_("",!0)])])])]),c.value==="rank"?(n(),r("td",Se,[s("div",Ie,i(t.rating_at_tournament),1),t.rating_change?(n(),r("div",{key:0,class:$([P(t.rating_change),"text-caption font-weight-bold"])},i(L(t.rating_change)),3)):_("",!0)])):_("",!0),c.value==="rank"?(n(),r("td",De,i(t.performance_rating||"–"),1)):_("",!0),s("td",Ne,[o(g,{color:"primary",variant:"flat",size:"small",class:"font-weight-bold"},{default:l(()=>[u(i(t.score),1)]),_:2},1024)])],8,he))),128))])]),_:1})]),_:1})):(n(),r("div",Re,[o(oe,{dense:""},{default:l(()=>[(n(!0),r(M,null,j(B.value,t=>(n(),b(ne,{key:t.player_id,cols:"12"},{default:l(()=>[o(I,{class:"mb-1 border-thin rounded-lg",flat:"",onClick:se=>D(t.player_id),ripple:""},{default:l(()=>[s("div",Le,[s("div",Pe,[c.value==="rank"&&t.final_rank<=3?(n(),r("div",Ee,[o(m,{color:R(t.final_rank),size:"28"},{default:l(()=>[...e[26]||(e[26]=[u("mdi-trophy",-1)])]),_:1},8,["color"])])):(n(),r("div",Me,i(c.value==="rank"?t.final_rank:t.starting_rank),1))]),s("div",je,[s("div",Te,i(t.name),1),s("div",qe,[s("span",null,i(t.rating_at_tournament),1),t.rating_change?(n(),r("span",{key:0,class:$(P(t.rating_change))},i(L(t.rating_change)),3)):_("",!0),t.federation||k(t.player_id)?.federation?(n(),r("span",Ge," · "+i(t.federation||k(t.player_id)?.federation),1)):_("",!0)])]),s("div",Je,[o(g,{color:"primary",variant:"tonal",size:"default",class:"font-weight-bold"},{default:l(()=>[u(i(t.score),1)]),_:2},1024)])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))])}}},Xe=pe(Qe,[["__scopeId","data-v-9c17b2b8"]]);export{Xe as default};
