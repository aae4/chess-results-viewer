import{u as O,m as Q,c as V,a as u,d as C,l as g,b as o,r as i,w as l,G as U,J as W,f as d,e as n,g as x,n as w,q as E,F as N,i as T,t as _}from"./index-B9nZb7CB.js";import{b as X,f as Y,c as $,d as Z}from"./formatters-C8Ln7w-r.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";function nt(h,m){if(!h||h.length===0)return[];const p=new Map;return h.forEach(e=>{p.has(e.player_id)||p.set(e.player_id,{player_id:e.player_id,player_name:e.player_name,starting_rank:e.starting_rank,results:new Array(m).fill(null),games:[],totalPoints:0}),p.get(e.player_id).games.push(e)}),p.forEach(e=>{let v=0;e.games.forEach(r=>{if(!r.round)return;const B=parseInt(r.round)-1,y=X(Y(r.result,r.color));y!==null&&(v+=y);const I=p.get(r.opponent_player_id);e.results[B]={points:y,color:r.color,opponent_name:r.opponent_name,opponent_starting_rank:I?.starting_rank||"?",game_id:r.game_id,is_technical:r.is_technical,is_bye:r.is_bye}}),e.totalPoints=v}),Array.from(p.values()).sort((e,v)=>v.totalPoints!==e.totalPoints?v.totalPoints-e.totalPoints:e.starting_rank-v.starting_rank)}const st={key:0,class:"text-center pa-10"},ot={class:"d-flex align-center"},et={class:"cell-example result-win"},lt={class:"cell-content"},at={class:"d-flex align-center"},it={class:"cell-example result-draw"},rt={class:"cell-content"},ct={class:"d-flex align-center"},dt={class:"cell-example result-loss"},_t={class:"cell-content is-technical"},pt={class:"crosstable-wrapper"},ut={class:"sticky-col rank-col text-center"},mt={class:"sticky-col player-col"},vt=["onClick","title"],ft=["onClick"],gt={class:"mr-1"},yt={class:"mr-1"},bt={key:3},kt={class:"sticky-col-right points-col text-center font-weight-bold"},xt={__name:"CrosstableView",setup(h){const m=O(),p=U(),A=W(),{mobile:e}=Q(),v=s=>{if(!s)return"";const t=s.replace(",","").split(" ").filter(Boolean);if(t.length>=2){const b=t[0],R=t[1];return`${b} ${R.charAt(0)}.`}return s},r=V(()=>{if(m.activeTournament?.rounds_count>0)return Array.from({length:m.activeTournament.rounds_count},(s,t)=>t+1);if(m.games?.length>0){const s=Math.max(...m.games.map(t=>parseInt(t.round)||0));return s>0?Array.from({length:s},(t,b)=>b+1):[1]}return[1]}),B=V(()=>nt(m.crosstableData,r.value.length)),y=s=>{s&&p.push({name:"Player",params:{tournamentId:A.params.tournamentId,playerId:s}})},I=s=>{s&&s.game_id&&s.is_technical===0&&p.push({name:"Game",params:{gameId:s.game_id}})},F=s=>s?s.points===1?"result-win":s.points===.5?"result-draw":s.points===0?"result-loss":"":"";return(s,t)=>{const b=i("v-progress-circular"),R=i("v-toolbar-title"),G=i("v-spacer"),L=i("v-btn"),M=i("v-list-subheader"),k=i("v-icon"),P=i("v-list-item"),S=i("v-list"),D=i("v-menu"),q=i("v-toolbar"),J=i("v-divider"),z=i("v-tooltip"),j=i("v-table"),H=i("v-card");return d(),u("div",null,[g(m).isLoadingDetails?(d(),u("div",st,[o(b,{indeterminate:"",color:"primary"})])):(d(),C(H,{key:1},{default:l(()=>[o(q,{flat:"",density:"compact"},{default:l(()=>[o(R,{class:"text-subtitle-1 font-weight-bold"},{default:l(()=>[...t[0]||(t[0]=[x("Кросс-таблица",-1)])]),_:1}),o(G),o(D,{location:"bottom end"},{activator:l(({props:c})=>[o(L,w(c,{icon:"mdi-help-circle-outline",variant:"text"}),null,16)]),default:l(()=>[o(S,{density:"compact",class:"legend-list"},{default:l(()=>[o(M,null,{default:l(()=>[...t[1]||(t[1]=[x("УСЛОВНЫЕ ОБОЗНАЧЕНИЯ",-1)])]),_:1}),o(P,null,{default:l(()=>[n("div",ot,[n("div",et,[n("div",lt,[t[2]||(t[2]=x("18",-1)),o(k,{icon:"mdi-circle-outline",size:"x-small",class:"ml-1"})])]),t[3]||(t[3]=n("div",{class:"ml-3 text-caption"},"Победа над №18 белыми",-1))])]),_:1}),o(P,null,{default:l(()=>[n("div",at,[n("div",it,[n("div",rt,[t[4]||(t[4]=x("19",-1)),o(k,{icon:"mdi-circle",size:"x-small",class:"ml-1"})])]),t[5]||(t[5]=n("div",{class:"ml-3 text-caption"},"Ничья с №19 черными",-1))])]),_:1}),o(P,null,{default:l(()=>[n("div",ct,[n("div",dt,[n("div",_t,[t[6]||(t[6]=x("21",-1)),o(k,{icon:"mdi-circle",size:"x-small",class:"ml-1"})])]),t[7]||(t[7]=n("div",{class:"ml-3 text-caption"},"Технический результат",-1))])]),_:1}),o(P,null,{default:l(()=>[...t[8]||(t[8]=[n("div",{class:"d-flex align-center"},[n("div",{class:"cell-example result-win"},[n("div",{class:"cell-content font-weight-bold"},"+")]),n("div",{class:"ml-3 text-caption"},"Bye (пропуск тура)")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(J),n("div",pt,[o(j,{class:E(["crosstable",{"is-mobile":g(e)}]),density:"compact"},{default:l(()=>[n("thead",null,[n("tr",null,[t[9]||(t[9]=n("th",{class:"sticky-col rank-col"},"#",-1)),t[10]||(t[10]=n("th",{class:"sticky-col player-col"},"Игрок",-1)),(d(!0),u(N,null,T(r.value,c=>(d(),u("th",{key:c,class:"text-center round-col"},_(c),1))),128)),t[11]||(t[11]=n("th",{class:"sticky-col-right points-col"},"Очки",-1))])]),n("tbody",null,[(d(!0),u(N,null,T(B.value,c=>(d(),u("tr",{key:c.player_id},[n("td",ut,_(c.starting_rank),1),n("td",mt,[n("div",{onClick:a=>y(c.player_id),class:"player-link",title:c.player_name},_(g(e)?v(c.player_name):c.player_name),9,vt)]),(d(!0),u(N,null,T(c.results,(a,K)=>(d(),u("td",{key:K,class:E(["text-center round-col result-cell",F(a)]),onClick:f=>I(a)},[a&&a.is_bye?(d(),C(z,{key:0,location:"top"},{activator:l(({props:f})=>[n("div",w({ref_for:!0},f,{class:"cell-content font-weight-bold text-success"})," + ",16)]),default:l(()=>[t[12]||(t[12]=n("span",null,"Пропуск тура (Bye)",-1))]),_:1})):a&&a.is_technical?(d(),C(z,{key:1,location:"top"},{activator:l(({props:f})=>[n("div",w({ref_for:!0},f,{class:"cell-content font-weight-bold is-technical"}),[n("span",gt,_(a.opponent_starting_rank),1),o(k,{icon:g($)(a.color),size:"x-small"},null,8,["icon"])],16)]),default:l(()=>[n("span",null,_(a.points===1?"Тех. победа":"Тех. поражение")+" vs "+_(a.opponent_name),1)]),_:2},1024)):a?(d(),C(z,{key:2,location:"top",disabled:!a.opponent_name},{activator:l(({props:f})=>[n("div",w({ref_for:!0},f,{class:"cell-content"}),[n("span",yt,_(a.opponent_starting_rank),1),o(k,{icon:g($)(a.color),size:"x-small"},null,8,["icon"])],16)]),default:l(()=>[n("span",null,_(g(Z)(a.points))+" vs "+_(a.opponent_name),1)]),_:2},1032,["disabled"])):(d(),u("span",bt,"-"))],10,ft))),128)),n("td",kt,_(c.totalPoints),1)]))),128))])]),_:1},8,["class"])])]),_:1}))])}}},wt=tt(xt,[["__scopeId","data-v-1d6217bd"]]);export{wt as default};
