import{u as G,c as C,g as z,f as y,a as I,i as t,w as o,r as i,d as E,o as f,h as v,t as r,e,F as L,k as V,b as M,s as T,m as j}from"./index-DBy-SGKi.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={key:0},J={class:"font-weight-bold text-h6"},K={class:"font-weight-bold text-h6"},O={class:"font-weight-bold text-h6"},Q={class:"font-weight-bold text-h6"},U={class:"path-container"},X={class:"path-graph",viewBox:"0 0 1000 100",preserveAspectRatio:"none"},Y=["points"],Z={class:"path-results"},tt={class:"text-caption text-grey"},et={class:"d-flex align-center mb-2"},ot={style:{width:"80px"}},st={class:"d-flex align-center"},nt={style:{width:"80px"}},lt={class:"text-right"},at={__name:"PlayerView",props:{start_no:{type:[String,Number],required:!0}},setup(R){const H=R,N=G(),B=E(),c=C(()=>N.getPlayerByStartNo(H.start_no)),q=()=>{B.back()},D=n=>{const s=`${n.round}-${n.board}`;B.push({name:"game",params:{id:s},query:{pov:c.value.start_no}})},u=C(()=>{const n={colorStats:{white:{games:0,points:0,percent:0},black:{games:0,points:0,percent:0}},opponentStats:{averageRating:0,vsHigher:"0/0/0",vsLower:"0/0/0"},tournamentPath:{results:[],graphPoints:"0,100"}};if(!c.value||!c.value.games)return n;const s=parseInt(c.value.rating);let S=0,m=0,b={w:0,d:0,l:0},w={w:0,d:0,l:0},h=0;const p=[{round:0,points:0}];[...c.value.games].sort((l,a)=>parseInt(l.round)-parseInt(a.round)).forEach(l=>{const a=z(l.result);if(a===null){l.opponent_name!=="bye"&&n.tournamentPath.results.push({round:l.round,label:"?",color:"blue-grey-lighten-3"});return}h+=a,p.push({round:parseInt(l.round),points:h}),l.color==="w"?(n.colorStats.white.games++,n.colorStats.white.points+=a):l.color==="b"&&(n.colorStats.black.games++,n.colorStats.black.points+=a);const g=N.players.find(_=>_.start_no===l.opponent_start_no);if(g){const _=parseInt(g.rating);if(!isNaN(_)){S+=_,m++;let P=_>s?b:w;a===1?P.w++:a===.5?P.d++:P.l++}}n.tournamentPath.results.push({round:l.round,label:a===1?"W":a===.5?"D":"L",color:a===1?"success":a===.5?"grey":"error"})}),n.colorStats.white.games>0&&(n.colorStats.white.percent=n.colorStats.white.points/n.colorStats.white.games*100),n.colorStats.black.games>0&&(n.colorStats.black.percent=n.colorStats.black.points/n.colorStats.black.games*100),m>0&&(n.opponentStats.averageRating=Math.round(S/m)),n.opponentStats.vsHigher=`+${b.w} =${b.d} -${b.l}`,n.opponentStats.vsLower=`+${w.w} =${w.d} -${w.l}`;const k=p.length-1,x=k>0?Math.max(...p.map(l=>l.points)):1;return n.tournamentPath.graphPoints=p.map(l=>{const a=k>0?l.round/k*1e3:0,g=x>0?100-l.points/x*90:100;return`${a},${g}`}).join(" "),n});return(n,s)=>{const S=i("v-btn"),m=i("v-card-title"),b=i("v-card-subtitle"),w=i("v-divider"),h=i("v-sheet"),p=i("v-col"),$=i("v-row"),k=i("v-chip"),x=i("v-card-text"),l=i("v-card"),a=i("v-icon"),g=i("v-progress-linear"),_=i("v-list-item"),P=i("v-table"),F=i("v-alert");return c.value?(f(),y("div",W,[t(l,{class:"mx-auto",elevation:"2"},{default:o(()=>[t(m,{class:"d-flex align-center"},{default:o(()=>[t(S,{icon:"mdi-arrow-left",variant:"text",onClick:q,class:"mr-2"}),v(" Карточка игрока: "+r(c.value.name),1)]),_:1}),t(b,null,{default:o(()=>[v(r(c.value.details["клуб/город"]||c.value.fed),1)]),_:1}),t(w,{class:"my-2"}),t(x,null,{default:o(()=>[t($,{dense:""},{default:o(()=>[t(p,{cols:"6",sm:"3"},{default:o(()=>[t(h,{rounded:"lg",class:"pa-2 text-center",color:"surface-variant"},{default:o(()=>[s[0]||(s[0]=e("div",{class:"text-caption"},"Место",-1)),e("div",J,r(c.value.details?.место||"-"),1)]),_:1})]),_:1}),t(p,{cols:"6",sm:"3"},{default:o(()=>[t(h,{rounded:"lg",class:"pa-2 text-center",color:"surface-variant"},{default:o(()=>[s[1]||(s[1]=e("div",{class:"text-caption"},"Очки",-1)),e("div",K,r(c.value.details?.очки||"-"),1)]),_:1})]),_:1}),t(p,{cols:"6",sm:"3"},{default:o(()=>[t(h,{rounded:"lg",class:"pa-2 text-center",color:"surface-variant"},{default:o(()=>[s[2]||(s[2]=e("div",{class:"text-caption"},"Рейтинг",-1)),e("div",O,r(c.value.rating||"-"),1)]),_:1})]),_:1}),t(p,{cols:"6",sm:"3"},{default:o(()=>[t(h,{rounded:"lg",class:"pa-2 text-center",color:"surface-variant"},{default:o(()=>[s[3]||(s[3]=e("div",{class:"text-caption"},"Перфоманс",-1)),e("div",Q,r(c.value.details?.рейтинговый_перфоманс||"-"),1)]),_:1})]),_:1})]),_:1}),t(l,{variant:"outlined",class:"mt-6"},{default:o(()=>[t(m,{class:"text-subtitle-1"},{default:o(()=>[...s[4]||(s[4]=[v("Турнирный путь",-1)])]),_:1}),t(x,null,{default:o(()=>[e("div",U,[(f(),y("svg",X,[e("polyline",{points:u.value.tournamentPath.graphPoints},null,8,Y)])),e("div",Z,[(f(!0),y(L,null,V(u.value.tournamentPath.results,d=>(f(),y("div",{key:d.round,class:"path-item"},[t(k,{color:d.color,size:"small"},{default:o(()=>[v(r(d.label),1)]),_:2},1032,["color"]),e("div",tt,r(d.round),1)]))),128))])])]),_:1})]),_:1}),t($,{class:"mt-4"},{default:o(()=>[t(p,{cols:"12",md:"6"},{default:o(()=>[t(l,{variant:"tonal",class:"fill-height"},{default:o(()=>[t(m,{class:"text-subtitle-1"},{default:o(()=>[...s[5]||(s[5]=[v("Результативность по цвету",-1)])]),_:1}),t(x,null,{default:o(()=>[e("div",et,[e("div",ot,[t(a,{icon:"mdi-chess-king",class:"mr-2"}),s[6]||(s[6]=v("Белые",-1))]),t(g,{"model-value":u.value.colorStats.white.percent,color:"grey-lighten-2",height:"20",rounded:""},{default:o(()=>[e("strong",null,r(u.value.colorStats.white.points)+" / "+r(u.value.colorStats.white.games),1)]),_:1},8,["model-value"])]),e("div",st,[e("div",nt,[t(a,{icon:"mdi-chess-queen",class:"mr-2"}),s[7]||(s[7]=v("Черные",-1))]),t(g,{"model-value":u.value.colorStats.black.percent,color:"grey-darken-2",height:"20",rounded:""},{default:o(()=>[e("strong",null,r(u.value.colorStats.black.points)+" / "+r(u.value.colorStats.black.games),1)]),_:1},8,["model-value"])])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"6"},{default:o(()=>[t(l,{variant:"tonal",class:"fill-height"},{default:o(()=>[t(m,{class:"text-subtitle-1"},{default:o(()=>[...s[8]||(s[8]=[v("Анализ соперников",-1)])]),_:1}),t(_,{density:"compact","prepend-icon":"mdi-account-group-outline",subtitle:`Средний рейтинг: ${u.value.opponentStats.averageRating}`},null,8,["subtitle"]),t(_,{density:"compact","prepend-icon":"mdi-arrow-up-bold-circle-outline",subtitle:`Против > рейтинга: ${u.value.opponentStats.vsHigher}`},null,8,["subtitle"]),t(_,{density:"compact","prepend-icon":"mdi-arrow-down-bold-circle-outline",subtitle:`Против < рейтинга: ${u.value.opponentStats.vsLower}`},null,8,["subtitle"])]),_:1})]),_:1})]),_:1}),s[11]||(s[11]=e("h3",{class:"mt-6 mb-2"},"Сыгранные партии",-1)),t(P,{density:"compact"},{default:o(()=>[s[10]||(s[10]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Тур"),e("th",{class:"text-left"},"Цвет"),e("th",{class:"text-left"},"Соперник"),e("th",{class:"text-left"},"Результат"),e("th")])],-1)),e("tbody",null,[(f(!0),y(L,null,V(c.value.games,d=>(f(),y("tr",{key:d.round},[e("td",null,r(d.round),1),e("td",null,r(d.color==="w"?"Белые":"Черные"),1),e("td",null,r(d.opponent_name),1),e("td",null,r(M(T)(d.result)),1),e("td",lt,[d.pgn&&d.board?(f(),I(S,{key:0,size:"small",variant:"tonal",onClick:rt=>D(d)},{default:o(()=>[s[9]||(s[9]=v(" Смотреть",-1)),t(a,{end:"",icon:"mdi-chevron-right"})]),_:1},8,["onClick"])):j("",!0)])]))),128))])]),_:1})]),_:1})]),_:1})])):(f(),I(F,{key:1,type:"warning",class:"mt-4",prominent:"",border:"start",icon:"mdi-alert-circle-outline"},{default:o(()=>[v(" Игрок с номером "+r(R.start_no)+" не найден. Возможно, данные еще загружаются или ссылка некорректна. ",1)]),_:1}))}}},dt=A(at,[["__scopeId","data-v-c5389f75"]]);export{dt as default};
