import{E as W,j as r,c as o,u as j,G as c}from"./index-Frlf8bwr.js";import{f as P}from"./formatters-CuXF23sB.js";const x=W("player",()=>{const d=r(null),l=r([]),p=r(!1),g=r(null),y=r([]),_=r(!1),m=r(null),i=r(null),h=r(null),s=r(null),u=r([]),v=r(!1),b=o(()=>{const t={gold:0,silver:0,bronze:0,tournaments:l.value.length};return l.value&&l.value.forEach(e=>{e.final_rank===1?t.gold++:e.final_rank===2?t.silver++:e.final_rank===3&&t.bronze++}),t}),k=o(()=>{if(!l.value||l.value.length===0)return{labels:[],datasets:[]};const t=[],e=[];return l.value.forEach(a=>{a.start_date&&a.rating_at_tournament&&(t.push(a.start_date),e.push(a.rating_at_tournament))}),{labels:t,datasets:[{label:"Рейтинг",backgroundColor:"rgba(0, 82, 204, 0.2)",borderColor:"#0052CC",pointBackgroundColor:"#0052CC",data:e,fill:!0,tension:.1}]}}),C=o(()=>{const e=j().currentTournament;return!e||!l.value||l.value.length===0?null:l.value.find(a=>a.tournament_id===e.id)||null}),E=o(()=>{const t={peakRating:0,latestRating:0};if(!l.value)return t;let e="";return l.value.forEach(a=>{a.rating_at_tournament>t.peakRating&&(t.peakRating=a.rating_at_tournament),a.start_date>e&&(e=a.start_date,t.latestRating=a.rating_at_tournament)}),t}),H=o(()=>{const t={wins:0,draws:0,losses:0,total:0,score:0,percent:0},e={vs_stronger:{...t},vs_equal:{...t},vs_weaker:{...t}};return i.value&&i.value.forEach(a=>{const{opponent_category:n,wins:f,draws:w,losses:S}=a;e[n]={wins:f,draws:w,losses:S,total:f+w+S,score:f+w*.5},e[n].percent=Math.round(e[n].score/e[n].total*100)}),e}),L=o(()=>s.value?(console.log(s.value),s.value):[]),R=o(()=>{const t={white:{w:0,d:0,l:0,total:0,score:0,winPercent:0},black:{w:0,d:0,l:0,total:0,score:0,winPercent:0},total:{w:0,d:0,l:0,total:0,score:0,winPercent:0}};return!u.value||u.value.length===0||(u.value.forEach(e=>{const a=P(e.result,e.player_color),n=e.player_color==="w"?"white":"black";a==="1"?(t[n].w++,t.total.w++):a==="½"?(t[n].d++,t.total.d++):a==="0"&&(t[n].l++,t.total.l++)}),["white","black","total"].forEach(e=>{const a=t[e];a.total=a.w+a.d+a.l,a.score=a.w+a.d*.5,a.total>0&&(a.winPercent=Math.round(a.w/a.total*100))})),t}),A=o(()=>{const t={opening:{score:0,total:0},middlegame:{score:0,total:0},endgame:{score:0,total:0}};return u.value.forEach(e=>{const a=P(e.result,e.player_color),n=a==="1"?1:a==="½"?.5:0,f=e.round/e.rounds_count;f<=.34?(t.opening.score+=n,t.opening.total++):f<=.67?(t.middlegame.score+=n,t.middlegame.total++):(t.endgame.score+=n,t.endgame.total++)}),Object.values(t).forEach(e=>{e.percent=e.total>0?Math.round(e.score/e.total*100):0}),t}),D=o(()=>{let t={opponent_rating:0,opponent_name:null,game_id:null},e={opponent_rating:1/0,opponent_name:null,game_id:null};return u.value.forEach(a=>{const n=P(a.result,a.player_color);n==="1"&&a.opponent_rating>t.opponent_rating&&(t=a),n==="0"&&a.opponent_rating<e.opponent_rating&&(e=a)}),{bestWin:t.game_id?t:null,worstLoss:e.game_id?e:null}});async function O(t){p.value=!0,g.value=null;try{const[e,a]=await Promise.all([c.getPlayerGlobalProfile(t),c.getPlayerCareer(t)]);d.value=e,l.value=a}catch(e){g.value=e.message,console.error("Ошибка при загрузке глобального профиля игрока:",e)}finally{p.value=!1}}async function G(t){if(!i.value){v.value=!0;try{const[e,a,n]=await Promise.all([c.getPlayerOpponentStats(t),c.getPlayerOpeningStats(t),c.getPlayerGamesForAnalytics(t)]);i.value=e,h.value=a,u.value=n}catch(e){console.error("Ошибка при загрузке аналитики:",e)}finally{v.value=!1}}}async function M(t){if(!s.value){v.value=!0;try{s.value=await c.getPlayerHeadToHead(t)}catch(e){console.error("Ошибка при загрузке H2H:",e)}finally{v.value=!1}}}function T(){d.value=null,l.value=[],i.value=null,h.value=null,s.value=null,u.value=[]}async function z(){if(!(y.value.length>0)){_.value=!0,m.value=null;try{y.value=await c.getAllPlayersWithStatsOptimized()}catch(t){m.value=t.message,console.error("Ошибка при загрузке списка всех игроков:",t)}finally{_.value=!1}}}return{playerProfile:d,playerCareer:l,isLoading:p,error:g,careerStats:b,ratingHistory:k,keyMetrics:E,fetchPlayerData:O,clearPlayerData:T,playerList:y,isLoadingList:_,errorList:m,fetchAllPlayers:z,opponentStats:i,openingStats:h,h2hStats:s,isLoadingAnalytics:v,processedOpponentStats:H,processedH2HStats:L,fetchPlayerAnalytics:G,fetchPlayerH2H:M,careerPerformanceStats:R,performanceByRounds:A,notableResults:D,participationInCurrentTournament:C}});export{x as u};
