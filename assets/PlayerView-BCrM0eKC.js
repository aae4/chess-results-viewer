import{u as K,c as b,g as I,C as Q,A as U,f as k,a as w,i as e,w as s,r as i,d as W,o as g,e as o,t as l,b as V,j as X,h as d,n as Y,F as D,k as R,y as Z,p as tt}from"./index-B-MfjX_p.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st={key:0,class:"player-dashboard"},ot={class:"text-h4 font-weight-light"},nt={class:"text-h4 font-weight-bold"},lt={class:"text-subtitle-1 text-grey-darken-1"},at={class:"text-center mx-4"},rt={class:"text-h3 font-weight-bold"},it={class:"text-center mx-4"},ct={class:"text-h3 font-weight-bold"},dt={class:"text-h6"},ut={class:"text-h6"},_t={class:"d-flex align-center mb-3"},pt={style:{width:"100px"}},vt={class:"d-flex align-center"},gt={style:{width:"100px"}},mt={class:"text-caption text-grey"},ft={class:"text-center"},xt={class:"text-center font-weight-bold"},ht={class:"mr-4 text-center",style:{width:"40px"}},yt={class:"text-body-1 font-weight-medium"},bt={class:"text-caption text-grey ml-2"},wt={__name:"PlayerView",props:{start_no:{type:[String,Number],required:!0}},setup(T){const $=T,x=K(),B=W(),a=b(()=>x.getPlayerByStartNo($.start_no)),j=()=>B.back(),z=n=>{if(!n.pgn||!n.board)return;const t=`${n.round}-${n.board}`;B.push({name:"game",params:{id:t},query:{pov:a.value.start_no}})},F=n=>x.getPlayerByStartNo(n)?.rating||"-",O=n=>{const t=I(n.result);return t===1?"success":t===0?"error":"grey"},N=b(()=>{const n=parseInt(a.value?.details?.рейтинговый_перфоманс||0),t=parseInt(a.value?.rating||0);return n===0||t===0?0:n-t}),q=b(()=>{const n=N.value;return n>0?`+${n}`:n}),A=b(()=>{const n=N.value;return n>0?"text-success":n<0?"text-error":""}),m=b(()=>{const n={colorStats:{white:{games:0,points:0,percent:0},black:{games:0,points:0,percent:0}},openingStats:[]};if(!a.value||!a.value.games)return n;const t={};return a.value.games.forEach(u=>{const v=I(u.result);if(v!==null&&(u.color==="w"?(n.colorStats.white.games++,n.colorStats.white.points+=v):u.color==="b"&&(n.colorStats.black.games++,n.colorStats.black.points+=v),u.pgn&&x.ecoDatabase))try{const h=new Q;h.loadPgn(u.pgn);const y=h.history();let _=null;for(let c=Math.min(y.length,20);c>0;c--){const p=U(y.slice(0,c));if(x.ecoDatabase[p]){_=x.ecoDatabase[p];break}}if(_){const c=_.e;t[c]||(t[c]={eco:c,name:_.n,count:0,points:0}),t[c].count++,t[c].points+=v}}catch{}}),n.colorStats.white.games>0&&(n.colorStats.white.percent=n.colorStats.white.points/n.colorStats.white.games*100),n.colorStats.black.games>0&&(n.colorStats.black.percent=n.colorStats.black.points/n.colorStats.black.games*100),n.openingStats=Object.values(t).sort((u,v)=>v.count-u.count||v.points-u.points),n});return(n,t)=>{const u=i("v-btn"),v=i("v-avatar"),h=i("v-spacer"),y=i("v-divider"),_=i("v-card-text"),c=i("v-card"),p=i("v-icon"),f=i("v-col"),S=i("v-row"),C=i("v-card-title"),P=i("v-progress-linear"),E=i("v-table"),G=i("v-list-item-title"),L=i("v-chip"),M=i("v-list-item"),H=i("v-list"),J=i("v-alert");return a.value?(g(),k("div",st,[e(c,{class:"mb-6"},{default:s(()=>[e(_,{class:"d-flex align-center"},{default:s(()=>[e(u,{icon:"mdi-arrow-left",variant:"text",onClick:j,class:"mr-4"}),e(v,{color:"primary",size:"64",class:"mr-6"},{default:s(()=>[o("span",ot,l(V(X)(a.value.name)),1)]),_:1}),o("div",null,[o("h1",nt,l(a.value.name),1),o("div",lt,l(a.value.details["клуб/город"]||a.value.fed),1)]),e(h),o("div",at,[t[0]||(t[0]=o("div",{class:"text-caption text-grey"},"МЕСТО",-1)),o("div",rt,l(a.value.details?.место||"-"),1)]),e(y,{vertical:"",class:"mx-2"}),o("div",it,[t[1]||(t[1]=o("div",{class:"text-caption text-grey"},"ОЧКИ",-1)),o("div",ct,l(a.value.details?.очки||"-"),1)])]),_:1})]),_:1}),e(S,null,{default:s(()=>[e(f,{cols:"12",md:"5"},{default:s(()=>[e(S,null,{default:s(()=>[e(f,{cols:"12"},{default:s(()=>[e(c,null,{default:s(()=>[e(_,null,{default:s(()=>[e(S,null,{default:s(()=>[e(f,{class:"text-center"},{default:s(()=>[e(p,{color:"grey-darken-1",class:"mb-1"},{default:s(()=>[...t[2]||(t[2]=[d("mdi-chess-king",-1)])]),_:1}),t[3]||(t[3]=o("div",{class:"text-caption text-grey"},"Рейтинг",-1)),o("div",dt,l(a.value.rating),1)]),_:1}),e(f,{class:"text-center"},{default:s(()=>[e(p,{color:"grey-darken-1",class:"mb-1"},{default:s(()=>[...t[4]||(t[4]=[d("mdi-finance",-1)])]),_:1}),t[5]||(t[5]=o("div",{class:"text-caption text-grey"},"Перфоманс",-1)),o("div",ut,l(a.value.details?.рейтинговый_перфоманс||"-"),1)]),_:1}),e(f,{class:"text-center"},{default:s(()=>[e(p,{color:"grey-darken-1",class:"mb-1"},{default:s(()=>[...t[6]||(t[6]=[d("mdi-arrow-up-down-bold",-1)])]),_:1}),t[7]||(t[7]=o("div",{class:"text-caption text-grey"},"+/- Рейтинга",-1)),o("div",{class:Y(["text-h6",A.value])},l(q.value),3)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12"},{default:s(()=>[e(c,null,{default:s(()=>[e(C,{class:"text-subtitle-1"},{default:s(()=>[...t[8]||(t[8]=[d("Результативность по цвету",-1)])]),_:1}),e(_,null,{default:s(()=>[o("div",_t,[o("div",pt,[e(p,{icon:"mdi-circle-outline",class:"mr-2"}),t[9]||(t[9]=d("Белые",-1))]),e(P,{"model-value":m.value.colorStats.white.percent,color:"grey-lighten-2",height:"22",rounded:""},{default:s(()=>[o("strong",null,l(m.value.colorStats.white.points)+" / "+l(m.value.colorStats.white.games),1)]),_:1},8,["model-value"])]),o("div",vt,[o("div",gt,[e(p,{icon:"mdi-circle",class:"mr-2"}),t[10]||(t[10]=d("Черные",-1))]),e(P,{"model-value":m.value.colorStats.black.percent,color:"grey-darken-2",height:"22",rounded:""},{default:s(()=>[o("strong",null,l(m.value.colorStats.black.points)+" / "+l(m.value.colorStats.black.games),1)]),_:1},8,["model-value"])])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12"},{default:s(()=>[e(c,null,{default:s(()=>[e(C,{class:"text-subtitle-1"},{default:s(()=>[...t[11]||(t[11]=[d("Дебютный репертуар",-1)])]),_:1}),m.value.openingStats.length>0?(g(),w(_,{key:0},{default:s(()=>[e(E,{density:"compact"},{default:s(()=>[t[12]||(t[12]=o("thead",null,[o("tr",null,[o("th",null,"Дебют"),o("th",{class:"text-center"},"Партий"),o("th",{class:"text-center"},"Результат")])],-1)),o("tbody",null,[(g(!0),k(D,null,R(m.value.openingStats,r=>(g(),k("tr",{key:r.name},[o("td",null,[o("div",null,l(r.name),1),o("div",mt,l(r.eco),1)]),o("td",ft,l(r.count),1),o("td",xt,l(r.points)+" / "+l(r.count),1)]))),128))])]),_:1})]),_:1})):(g(),w(_,{key:1,class:"text-center text-grey"},{default:s(()=>[...t[13]||(t[13]=[d(" Нет данных по дебютам. ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",md:"7"},{default:s(()=>[e(c,{class:"fill-height"},{default:s(()=>[e(C,{class:"text-subtitle-1"},{default:s(()=>[d("Сыгранные партии ("+l(a.value.games.length)+")",1)]),_:1}),e(y),e(H,{class:"game-list"},{default:s(()=>[(g(!0),k(D,null,R(a.value.games,r=>(g(),w(M,{key:r.round,onClick:kt=>z(r),disabled:!r.pgn,class:"game-list-item"},{prepend:s(()=>[o("div",ht,[t[14]||(t[14]=o("div",{class:"text-caption text-grey"},"Тур",-1)),o("div",yt,l(r.round),1)])]),append:s(()=>[e(L,{color:O(r),label:"",class:"font-weight-bold",style:{width:"50px","justify-content":"center"}},{default:s(()=>[d(l(r.result),1)]),_:2},1032,["color"]),r.pgn?(g(),w(p,{key:0,class:"ml-4 text-grey"},{default:s(()=>[...t[15]||(t[15]=[d("mdi-chevron-right",-1)])]),_:1})):tt("",!0)]),default:s(()=>[e(G,{class:"font-weight-bold d-flex align-center"},{default:s(()=>[e(p,{size:"small",icon:V(Z)(r.color),class:"mr-2"},null,8,["icon"]),o("span",null,"vs "+l(r.opponent_name),1),o("span",bt,"("+l(F(r.opponent_start_no))+")",1)]),_:2},1024)]),_:2},1032,["onClick","disabled"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):(g(),w(J,{key:1,type:"warning",class:"mt-4"},{default:s(()=>[...t[16]||(t[16]=[d("Игрок не найден.",-1)])]),_:1}))}}},Bt=et(wt,[["__scopeId","data-v-ee6544b1"]]);export{Bt as default};
